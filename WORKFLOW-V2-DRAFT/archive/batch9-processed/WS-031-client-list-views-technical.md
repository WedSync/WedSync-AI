# TECHNICAL SPECIFICATION: WS-031 - Client List Views
## Generated by Feature Development Session - 2025-08-21

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer with 50+ couples per year
**I want to:** View my client list in multiple formats (list, grid, calendar, kanban)
**So that:** I can quickly find specific couples, see upcoming weddings at a glance, and organize my workflow without switching between tools

**Real Wedding Scenario:**
A photographer currently uses Excel spreadsheets to track 80 wedding couples. They need to see which couples have weddings next month, which ones still need timeline confirmation, and quickly access couple photos for social media. With flexible list views, they can switch between calendar view for scheduling, grid view for visual couple identification, and kanban view for tracking planning stages.

### SPECIFICATION SOURCE
- **Feature ID:** WS-031
- **Original Spec:** /CORE-SPECIFICATIONS/02-WEDSYNC-SUPPLIER-PLATFORM/03-Client-Management/01-client-list-views md.md
- **Current Implementation:** 0% complete
- **Files to Modify:** 
  - `/src/app/(dashboard)/clients/page.tsx` (new)
  - `/src/components/clients/ClientListView.tsx` (new)
  - `/src/components/clients/ClientGridView.tsx` (new)
  - `/src/components/clients/ClientKanbanView.tsx` (new)
  - `/src/components/clients/ClientCalendarView.tsx` (new)
- **New Files to Create:** 
  - `/src/lib/stores/clientListStore.ts` (Zustand store)
  - `/src/lib/hooks/useClientList.ts` (custom hook)

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Add view preferences for user customization
CREATE TABLE IF NOT EXISTS user_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  preference_key TEXT NOT NULL,
  preference_value JSONB NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, preference_key)
);

-- Add indexes for client filtering
CREATE INDEX IF NOT EXISTS idx_clients_wedding_date ON clients(wedding_date);
CREATE INDEX IF NOT EXISTS idx_clients_status ON clients(status);
CREATE INDEX IF NOT EXISTS idx_clients_last_activity ON clients(last_activity_at);
```

#### API Endpoints Required
```typescript
// GET /api/clients
interface GetClientsRequest {
  view?: 'list' | 'grid' | 'calendar' | 'kanban';
  filter?: {
    status?: string[];
    dateRange?: { start: string; end: string };
    tags?: string[];
    search?: string;
  };
  sort?: {
    field: string;
    direction: 'asc' | 'desc';
  };
  pagination?: {
    page: number;
    limit: number;
  };
}

interface GetClientsResponse {
  clients: Client[];
  total: number;
  hasMore: boolean;
}

// PUT /api/user/preferences
interface UpdatePreferencesRequest {
  key: string;
  value: any;
}
```

#### Frontend Components Required
```typescript
// Component: ClientListView
// Location: /src/components/clients/ClientListView.tsx

interface ClientListViewProps {
  clients: Client[];
  onClientSelect: (client: Client) => void;
  onBulkAction: (action: string, clientIds: string[]) => void;
}

// Key functionality:
- Virtual scrolling with react-window for 100+ clients
- Sortable columns with click-to-sort
- Bulk selection with checkboxes
- Inline quick actions (message, edit, view)
- Real-time search filtering
- Responsive column hiding on mobile

// Component: ClientGridView 
// Location: /src/components/clients/ClientGridView.tsx
- Card-based layout with couple photos
- Lazy loading of images
- Hover effects with quick actions
- Responsive grid (1-4 columns based on screen size)

// Component: ClientKanbanView
// Location: /src/components/clients/ClientKanbanView.tsx
- Drag-and-drop between status columns
- Status: Planning, Timeline Set, Photos Delivered, Complete
- Real-time updates via Supabase subscriptions

// Component: ClientCalendarView
// Location: /src/components/clients/ClientCalendarView.tsx
- Full calendar integration
- Wedding dates as events
- Color coding by status
- Click to view client details
```

#### Integration Points
```typescript
// Service: ClientListService
// Dependencies: Supabase, Zustand store

class ClientListService {
  async getClients(params: GetClientsRequest) {
    // Server-side filtering for performance
    const query = supabase
      .from('clients')
      .select('*')
      .order(params.sort?.field || 'wedding_date', {
        ascending: params.sort?.direction === 'asc'
      });
      
    if (params.filter?.search) {
      query.ilike('couple_name', `%${params.filter.search}%`);
    }
    
    return query;
  }
  
  async updateClientStatus(clientId: string, status: string) {
    // Optimistic updates with rollback
  }
}
```

### CODE EXAMPLES

#### Example 1: Zustand Store Implementation
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { create } from 'zustand';
import { devtools } from 'zustand/middleware';

interface ClientListStore {
  clients: Client[];
  viewType: 'list' | 'grid' | 'calendar' | 'kanban';
  filters: ClientFilters;
  selectedClientIds: string[];
  isLoading: boolean;
  setViewType: (type: string) => void;
  setFilters: (filters: Partial<ClientFilters>) => void;
  toggleClientSelection: (id: string) => void;
  clearSelection: () => void;
}

export const useClientListStore = create<ClientListStore>()(
  devtools((set, get) => ({
    clients: [],
    viewType: 'list',
    filters: {},
    selectedClientIds: [],
    isLoading: false,
    
    setViewType: (type) => {
      set({ viewType: type });
      // Persist to localStorage
      localStorage.setItem('clientListView', type);
    },
    
    setFilters: (newFilters) => {
      set(state => ({
        filters: { ...state.filters, ...newFilters }
      }));
    },
    
    toggleClientSelection: (id) => {
      set(state => ({
        selectedClientIds: state.selectedClientIds.includes(id)
          ? state.selectedClientIds.filter(cid => cid !== id)
          : [...state.selectedClientIds, id]
      }));
    },
    
    clearSelection: () => set({ selectedClientIds: [] })
  }), { name: 'client-list-store' })
);
```

### MCP SERVER USAGE

#### Required MCP Servers
- [x] Context7: Load docs for React, Next.js, Zustand, Supabase
- [x] Playwright: Test list view interactions, filtering, sorting
- [x] Filesystem: Access existing client component patterns

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/vercel/next.js", "app router data fetching", 3000);
await mcp__context7__get-library-docs("/supabase/supabase", "real-time subscriptions", 2000);
await mcp__context7__get-library-docs("/pmndrs/zustand", "typescript patterns", 2000);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('ClientListView', () => {
  it('should render clients in table format', () => {
    // Test basic rendering
  });
  
  it('should sort by column click', () => {
    // Test sorting functionality
  });
  
  it('should filter clients by search term', () => {
    // Test real-time search
  });
  
  it('should select multiple clients with checkboxes', () => {
    // Test bulk selection
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test('Client list view interactions', async () => {
  await mcp__playwright__browser_navigate({url: '/clients'});
  await mcp__playwright__browser_snapshot();
  
  // Test view switching
  await mcp__playwright__browser_click({
    element: 'Grid view button',
    ref: '[data-testid="view-grid"]'
  });
  
  // Test filtering
  await mcp__playwright__browser_type({
    element: 'Search input',
    ref: '[data-testid="search-input"]',
    text: 'Smith'
  });
  
  // Verify accessibility
  await mcp__playwright__browser_evaluate({
    function: '() => window.axe.run()'
  });
});
```

### ACCEPTANCE CRITERIA
- [x] Four view types work: list, grid, calendar, kanban
- [x] Real-time search filters results instantly
- [x] Bulk selection works with checkboxes
- [x] Views persist user preferences in localStorage
- [x] Performance: Loads 100+ clients in <2 seconds
- [x] Security: Row Level Security filters clients by supplier
- [x] Accessibility: WCAG 2.1 AA compliance, keyboard navigation

### DEPENDENCIES
- Must complete after: User authentication system
- Must complete before: WS-032 (Client Profiles)
- Shares code with: Dashboard layout components

### ESTIMATED EFFORT
- Team A Frontend: 16 hours
- Team B Backend: 8 hours  
- Team C Integration: 4 hours
- Total: 28 hours