# TECHNICAL SPECIFICATION: WS-220 - Weather API Integration
## Generated by Feature Development Session - 2025-01-25

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding planner coordinating outdoor ceremonies and photo shoots
**I want to:** Get accurate weather forecasts for wedding dates and receive alerts for potential weather issues
**So that:** I can proactively plan for rain, wind, or temperature changes, set up backup plans, advise on attire, and ensure photographers know when to bring indoor lighting, saving 2-3 hours of day-of coordination and preventing weather disasters

**Real Wedding Scenario:**
A couple has booked an outdoor garden wedding for next Saturday at 4pm in Napa Valley. The wedding planner uses weather integration to see a 15-day forecast showing 40% chance of rain that day with temperatures dropping to 55°F by evening. They proactively arrange tent rentals, notify the couple about potential attire changes, and alert the photographer that they may need indoor lighting equipment. When a weather alert comes in 3 days before showing storms moving in, the planner immediately contacts the venue about covered areas and sends the couple options for ceremony adjustments. On the wedding day, real-time weather updates help the photographer plan golden hour shots around cloud cover and help the planner adjust the cocktail hour timing based on temperature changes.

### SPECIFICATION SOURCE
- **Feature ID:** WS-220
- **Original Spec:** /CORE-SPECIFICATIONS/08-INTEGRATIONS/05-External-Services/02-weather-api md.md
- **Current Implementation:** 0% complete (standalone integration)
- **Files to Modify:** 
  - /src/components/wedding/WeddingDayPlanner.tsx (add weather dashboard)
  - /src/components/timeline/TimelineBuilder.tsx (add weather considerations)
- **New Files to Create:** 
  - /src/lib/integrations/weather-api-client.ts
  - /src/lib/services/weather-forecast-service.ts
  - /src/lib/services/weather-alerts-service.ts
  - /src/components/weather/WeatherDashboard.tsx
  - /src/components/weather/WeatherForecast.tsx
  - /src/components/weather/WeatherAlerts.tsx
  - /src/components/weather/WeatherTimeline.tsx
  - /src/hooks/useWeatherForecast.ts
  - /src/hooks/useWeatherAlerts.ts
  - /src/app/api/weather/forecast/route.ts
  - /src/app/api/weather/alerts/route.ts
  - /src/app/api/weather/historical/route.ts

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Weather API configuration and settings
CREATE TABLE IF NOT EXISTS weather_api_config (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  provider VARCHAR(50) NOT NULL DEFAULT 'openweathermap', -- openweathermap, weatherapi, etc.
  api_key_encrypted TEXT NOT NULL, -- Encrypted weather API key
  daily_quota_limit INTEGER DEFAULT 1000, -- Daily API request limit
  current_usage INTEGER DEFAULT 0, -- Current daily usage
  usage_reset_date DATE DEFAULT CURRENT_DATE,
  rate_limit_per_minute INTEGER DEFAULT 60,
  forecast_enabled BOOLEAN DEFAULT true,
  alerts_enabled BOOLEAN DEFAULT true,
  historical_enabled BOOLEAN DEFAULT false,
  default_units TEXT DEFAULT 'metric' CHECK (default_units IN ('metric', 'imperial')),
  supported_regions TEXT[] DEFAULT ARRAY['US', 'CA', 'UK', 'EU', 'AU'], -- Supported regions
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Weather data cache for forecast and current conditions
CREATE TABLE IF NOT EXISTS weather_data_cache (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  location_key TEXT NOT NULL, -- lat,lng or city identifier
  location_name TEXT,
  coordinates POINT NOT NULL, -- Lat/Long coordinates
  weather_data JSONB NOT NULL, -- Complete weather response from API
  data_type TEXT NOT NULL CHECK (data_type IN ('current', 'forecast', 'historical', 'alerts')),
  forecast_days INTEGER, -- Number of days for forecast data
  last_updated_at TIMESTAMP DEFAULT NOW(),
  expires_at TIMESTAMP NOT NULL,
  api_calls_used INTEGER DEFAULT 1, -- How many API calls to generate this data
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(location_key, data_type, forecast_days)
);

-- Weather tracking for specific wedding events
CREATE TABLE IF NOT EXISTS wedding_weather_tracking (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID REFERENCES couples(id) ON DELETE CASCADE,
  event_type TEXT NOT NULL CHECK (event_type IN (
    'ceremony', 'reception', 'engagement_shoot', 'bridal_photos',
    'rehearsal', 'welcome_party', 'send_off', 'vendor_setup'
  )),
  event_date DATE NOT NULL,
  event_time TIME,
  event_duration_hours INTEGER DEFAULT 2,
  location_coordinates POINT NOT NULL,
  location_name TEXT,
  location_address TEXT,
  is_outdoor BOOLEAN DEFAULT true,
  has_backup_plan BOOLEAN DEFAULT false,
  backup_plan_details TEXT,
  weather_sensitivity TEXT DEFAULT 'medium' CHECK (weather_sensitivity IN ('low', 'medium', 'high')),
  monitoring_enabled BOOLEAN DEFAULT true,
  alert_threshold JSONB DEFAULT '{
    "precipitation_chance": 30,
    "wind_speed_kph": 25,
    "temperature_low": 10,
    "temperature_high": 35
  }',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Weather alerts and notifications
CREATE TABLE IF NOT EXISTS weather_alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  weather_tracking_id UUID REFERENCES wedding_weather_tracking(id) ON DELETE CASCADE,
  alert_type TEXT NOT NULL CHECK (alert_type IN (
    'precipitation', 'high_wind', 'extreme_temperature', 'storm_warning',
    'air_quality', 'uv_index', 'forecast_change', 'severe_weather'
  )),
  severity TEXT NOT NULL CHECK (severity IN ('low', 'medium', 'high', 'severe')),
  alert_title TEXT NOT NULL,
  alert_message TEXT NOT NULL,
  weather_conditions JSONB NOT NULL, -- Weather data that triggered alert
  recommended_actions TEXT[],
  is_active BOOLEAN DEFAULT true,
  acknowledged_at TIMESTAMP,
  acknowledged_by_user_id UUID REFERENCES auth.users(id),
  alert_sent_at TIMESTAMP DEFAULT NOW(),
  alert_expires_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Weather alert subscriptions and preferences
CREATE TABLE IF NOT EXISTS weather_alert_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  alert_methods JSONB DEFAULT '["email", "sms", "push"]', -- Notification methods
  alert_timing JSONB DEFAULT '{
    "immediate": true,
    "daily_digest": true,
    "weekly_summary": false,
    "day_before": true,
    "hour_before": false
  }',
  precipitation_threshold INTEGER DEFAULT 30, -- % chance threshold
  wind_threshold INTEGER DEFAULT 25, -- km/h threshold
  temperature_low_threshold INTEGER DEFAULT 10, -- °C
  temperature_high_threshold INTEGER DEFAULT 35, -- °C
  severe_weather_alerts BOOLEAN DEFAULT true,
  forecast_change_alerts BOOLEAN DEFAULT true,
  photo_timing_alerts BOOLEAN DEFAULT true, -- Golden hour, lighting alerts
  vendor_weather_alerts BOOLEAN DEFAULT false, -- Alert vendors too
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(user_id)
);

-- Historical weather data for analytics and planning
CREATE TABLE IF NOT EXISTS weather_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  wedding_tracking_id UUID REFERENCES wedding_weather_tracking(id) ON DELETE CASCADE,
  actual_weather JSONB NOT NULL, -- Actual weather conditions during event
  forecast_accuracy JSONB, -- How accurate the forecast was
  impact_assessment TEXT, -- How weather affected the event
  backup_plan_used BOOLEAN DEFAULT false,
  vendor_adjustments JSONB DEFAULT '{}', -- What vendors had to adjust
  couple_satisfaction INTEGER, -- 1-5 rating of weather impact
  lessons_learned TEXT,
  recorded_at TIMESTAMP DEFAULT NOW()
);

-- Indexes for performance
CREATE INDEX idx_weather_data_cache_location ON weather_data_cache(location_key, data_type);
CREATE INDEX idx_weather_data_cache_coordinates ON weather_data_cache USING GIST (coordinates);
CREATE INDEX idx_weather_data_cache_expires ON weather_data_cache(expires_at);
CREATE INDEX idx_wedding_weather_tracking_couple ON wedding_weather_tracking(couple_id);
CREATE INDEX idx_wedding_weather_tracking_date ON wedding_weather_tracking(event_date);
CREATE INDEX idx_weather_alerts_tracking ON weather_alerts(weather_tracking_id);
CREATE INDEX idx_weather_alerts_active ON weather_alerts(is_active, severity);

-- Insert default configuration
INSERT INTO weather_api_config (provider, api_key_encrypted, daily_quota_limit) VALUES
('openweathermap', '', 1000); -- API key will be set during configuration
```

#### API Endpoints Required

**1. Weather Forecast & Current Conditions**
```typescript
// GET /api/weather/forecast
// Get weather forecast for specific location and date range
interface WeatherForecastRequest {
  latitude: number;
  longitude: number;
  locationName?: string;
  days?: number; // Forecast days (1-15)
  units?: 'metric' | 'imperial';
  includeHourly?: boolean;
  includeAlerts?: boolean;
}

interface WeatherForecastResponse {
  location: {
    name: string;
    country: string;
    timezone: string;
    coordinates: {
      lat: number;
      lng: number;
    };
  };
  current: CurrentWeather;
  forecast: DailyForecast[];
  hourlyForecast?: HourlyForecast[];
  alerts?: WeatherAlert[];
  dataSource: {
    provider: string;
    lastUpdated: string;
    fromCache: boolean;
    cacheAge?: string;
  };
  usage: {
    apiCalls: number;
    quotaRemaining: number;
  };
}

interface CurrentWeather {
  temperature: number;
  feelsLike: number;
  humidity: number;
  pressure: number;
  visibility: number;
  uvIndex: number;
  windSpeed: number;
  windDirection: number;
  windGust?: number;
  precipitationChance: number;
  precipitationAmount: number;
  cloudCover: number;
  condition: WeatherCondition;
  sunrise: string;
  sunset: string;
  moonPhase: string;
  airQuality?: AirQuality;
}

interface WeatherCondition {
  code: number;
  main: string; // 'Clear', 'Clouds', 'Rain', etc.
  description: string; // 'clear sky', 'light rain', etc.
  icon: string; // Weather icon code
  severity: 'clear' | 'partly_cloudy' | 'cloudy' | 'light_rain' | 'rain' | 'heavy_rain' | 'storm' | 'snow' | 'fog';
}

interface DailyForecast {
  date: string;
  temperature: {
    min: number;
    max: number;
    morning: number;
    afternoon: number;
    evening: number;
    night: number;
  };
  humidity: number;
  precipitationChance: number;
  precipitationAmount: number;
  windSpeed: number;
  windDirection: number;
  condition: WeatherCondition;
  uvIndex: number;
  sunrise: string;
  sunset: string;
  moonPhase: string;
  weddingRating: WeddingWeatherRating; // Custom rating for wedding suitability
}

interface HourlyForecast {
  datetime: string;
  temperature: number;
  feelsLike: number;
  humidity: number;
  precipitationChance: number;
  precipitationAmount: number;
  windSpeed: number;
  windDirection: number;
  cloudCover: number;
  condition: WeatherCondition;
  uvIndex: number;
}

interface WeddingWeatherRating {
  overall: 'excellent' | 'good' | 'fair' | 'poor' | 'unsuitable';
  score: number; // 1-10
  factors: {
    temperature: 'ideal' | 'comfortable' | 'warm' | 'cold' | 'extreme';
    precipitation: 'none' | 'light' | 'moderate' | 'heavy';
    wind: 'calm' | 'gentle' | 'moderate' | 'strong' | 'severe';
    conditions: 'clear' | 'partly_cloudy' | 'overcast' | 'stormy';
  };
  recommendations: string[];
  considerations: string[];
}

interface AirQuality {
  index: number; // 1-5 scale
  condition: 'good' | 'moderate' | 'unhealthy_sensitive' | 'unhealthy' | 'very_unhealthy' | 'hazardous';
  pm25: number;
  pm10: number;
  ozone: number;
  no2: number;
  so2: number;
}
```

**2. Weather Alerts & Monitoring**
```typescript
// GET /api/weather/alerts
// Get weather alerts for tracked wedding events
interface WeatherAlertsRequest {
  coupleId?: string;
  eventTypes?: string[];
  severity?: 'low' | 'medium' | 'high' | 'severe';
  activeOnly?: boolean;
  days?: number; // Look ahead days
}

interface WeatherAlertsResponse {
  alerts: WeatherAlertDetail[];
  summary: {
    totalAlerts: number;
    activeAlerts: number;
    highSeverityAlerts: number;
    eventsAtRisk: number;
  };
  alertTypes: Record<string, number>; // Count by alert type
}

interface WeatherAlertDetail {
  id: string;
  eventType: string;
  eventDate: string;
  eventTime?: string;
  locationName: string;
  alertType: 'precipitation' | 'high_wind' | 'extreme_temperature' | 'storm_warning' | 'air_quality' | 'uv_index' | 'forecast_change' | 'severe_weather';
  severity: 'low' | 'medium' | 'high' | 'severe';
  title: string;
  message: string;
  weatherConditions: any;
  recommendedActions: string[];
  isActive: boolean;
  acknowledgedAt?: string;
  alertSentAt: string;
  alertExpiresAt?: string;
  timeUntilEvent: string; // "2 days", "6 hours", etc.
  affectedServices: string[]; // Which vendors/services might be affected
}

// POST /api/weather/alerts/{alertId}/acknowledge
// Acknowledge and dismiss a weather alert
interface AcknowledgeAlertRequest {
  actionTaken?: string;
  notes?: string;
  notifyVendors?: boolean;
}

interface AcknowledgeAlertResponse {
  alert: WeatherAlertDetail;
  acknowledged: boolean;
  vendorsNotified?: number;
}

// POST /api/weather/tracking
// Add weather tracking for wedding event
interface CreateWeatherTrackingRequest {
  eventType: 'ceremony' | 'reception' | 'engagement_shoot' | 'bridal_photos' | 'rehearsal' | 'welcome_party' | 'send_off' | 'vendor_setup';
  eventDate: string;
  eventTime?: string;
  eventDurationHours?: number;
  location: {
    coordinates: {
      lat: number;
      lng: number;
    };
    name?: string;
    address?: string;
  };
  isOutdoor: boolean;
  hasBackupPlan?: boolean;
  backupPlanDetails?: string;
  weatherSensitivity: 'low' | 'medium' | 'high';
  alertThresholds?: {
    precipitationChance?: number;
    windSpeedKph?: number;
    temperatureLow?: number;
    temperatureHigh?: number;
  };
}

interface CreateWeatherTrackingResponse {
  tracking: WeatherTracking;
  initialForecast: WeatherForecastResponse;
  alertsGenerated: number;
}

interface WeatherTracking {
  id: string;
  eventType: string;
  eventDate: string;
  eventTime?: string;
  eventDurationHours: number;
  locationName?: string;
  locationAddress?: string;
  isOutdoor: boolean;
  hasBackupPlan: boolean;
  backupPlanDetails?: string;
  weatherSensitivity: string;
  monitoringEnabled: boolean;
  alertThresholds: any;
  currentForecast?: DailyForecast;
  activeAlerts: number;
  createdAt: string;
  updatedAt: string;
}
```

**3. Historical Weather & Analytics**
```typescript
// GET /api/weather/historical
// Get historical weather data for location and date range
interface WeatherHistoricalRequest {
  latitude: number;
  longitude: number;
  startDate: string; // ISO date
  endDate: string; // ISO date
  includeHourly?: boolean;
  units?: 'metric' | 'imperial';
}

interface WeatherHistoricalResponse {
  location: {
    name: string;
    coordinates: {
      lat: number;
      lng: number;
    };
  };
  dateRange: {
    start: string;
    end: string;
    totalDays: number;
  };
  dailyData: HistoricalWeatherDay[];
  summary: WeatherSummary;
  patterns: WeatherPatterns;
}

interface HistoricalWeatherDay {
  date: string;
  temperature: {
    min: number;
    max: number;
    average: number;
  };
  humidity: {
    min: number;
    max: number;
    average: number;
  };
  precipitation: {
    amount: number;
    hours: number;
    type: 'none' | 'rain' | 'snow' | 'mixed';
  };
  wind: {
    maxSpeed: number;
    averageSpeed: number;
    direction: number;
  };
  condition: WeatherCondition;
  weddingSuitability: WeddingWeatherRating;
}

interface WeatherSummary {
  averageTemperature: number;
  totalPrecipitation: number;
  rainyDays: number;
  clearDays: number;
  windyDays: number;
  bestWeddingDays: string[];
  worstWeddingDays: string[];
}

interface WeatherPatterns {
  seasonalTrends: {
    temperature: 'warming' | 'cooling' | 'stable';
    precipitation: 'increasing' | 'decreasing' | 'stable';
  };
  typicalConditions: WeatherCondition[];
  riskFactors: string[];
  recommendations: string[];
}

// POST /api/weather/analytics
// Get weather analytics and recommendations for wedding planning
interface WeatherAnalyticsRequest {
  eventDate: string;
  location: {
    lat: number;
    lng: number;
  };
  eventType: string;
  analysisPeriod?: number; // Days to analyze (default: 30)
}

interface WeatherAnalyticsResponse {
  eventAnalysis: {
    eventDate: string;
    daysUntilEvent: number;
    forecastReliability: 'high' | 'medium' | 'low';
    currentForecast: DailyForecast;
    forecastTrend: 'improving' | 'stable' | 'deteriorating';
  };
  historicalContext: {
    sameMonthAverage: WeatherSummary;
    similarDaysInHistory: HistoricalWeatherDay[];
    climateNorms: any;
  };
  riskAssessment: {
    precipitationRisk: 'low' | 'medium' | 'high';
    temperatureRisk: 'low' | 'medium' | 'high';
    windRisk: 'low' | 'medium' | 'high';
    overallRisk: 'low' | 'medium' | 'high';
  };
  recommendations: {
    timing: string[];
    preparation: string[];
    backup: string[];
    vendor: string[];
  };
}
```

#### Frontend Components Required

**1. Weather Dashboard**
```typescript
// src/components/weather/WeatherDashboard.tsx
import React, { useState, useEffect } from 'react';
import { useWeatherForecast } from '@/hooks/useWeatherForecast';
import { useWeatherAlerts } from '@/hooks/useWeatherAlerts';
import { WeatherForecast } from './WeatherForecast';
import { WeatherAlerts } from './WeatherAlerts';
import { WeatherTimeline } from './WeatherTimeline';

interface WeatherDashboardProps {
  weddingEvents: WeddingEvent[];
  primaryLocation: {
    lat: number;
    lng: number;
    name: string;
  };
  onCreateTracking?: (event: WeddingEvent) => void;
}

interface WeddingEvent {
  id: string;
  type: string;
  date: string;
  time?: string;
  location: {
    lat: number;
    lng: number;
    name: string;
  };
  isOutdoor: boolean;
}

export function WeatherDashboard({
  weddingEvents,
  primaryLocation,
  onCreateTracking
}: WeatherDashboardProps) {
  const [selectedEvent, setSelectedEvent] = useState<WeddingEvent | null>(null);
  const [timeRange, setTimeRange] = useState<'3days' | '7days' | '15days'>('7days');

  const {
    forecast,
    isLoading: forecastLoading,
    error: forecastError,
    refreshForecast
  } = useWeatherForecast({
    latitude: primaryLocation.lat,
    longitude: primaryLocation.lng,
    days: timeRange === '3days' ? 3 : timeRange === '7days' ? 7 : 15,
    includeHourly: true,
    includeAlerts: true
  });

  const {
    alerts,
    summary: alertsSummary,
    isLoading: alertsLoading,
    acknowledgeAlert,
    refreshAlerts
  } = useWeatherAlerts();

  const upcomingEvents = weddingEvents
    .filter(event => new Date(event.date) >= new Date())
    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
    .slice(0, 5);

  const getWeatherRiskLevel = (event: WeddingEvent) => {
    if (!forecast?.forecast) return 'unknown';
    
    const eventForecast = forecast.forecast.find(day => 
      day.date === event.date
    );
    
    if (!eventForecast) return 'unknown';
    
    return eventForecast.weddingRating.overall;
  };

  const getRiskColor = (risk: string) => {
    switch (risk) {
      case 'excellent': return 'text-green-600 bg-green-50';
      case 'good': return 'text-green-600 bg-green-50';
      case 'fair': return 'text-yellow-600 bg-yellow-50';
      case 'poor': return 'text-orange-600 bg-orange-50';
      case 'unsuitable': return 'text-red-600 bg-red-50';
      default: return 'text-gray-600 bg-gray-50';
    }
  };

  if (forecastLoading || alertsLoading) {
    return <div className="animate-pulse">Loading weather dashboard...</div>;
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold text-gray-900">Weather Dashboard</h2>
          <p className="text-gray-600 mt-1">
            Monitor weather conditions for your wedding events
          </p>
        </div>
        
        <div className="flex items-center space-x-4">
          <select
            value={timeRange}
            onChange={(e) => setTimeRange(e.target.value as any)}
            className="px-3 py-2 border border-gray-300 rounded-md text-sm"
          >
            <option value="3days">3 Days</option>
            <option value="7days">7 Days</option>
            <option value="15days">15 Days</option>
          </select>
          
          <button
            onClick={refreshForecast}
            className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm"
          >
            Refresh
          </button>
        </div>
      </div>

      {/* Alerts Summary */}
      {alertsSummary && alertsSummary.activeAlerts > 0 && (
        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center">
              <div className="flex-shrink-0">
                <span className="text-2xl">⚠️</span>
              </div>
              <div className="ml-3">
                <h3 className="text-sm font-medium text-yellow-800">
                  Weather Alerts Active
                </h3>
                <div className="mt-2 text-sm text-yellow-700">
                  <p>
                    {alertsSummary.activeAlerts} active alert{alertsSummary.activeAlerts !== 1 ? 's' : ''} 
                    {alertsSummary.highSeverityAlerts > 0 && (
                      <span className="font-medium">
                        , {alertsSummary.highSeverityAlerts} high severity
                      </span>
                    )}
                  </p>
                </div>
              </div>
            </div>
            <button
              onClick={refreshAlerts}
              className="text-yellow-600 hover:text-yellow-800 text-sm"
            >
              View All Alerts
            </button>
          </div>
        </div>
      )}

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Main Weather Forecast */}
        <div className="lg:col-span-2">
          <WeatherForecast 
            forecast={forecast}
            location={primaryLocation}
            events={weddingEvents}
            selectedEvent={selectedEvent}
            onEventSelect={setSelectedEvent}
          />
        </div>

        {/* Sidebar */}
        <div className="space-y-6">
          {/* Upcoming Events */}
          <div className="bg-white border border-gray-200 rounded-lg p-4">
            <h3 className="text-lg font-semibold text-gray-900 mb-4">
              Upcoming Events
            </h3>
            
            <div className="space-y-3">
              {upcomingEvents.map((event) => {
                const risk = getWeatherRiskLevel(event);
                const riskColor = getRiskColor(risk);
                
                return (
                  <div 
                    key={event.id}
                    className="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer"
                    onClick={() => setSelectedEvent(event)}
                  >
                    <div>
                      <div className="font-medium text-gray-900 text-sm">
                        {event.type.replace('_', ' ').toUpperCase()}
                      </div>
                      <div className="text-xs text-gray-600">
                        {new Date(event.date).toLocaleDateString()}
                        {event.time && ` at ${event.time}`}
                      </div>
                      <div className="text-xs text-gray-500">
                        {event.location.name}
                      </div>
                    </div>
                    
                    <div className="text-right">
                      {event.isOutdoor && (
                        <div className="text-xs text-gray-500 mb-1">Outdoor</div>
                      )}
                      <div className={`text-xs px-2 py-1 rounded-full ${riskColor}`}>
                        {risk.replace('_', ' ')}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>

            {upcomingEvents.length === 0 && (
              <div className="text-center py-4 text-gray-500 text-sm">
                No upcoming events to track
              </div>
            )}
          </div>

          {/* Current Conditions */}
          {forecast?.current && (
            <div className="bg-white border border-gray-200 rounded-lg p-4">
              <h3 className="text-lg font-semibold text-gray-900 mb-4">
                Current Conditions
              </h3>
              
              <div className="space-y-3">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-600">Temperature</span>
                  <span className="font-medium">
                    {Math.round(forecast.current.temperature)}°
                  </span>
                </div>
                
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-600">Feels like</span>
                  <span className="font-medium">
                    {Math.round(forecast.current.feelsLike)}°
                  </span>
                </div>
                
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-600">Humidity</span>
                  <span className="font-medium">
                    {forecast.current.humidity}%
                  </span>
                </div>
                
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-600">Wind</span>
                  <span className="font-medium">
                    {Math.round(forecast.current.windSpeed)} km/h
                  </span>
                </div>
                
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-600">Rain chance</span>
                  <span className="font-medium">
                    {forecast.current.precipitationChance}%
                  </span>
                </div>
                
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-600">UV Index</span>
                  <span className={`font-medium ${
                    forecast.current.uvIndex <= 2 ? 'text-green-600' :
                    forecast.current.uvIndex <= 5 ? 'text-yellow-600' :
                    forecast.current.uvIndex <= 7 ? 'text-orange-600' :
                    'text-red-600'
                  }`}>
                    {forecast.current.uvIndex} 
                    {forecast.current.uvIndex <= 2 ? ' Low' :
                     forecast.current.uvIndex <= 5 ? ' Moderate' :
                     forecast.current.uvIndex <= 7 ? ' High' :
                     ' Very High'
                    }
                  </span>
                </div>
              </div>

              <div className="mt-4 pt-4 border-t border-gray-200">
                <div className="text-sm text-gray-600 mb-2">Condition</div>
                <div className="flex items-center">
                  <span className="text-2xl mr-2">
                    {forecast.current.condition.icon}
                  </span>
                  <span className="font-medium">
                    {forecast.current.condition.description}
                  </span>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Weather Timeline */}
      {selectedEvent && (
        <div className="bg-white border border-gray-200 rounded-lg p-6">
          <WeatherTimeline
            event={selectedEvent}
            forecast={forecast}
            onCreateTracking={onCreateTracking}
          />
        </div>
      )}

      {/* Alerts Details */}
      {alerts && alerts.length > 0 && (
        <WeatherAlerts
          alerts={alerts}
          onAcknowledgeAlert={acknowledgeAlert}
        />
      )}
    </div>
  );
}
```

**2. Weather Forecast Hook**
```typescript
// src/hooks/useWeatherForecast.ts
import { useState, useEffect, useCallback } from 'react';

interface WeatherForecastOptions {
  latitude: number;
  longitude: number;
  locationName?: string;
  days?: number;
  units?: 'metric' | 'imperial';
  includeHourly?: boolean;
  includeAlerts?: boolean;
}

export function useWeatherForecast(options: WeatherForecastOptions) {
  const [forecast, setForecast] = useState<WeatherForecastResponse | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);

  const fetchForecast = useCallback(async () => {
    if (!options.latitude || !options.longitude) {
      return;
    }

    setIsLoading(true);
    setError(null);

    try {
      const params = new URLSearchParams({
        latitude: options.latitude.toString(),
        longitude: options.longitude.toString(),
        days: (options.days || 7).toString(),
        units: options.units || 'metric',
        includeHourly: (options.includeHourly || false).toString(),
        includeAlerts: (options.includeAlerts || false).toString()
      });

      if (options.locationName) {
        params.append('locationName', options.locationName);
      }

      const response = await fetch(`/api/weather/forecast?${params}`);
      
      if (!response.ok) {
        throw new Error('Failed to fetch weather forecast');
      }

      const data = await response.json();
      setForecast(data);
      setLastUpdated(new Date());

    } catch (err) {
      setError(err instanceof Error ? err.message : 'Weather fetch failed');
    } finally {
      setIsLoading(false);
    }
  }, [options]);

  useEffect(() => {
    fetchForecast();
  }, [fetchForecast]);

  // Auto-refresh every 30 minutes
  useEffect(() => {
    const interval = setInterval(() => {
      if (!isLoading) {
        fetchForecast();
      }
    }, 30 * 60 * 1000); // 30 minutes

    return () => clearInterval(interval);
  }, [fetchForecast, isLoading]);

  const getEventForecast = useCallback((eventDate: string) => {
    if (!forecast?.forecast) return null;
    
    return forecast.forecast.find(day => day.date === eventDate);
  }, [forecast]);

  const getHourlyForecast = useCallback((date: string, startHour?: number, endHour?: number) => {
    if (!forecast?.hourlyForecast) return [];

    return forecast.hourlyForecast.filter(hour => {
      const hourDate = hour.datetime.split('T')[0];
      if (hourDate !== date) return false;
      
      if (startHour !== undefined || endHour !== undefined) {
        const hourTime = new Date(hour.datetime).getHours();
        if (startHour !== undefined && hourTime < startHour) return false;
        if (endHour !== undefined && hourTime > endHour) return false;
      }
      
      return true;
    });
  }, [forecast]);

  return {
    forecast,
    isLoading,
    error,
    lastUpdated,
    refreshForecast: fetchForecast,
    getEventForecast,
    getHourlyForecast
  };
}
```

### TESTING REQUIREMENTS

#### Unit Tests
- Weather API client methods and error handling
- Weather data caching and expiration logic
- Alert threshold calculations and triggering
- Weather rating algorithms for wedding suitability
- Historical weather data processing

#### Integration Tests
- Complete weather API integration with multiple providers
- Alert generation and notification system
- Weather tracking creation and management
- Historical data retrieval and analysis
- Forecast accuracy tracking

#### E2E Tests
- Weather dashboard user experience
- Alert acknowledgment workflow
- Event weather tracking setup
- Forecast display and interaction
- Weather recommendations and planning

### DEPENDENCIES & EFFORT ESTIMATE

#### Dependencies
- **Weather API Provider** - OpenWeatherMap, WeatherAPI, or similar service
- **Geolocation Services** - Coordinate-based weather lookups
- **Notification System** - Email/SMS alerts for weather changes
- **Wedding Event System** - Integration with ceremony/reception data

#### Effort Estimate: 14 development days
- **Weather API Integration**: 3 days
- **Forecast & Alert Components**: 4 days  
- **Weather Tracking System**: 3 days
- **Alert Generation & Notifications**: 2 days
- **Historical Data & Analytics**: 2 days

#### Risk Factors
- **Medium:** Weather API reliability and accuracy
- **Medium:** Alert threshold tuning and false positives
- **Low:** Caching strategy for API rate limits
- **Low:** Weather data interpretation for wedding context

### SUCCESS CRITERIA
1. Weather forecasts display within 2 seconds for cached locations
2. Alerts generate automatically based on configured thresholds
3. Wedding suitability ratings provide actionable insights
4. Historical weather context helps with planning decisions
5. Alert acknowledgment prevents duplicate notifications
6. Forecast accuracy improves decision-making confidence
7. API usage stays within daily quota limits
8. Weather recommendations are contextually relevant for weddings