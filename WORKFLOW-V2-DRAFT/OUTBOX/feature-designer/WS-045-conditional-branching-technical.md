# TECHNICAL SPECIFICATION: WS-045 - Conditional Branching
## Generated by Feature Development Session - 2025-08-21

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer who needs different workflows for different wedding types
**I want to:** Create journey branches based on client data (destination vs local, package type, guest count)
**So that:** Destination couples get travel coordination emails while local couples get venue-specific timelines automatically

**Real Wedding Scenario:**
A photographer's journey splits based on package type: Premium couples ($5k+) get 3 engagement session reminders and custom timeline creation, while Basic couples ($2k) get standard timelines and 1 engagement reminder. The system automatically routes clients down the correct path based on their package field.

### SPECIFICATION SOURCE
- **Feature ID:** WS-045
- **Original Spec:** /CORE-SPECIFICATIONS/02-WEDSYNC-SUPPLIER-PLATFORM/05-Customer-Journey/04-conditional-branching md.md
- **Current Implementation:** 0% complete

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Conditional rules for branching
CREATE TABLE IF NOT EXISTS journey_conditions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  node_id UUID REFERENCES journey_nodes(id) ON DELETE CASCADE,
  condition_type TEXT NOT NULL, -- 'field_value', 'date_range', 'tag_present', 'custom'
  field_name TEXT NOT NULL,
  operator TEXT NOT NULL, -- 'equals', 'contains', 'greater_than', 'less_than'
  condition_value TEXT NOT NULL,
  branch_label TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Branch paths from condition nodes
CREATE TABLE IF NOT EXISTS journey_branches (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  condition_id UUID REFERENCES journey_conditions(id) ON DELETE CASCADE,
  target_node_id UUID REFERENCES journey_nodes(id) ON DELETE CASCADE,
  is_default_branch BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### Frontend Components Required
```typescript
// Component: ConditionalNode
interface ConditionalNodeProps {
  node: JourneyNode;
  conditions: JourneyCondition[];
  branches: JourneyBranch[];
  onConditionsChange: (conditions: JourneyCondition[]) => void;
}

// Key functionality:
- Visual branching with multiple outputs
- Condition builder interface
- Branch path visualization
- Test condition with sample data
- Default/fallback branch handling
```

### ACCEPTANCE CRITERIA
- [x] Create conditional branches based on client field values
- [x] Support multiple condition types (equals, contains, greater than)
- [x] Visual representation of branching paths
- [x] Test conditions with sample client data
- [x] Performance: Condition evaluation in <50ms
- [x] Security: Conditions respect field access permissions
- [x] Accessibility: Condition builder keyboard accessible

### DEPENDENCIES
- Must complete after: WS-043 (Journey Canvas), WS-044 (Timeline Nodes)
- Must complete before: None (completes journey system)
- Shares code with: Journey execution engine, condition evaluation

### ESTIMATED EFFORT
- Team A Frontend: 14 hours
- Team B Backend: 12 hours
- Team C Integration: 8 hours
- Total: 34 hours