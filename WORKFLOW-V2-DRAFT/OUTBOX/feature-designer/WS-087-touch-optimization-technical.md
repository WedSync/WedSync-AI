# TECHNICAL SPECIFICATION: WS-087 - Touch Optimization
## Generated by Feature Development Session - 2025-08-22

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer working one-handed while carrying equipment
**I want to:** Easily tap buttons and swipe through interfaces with my thumb
**So that:** I can quickly update shot lists and mark completed photos without fumbling with my phone

**Real Wedding Scenario:**
A wedding photographer holding a camera in one hand needs to mark shots as completed on their phone during the ceremony. With touch optimization, all buttons are thumb-friendly sized and positioned within easy reach, allowing them to track progress without disrupting the ceremony flow.

### SPECIFICATION SOURCE
- **Feature ID:** WS-087
- **Original Spec:** /CORE-SPECIFICATIONS/09-MOBILE-OPTIMIZATION/04-touch-optimization md.md
- **Current Implementation:** 0% complete
- **Files to Modify:** 
  - /wedsync/src/styles/globals.css
  - /wedsync/src/components/ui/*.tsx (all UI components)
  - /wedsync/src/components/navigation/MobileNavigation.tsx
- **New Files to Create:** 
  - /wedsync/src/hooks/useGestures.tsx
  - /wedsync/src/hooks/useTouchFeedback.tsx
  - /wedsync/src/components/touch/PullToRefresh.tsx

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Touch interaction analytics
CREATE TABLE touch_interactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id),
  action_type TEXT NOT NULL, -- tap, swipe, pinch, scroll
  target_element TEXT,
  touch_duration INTEGER, -- milliseconds
  device_type TEXT,
  screen_size TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- User interface preferences
CREATE TABLE ui_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  large_touch_targets BOOLEAN DEFAULT false,
  haptic_feedback BOOLEAN DEFAULT true,
  gesture_shortcuts BOOLEAN DEFAULT true,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### API Endpoints Required
```typescript
// POST /api/analytics/touch
interface TouchAnalyticsRequest {
  actionType: 'tap' | 'swipe' | 'pinch' | 'scroll';
  targetElement: string;
  duration: number;
  deviceInfo: DeviceInfo;
}

// GET /api/user/ui-preferences
interface UIPreferencesResponse {
  largeTargets: boolean;
  hapticEnabled: boolean;
  gesturesEnabled: boolean;
}
```

#### Frontend Components Required
```typescript
// Component: TouchOptimizedButton
// Location: /src/components/ui/TouchButton.tsx

interface TouchButtonProps {
  size: 'small' | 'medium' | 'large' | 'wedding-day';
  hapticFeedback?: boolean;
  rippleEffect?: boolean;
  children: React.ReactNode;
}

// Key functionality:
- Minimum 48px touch target
- Visual and haptic feedback
- Gesture recognition
- Accessibility compliance
```

#### Integration Points
```typescript
// Service: TouchService
// Dependencies: Device detection, Analytics, Preferences

class TouchService {
  async optimizeForDevice() {
    // Adjust touch targets based on device
  }
  
  async trackTouchInteraction() {
    // Analytics for touch usage
  }
  
  async applyUserPreferences() {
    // Load and apply UI preferences
  }
}
```

### CODE EXAMPLES

#### Example 1: Touch-Optimized Component
```typescript
// TouchOptimizedInput.tsx
import { useState, useRef } from 'react';
import { useTouchFeedback } from '@/hooks/useTouchFeedback';

export const TouchInput: React.FC<InputProps> = ({ label, ...props }) => {
  const { triggerHaptic } = useTouchFeedback();
  
  return (
    <div className="touch-input-wrapper">
      <label className="text-base font-medium mb-2 block">
        {label}
      </label>
      <input
        className="w-full h-14 px-4 text-base rounded-lg border-2
                   border-gray-300 focus:border-primary-500
                   transition-colors duration-200"
        style={{
          fontSize: '16px', // Prevents zoom on iOS
          WebkitAppearance: 'none'
        }}
        onFocus={() => triggerHaptic('light')}
        {...props}
      />
    </div>
  );
};
```

#### Example 2: Gesture Recognition Hook
```typescript
// useGestures.tsx
export const useSwipeNavigation = () => {
  const router = useRouter();
  const touchStart = useRef<{ x: number; y: number } | null>(null);

  const handleTouchStart = (e: TouchEvent) => {
    touchStart.current = {
      x: e.touches[0].clientX,
      y: e.touches[0].clientY
    };
  };

  const handleTouchEnd = (e: TouchEvent) => {
    if (!touchStart.current) return;

    const deltaX = e.changedTouches[0].clientX - touchStart.current.x;
    const deltaY = e.changedTouches[0].clientY - touchStart.current.y;

    // Horizontal swipe detection
    if (Math.abs(deltaX) > 50 && Math.abs(deltaY) < 50) {
      if (deltaX > 0) {
        router.back(); // Swipe right - go back
      }
    }
  };

  return { handleTouchStart, handleTouchEnd };
};
```

### MCP SERVER USAGE

#### Required MCP Servers
- [x] Context7: Load docs for React touch libraries
- [x] Playwright: Test touch interactions and gestures
- [x] Filesystem: Access touch-related component files

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/react/docs", "touch events", 2000);
await mcp__context7__get-library-docs("/framer-motion/docs", "gestures", 1500);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('Touch Optimization', () => {
  it('should have minimum 48px touch targets', () => {
    cy.get('.touch-target').each(($el) => {
      expect($el.height()).to.be.at.least(48);
      expect($el.width()).to.be.at.least(48);
    });
  });
  
  it('should prevent zoom on input focus', () => {
    cy.get('input').each(($input) => {
      const fontSize = window.getComputedStyle($input[0]).fontSize;
      expect(parseInt(fontSize)).to.be.at.least(16);
    });
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test('Touch Gestures', async () => {
  await mcp__playwright__browser_navigate({url: '/dashboard'});
  
  // Test swipe navigation
  await page.touchscreen.tap(200, 300);
  await page.mouse.move(200, 300);
  await page.mouse.down();
  await page.mouse.move(400, 300);
  await page.mouse.up();
  
  // Verify navigation occurred
  await mcp__playwright__browser_snapshot();
});
```

### ACCEPTANCE CRITERIA
- [x] All interactive elements have 48px minimum touch target
- [x] Swipe gestures work smoothly without lag
- [x] Pull-to-refresh functions on data lists  
- [x] Haptic feedback triggers on button presses
- [x] Form inputs don't trigger zoom on iOS
- [x] Performance: Touch response time <100ms
- [x] Security: Touch events don't leak sensitive data
- [x] Accessibility: Touch targets work with screen readers

### DEPENDENCIES
- Must complete after: WS-086 (PWA Configuration)
- Must complete before: WS-088 (Authentication Security)
- Shares code with: All UI components, Navigation system

### ESTIMATED EFFORT
- Team A Frontend: 16 hours
- Team B Backend: 4 hours
- Team C Integration: 6 hours
- Total: 26 hours