# TECHNICAL SPECIFICATION: WS-104 - Performance Monitoring
## Generated by Feature Development Session - August 22, 2025

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer reviewing photos with a couple during their final planning meeting
**I want to:** Upload and preview 200 wedding images quickly without delays or crashes
**So that:** We can finalize the shot list without frustrating delays that could impact their wedding day confidence

**Real Wedding Scenario:**
A photographer meets with a couple 2 days before their wedding to review 200 sample photos for their shot list. The image upload takes 45 seconds instead of the expected 10 seconds, and the gallery preview is sluggish. Performance monitoring detects the p95 response time is 3.2 seconds (above the 1 second threshold) and immediately alerts developers. The slow database query causing image processing delays is identified and optimized within 30 minutes, ensuring smooth operation for all weekend weddings.

### SPECIFICATION SOURCE
- **Feature ID:** WS-104
- **Original Spec:** /CORE-SPECIFICATIONS/11-TESTING-DEPLOYMENT/03-Monitoring/02-performance-monitoring md.md
- **Current Implementation:** 0% complete
- **Files to Modify:**
  - `/wedsync/lib/web-vitals.ts` (create new)
  - `/wedsync/middleware.ts` (enhance existing)
- **New Files to Create:**
  - `/wedsync/lib/db-monitoring.ts`
  - `/wedsync/app/admin/performance/page.tsx`
  - `/wedsync/app/api/analytics/vitals/route.ts`
  - `/wedsync/lib/monitoring/performance-alerts.ts`
  - `/wedsync/performance-budget.json`
  - `/wedsync/lib/monitoring/real-user-monitoring.ts`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Web vitals and performance metrics storage
CREATE TABLE IF NOT EXISTS performance_metrics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  metric_name VARCHAR(50) NOT NULL, -- 'LCP', 'FID', 'CLS', 'FCP', 'TTFB', 'INP'
  metric_value DECIMAL(10,4) NOT NULL,
  metric_id VARCHAR(255) NOT NULL,
  page_path VARCHAR(255) NOT NULL,
  user_id UUID REFERENCES auth.users(id),
  user_agent TEXT,
  connection_type VARCHAR(50), -- '4g', 'wifi', 'ethernet'
  device_type VARCHAR(50), -- 'mobile', 'tablet', 'desktop'
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_performance_metrics_name_time ON performance_metrics(metric_name, timestamp DESC);
CREATE INDEX idx_performance_metrics_page ON performance_metrics(page_path, timestamp DESC);
CREATE INDEX idx_performance_metrics_user ON performance_metrics(user_id, timestamp DESC);

-- API performance tracking
CREATE TABLE IF NOT EXISTS api_performance (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  endpoint VARCHAR(255) NOT NULL,
  method VARCHAR(10) NOT NULL,
  response_time INTEGER NOT NULL, -- milliseconds
  status_code INTEGER NOT NULL,
  user_id UUID REFERENCES auth.users(id),
  request_size INTEGER, -- bytes
  response_size INTEGER, -- bytes
  error_message TEXT,
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_api_performance_endpoint ON api_performance(endpoint, timestamp DESC);
CREATE INDEX idx_api_performance_slow ON api_performance(response_time DESC) WHERE response_time > 1000;

-- Database query performance
CREATE TABLE IF NOT EXISTS db_query_metrics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  query_name VARCHAR(255) NOT NULL,
  query_type VARCHAR(50), -- 'select', 'insert', 'update', 'delete'
  execution_time INTEGER NOT NULL, -- milliseconds
  rows_affected INTEGER,
  table_name VARCHAR(100),
  is_slow BOOLEAN DEFAULT false,
  error_message TEXT,
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_db_query_metrics_name ON db_query_metrics(query_name, timestamp DESC);
CREATE INDEX idx_db_query_metrics_slow ON db_query_metrics(execution_time DESC) WHERE is_slow = true;

-- Performance alerts and thresholds
CREATE TABLE IF NOT EXISTS performance_alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  alert_type VARCHAR(50) NOT NULL, -- 'web_vitals', 'api_performance', 'db_performance'
  metric_name VARCHAR(50) NOT NULL,
  threshold_value DECIMAL(10,4) NOT NULL,
  current_value DECIMAL(10,4) NOT NULL,
  duration_minutes INTEGER NOT NULL,
  resolved_at TIMESTAMP WITH TIME ZONE NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Wedding-specific performance tracking
CREATE TABLE IF NOT EXISTS wedding_performance_context (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  metric_id UUID REFERENCES performance_metrics(id),
  client_id UUID REFERENCES clients(id),
  vendor_type VARCHAR(50),
  wedding_date DATE,
  business_impact VARCHAR(20) CHECK (business_impact IN ('low', 'medium', 'high', 'critical')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### API Endpoints Required
```typescript
// POST /api/analytics/vitals
interface WebVitalsRequest {
  metric: 'CLS' | 'FID' | 'FCP' | 'LCP' | 'TTFB' | 'INP';
  value: number;
  id: string;
  page: string;
  timestamp: number;
  deviceType?: string;
  connectionType?: string;
}

interface WebVitalsResponse {
  success: boolean;
  stored: boolean;
}

// GET /api/admin/performance/metrics
interface PerformanceMetricsResponse {
  webVitals: {
    current: Record<string, number>;
    trends: Array<{ timestamp: string; values: Record<string, number> }>;
    budgetStatus: Record<string, 'pass' | 'warn' | 'fail'>;
  };
  apiPerformance: {
    p50: number;
    p95: number;
    p99: number;
    errorRate: number;
    slowestEndpoints: Array<{ endpoint: string; avgTime: number }>;
  };
  dbPerformance: {
    slowQueries: number;
    avgQueryTime: number;
    topSlowQueries: Array<{ queryName: string; avgTime: number; count: number }>;
  };
  timestamp: string;
}

// GET /api/admin/performance/real-time
// Server-Sent Events for real-time performance data
interface RealTimePerformanceEvent {
  type: 'webVitals' | 'apiPerformance' | 'dbQuery' | 'alert';
  data: any;
  timestamp: string;
}

// POST /api/monitoring/slow-query
interface SlowQueryReportRequest {
  queryName: string;
  duration: number;
  context?: Record<string, any>;
}

// GET /api/admin/performance/budgets
interface PerformanceBudgetResponse {
  budgets: Array<{
    path: string;
    metrics: Record<string, { budget: number; current: number; status: 'pass' | 'warn' | 'fail' }>;
  }>;
}
```

#### Frontend Components Required
```typescript
// Component: PerformanceDashboard
// Location: /src/app/admin/performance/page.tsx

interface Props {
  timeRange?: '1h' | '24h' | '7d' | '30d';
  realTime?: boolean;
}

// Key functionality:
- Real-time performance metrics display
- Web vitals trending charts
- API and database performance insights
- Performance budget status indicators
- Alert configuration and management

// Component: WebVitalsChart
// Location: /src/components/admin/WebVitalsChart.tsx

interface Props {
  metrics: Array<{ timestamp: string; values: Record<string, number> }>;
  budgets: Record<string, number>;
  timeRange: string;
}

// Key functionality:
- Interactive chart showing web vitals over time
- Budget threshold lines and status indicators
- Device type and page filtering
- Performance regression highlighting

// Component: ApiPerformanceTable
// Location: /src/components/admin/ApiPerformanceTable.tsx

interface Props {
  endpoints: Array<{ endpoint: string; method: string; stats: any }>;
  onDrillDown: (endpoint: string) => void;
}

// Key functionality:
- Sortable table of API endpoint performance
- Response time percentiles display
- Error rate indicators
- Slow endpoint highlighting

// Component: PerformanceAlerts
// Location: /src/components/admin/PerformanceAlerts.tsx

interface Props {
  alerts: PerformanceAlert[];
  onConfigureAlert: (alert: PerformanceAlert) => void;
}

// Key functionality:
- Active performance alerts display
- Alert configuration interface
- Threshold management
- Wedding impact assessment
```

#### Integration Points
```typescript
// Service: PerformanceMonitor
// Dependencies: Web Vitals API, database monitoring, alerting

class PerformanceMonitor {
  async trackWebVital(
    metric: string,
    value: number,
    context: PerformanceContext
  ): Promise<void> {
    // Store web vital measurement
    // Check against performance budgets
    // Trigger alerts if thresholds exceeded
    // Add wedding business context if applicable
  }
  
  async trackApiPerformance(
    endpoint: string,
    method: string,
    responseTime: number,
    statusCode: number
  ): Promise<void> {
    // Record API performance metrics
    // Calculate percentiles and trends
    // Alert on performance regressions
    // Track user impact for wedding-critical endpoints
  }
  
  async assessWeddingImpact(
    userId: string,
    performanceMetric: any
  ): Promise<WeddingImpact> {
    // Determine if performance issue affects active weddings
    // Calculate business impact based on wedding dates
    // Prioritize alerts for time-sensitive operations
  }
}

// Service: DatabaseMonitor
// Dependencies: Query performance tracking, alerting

class DatabaseMonitor {
  async monitorQuery<T>(
    queryName: string,
    queryFn: () => Promise<T>
  ): Promise<T> {
    // Execute query with performance tracking
    // Log slow queries and errors
    // Calculate query statistics
    // Alert on performance degradation
  }
  
  getQueryStats(queryName: string): QueryStats {
    // Return aggregated performance statistics
    // Include percentiles and trend analysis
    // Identify performance bottlenecks
  }
}

// Service: RealUserMonitoring
// Dependencies: Web vitals, user session tracking

class RealUserMonitoring {
  async initializeTracking(): Promise<void> {
    // Set up web vitals collection
    // Configure user session tracking
    // Implement performance observer
    // Send data to analytics endpoint
  }
  
  async trackUserJourney(
    userId: string,
    journey: UserJourney
  ): Promise<void> {
    // Track performance across user workflows
    // Identify friction points in wedding coordination
    // Measure feature adoption and success rates
  }
}

// Hook: usePerformanceMonitoring
export function usePerformanceMonitoring() {
  // Initialize web vitals tracking
  // Set up real-time performance monitoring
  // Handle performance degradation notifications
  // Provide performance debugging tools
}
```

### CODE EXAMPLES

#### Example 1: Web Vitals Tracking Implementation
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { onCLS, onFID, onFCP, onLCP, onTTFB, onINP } from 'web-vitals';

type MetricName = 'CLS' | 'FID' | 'FCP' | 'LCP' | 'TTFB' | 'INP';

interface WebVitalMetric {
  name: MetricName;
  value: number;
  id: string;
  delta?: number;
  navigationType?: string;
}

function sendToAnalytics(metric: WebVitalMetric) {
  // Gather additional context
  const context = {
    metric: metric.name,
    value: Math.round(metric.value),
    id: metric.id,
    page: window.location.pathname,
    timestamp: Date.now(),
    deviceType: getDeviceType(),
    connectionType: getConnectionType(),
    userAgent: navigator.userAgent,
    sessionId: getSessionId(),
  };
  
  // Send to our analytics endpoint
  fetch('/api/analytics/vitals', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(context),
  }).catch(error => {
    console.error('Failed to send web vital:', error);
  });
  
  // Also send to Vercel Analytics if available
  if (window.gtag) {
    window.gtag('event', metric.name, {
      value: Math.round(metric.value),
      metric_id: metric.id,
      metric_value: metric.value,
      metric_delta: metric.delta || 0,
      custom_map: {
        metric_name: metric.name,
        page_path: window.location.pathname,
      },
    });
  }
  
  // Check performance budgets
  checkPerformanceBudget(metric.name, metric.value);
}

function checkPerformanceBudget(metricName: string, value: number) {
  const budgets = {
    'LCP': 2500,
    'FID': 100,
    'CLS': 0.1,
    'FCP': 1800,
    'TTFB': 800,
    'INP': 200,
  };
  
  const budget = budgets[metricName];
  if (budget && value > budget) {
    console.warn(`Performance budget exceeded: ${metricName} = ${value} (budget: ${budget})`);
    
    // Send alert for budget violations
    fetch('/api/monitoring/budget-violation', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        metric: metricName,
        value: Math.round(value),
        budget,
        page: window.location.pathname,
        timestamp: Date.now(),
      }),
    });
  }
}

function getDeviceType(): string {
  const userAgent = navigator.userAgent;
  if (/tablet|ipad|playbook|silk/i.test(userAgent)) {
    return 'tablet';
  }
  if (/mobile|iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(userAgent)) {
    return 'mobile';
  }
  return 'desktop';
}

function getConnectionType(): string {
  const connection = (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection;
  return connection?.effectiveType || 'unknown';
}

function getSessionId(): string {
  let sessionId = sessionStorage.getItem('performance_session_id');
  if (!sessionId) {
    sessionId = crypto.randomUUID();
    sessionStorage.setItem('performance_session_id', sessionId);
  }
  return sessionId;
}

export function initWebVitals() {
  // Initialize all web vitals tracking
  onCLS(sendToAnalytics);
  onFID(sendToAnalytics);
  onFCP(sendToAnalytics);
  onLCP(sendToAnalytics);
  onTTFB(sendToAnalytics);
  onINP(sendToAnalytics);
  
  // Track additional performance metrics
  trackNavigationTiming();
  trackResourceTiming();
  
  console.log('Web Vitals tracking initialized');
}

function trackNavigationTiming() {
  if ('performance' in window && 'getEntriesByType' in performance) {
    const navigationEntry = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;
    
    if (navigationEntry) {
      const metrics = {
        dns: navigationEntry.domainLookupEnd - navigationEntry.domainLookupStart,
        tcp: navigationEntry.connectEnd - navigationEntry.connectStart,
        request: navigationEntry.responseStart - navigationEntry.requestStart,
        response: navigationEntry.responseEnd - navigationEntry.responseStart,
        dom: navigationEntry.domContentLoadedEventEnd - navigationEntry.domContentLoadedEventStart,
        load: navigationEntry.loadEventEnd - navigationEntry.loadEventStart,
      };
      
      fetch('/api/analytics/navigation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...metrics,
          page: window.location.pathname,
          timestamp: Date.now(),
        }),
      });
    }
  }
}

function trackResourceTiming() {
  if ('performance' in window) {
    const observer = new PerformanceObserver((list) => {
      const entries = list.getEntries();
      const slowResources = entries.filter(entry => entry.duration > 1000);
      
      if (slowResources.length > 0) {
        fetch('/api/analytics/slow-resources', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            resources: slowResources.map(resource => ({
              name: resource.name,
              duration: resource.duration,
              size: (resource as any).transferSize || 0,
            })),
            page: window.location.pathname,
            timestamp: Date.now(),
          }),
        });
      }
    });
    
    observer.observe({ entryTypes: ['resource'] });
  }
}
```

#### Example 2: Performance Dashboard Component
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

interface PerformanceMetrics {
  webVitals: {
    current: Record<string, number>;
    trends: Array<{ timestamp: string; values: Record<string, number> }>;
    budgetStatus: Record<string, 'pass' | 'warn' | 'fail'>;
  };
  apiPerformance: {
    p50: number;
    p95: number;
    p99: number;
    errorRate: number;
    slowestEndpoints: Array<{ endpoint: string; avgTime: number }>;
  };
  dbPerformance: {
    slowQueries: number;
    avgQueryTime: number;
    topSlowQueries: Array<{ queryName: string; avgTime: number; count: number }>;
  };
}

export function PerformanceDashboard() {
  const [metrics, setMetrics] = useState<PerformanceMetrics | null>(null);
  const [loading, setLoading] = useState(true);
  const [timeRange, setTimeRange] = useState<'1h' | '24h' | '7d'>('24h');
  
  useEffect(() => {
    fetchMetrics();
    
    // Set up real-time updates
    const eventSource = new EventSource(`/api/admin/performance/real-time?range=${timeRange}`);
    
    eventSource.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'metrics_update') {
        setMetrics(data.payload);
      }
    };
    
    eventSource.onerror = (error) => {
      console.error('Performance monitoring connection error:', error);
    };
    
    return () => {
      eventSource.close();
    };
  }, [timeRange]);
  
  const fetchMetrics = async () => {
    try {
      const response = await fetch(`/api/admin/performance/metrics?range=${timeRange}`);
      const data = await response.json();
      setMetrics(data);
    } catch (error) {
      console.error('Failed to fetch performance metrics:', error);
    } finally {
      setLoading(false);
    }
  };
  
  const getBudgetStatusColor = (status: string) => {
    switch (status) {
      case 'pass': return 'bg-green-500';
      case 'warn': return 'bg-yellow-500';
      case 'fail': return 'bg-red-500';
      default: return 'bg-gray-500';
    }
  };
  
  const formatMetricValue = (metric: string, value: number) => {
    switch (metric) {
      case 'CLS':
        return value.toFixed(3);
      case 'LCP':
      case 'FCP':
      case 'TTFB':
      case 'FID':
      case 'INP':
        return `${Math.round(value)}ms`;
      default:
        return value.toString();
    }
  };
  
  if (loading) return <div>Loading performance data...</div>;
  if (!metrics) return <div>Failed to load performance data</div>;
  
  return (
    <div className="space-y-6 p-6">
      {/* Time Range Selector */}
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-bold">Performance Monitoring</h1>
        <div className="flex space-x-2">
          {['1h', '24h', '7d'].map(range => (
            <button
              key={range}
              onClick={() => setTimeRange(range as any)}
              className={`px-3 py-1 rounded ${
                timeRange === range 
                  ? 'bg-blue-500 text-white' 
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              {range}
            </button>
          ))}
        </div>
      </div>
      
      {/* Web Vitals Overview */}
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
        {Object.entries(metrics.webVitals.current).map(([metric, value]) => (
          <Card key={metric}>
            <CardHeader className="pb-2">
              <div className="flex items-center justify-between">
                <CardTitle className="text-sm font-medium">{metric}</CardTitle>
                <Badge className={getBudgetStatusColor(metrics.webVitals.budgetStatus[metric])}>
                  {metrics.webVitals.budgetStatus[metric]}
                </Badge>
              </div>
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">
                {formatMetricValue(metric, value)}
              </div>
              <p className="text-xs text-muted-foreground">
                {metric === 'LCP' && 'Largest Contentful Paint'}
                {metric === 'FID' && 'First Input Delay'}
                {metric === 'CLS' && 'Cumulative Layout Shift'}
                {metric === 'FCP' && 'First Contentful Paint'}
                {metric === 'TTFB' && 'Time to First Byte'}
                {metric === 'INP' && 'Interaction to Next Paint'}
              </p>
            </CardContent>
          </Card>
        ))}
      </div>
      
      {/* Performance Trends Chart */}
      <Card>
        <CardHeader>
          <CardTitle>Performance Trends</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="h-80">
            <ResponsiveContainer width="100%" height="100%">
              <LineChart data={metrics.webVitals.trends}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis 
                  dataKey="timestamp" 
                  tickFormatter={(value) => new Date(value).toLocaleTimeString()}
                />
                <YAxis />
                <Tooltip 
                  labelFormatter={(value) => new Date(value).toLocaleString()}
                  formatter={(value, name) => [formatMetricValue(name as string, value as number), name]}
                />
                <Line type="monotone" dataKey="values.LCP" stroke="#8884d8" strokeWidth={2} />
                <Line type="monotone" dataKey="values.FID" stroke="#82ca9d" strokeWidth={2} />
                <Line type="monotone" dataKey="values.CLS" stroke="#ffc658" strokeWidth={2} />
              </LineChart>
            </ResponsiveContainer>
          </div>
        </CardContent>
      </Card>
      
      {/* API Performance */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle>API Performance</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              <div className="flex justify-between">
                <span>P50 Response Time:</span>
                <span className="font-bold">{metrics.apiPerformance.p50}ms</span>
              </div>
              <div className="flex justify-between">
                <span>P95 Response Time:</span>
                <span className="font-bold">{metrics.apiPerformance.p95}ms</span>
              </div>
              <div className="flex justify-between">
                <span>P99 Response Time:</span>
                <span className="font-bold">{metrics.apiPerformance.p99}ms</span>
              </div>
              <div className="flex justify-between">
                <span>Error Rate:</span>
                <span className={`font-bold ${metrics.apiPerformance.errorRate > 5 ? 'text-red-600' : 'text-green-600'}`}>
                  {metrics.apiPerformance.errorRate.toFixed(2)}%
                </span>
              </div>
            </div>
            
            <div className="mt-4">
              <h4 className="font-medium mb-2">Slowest Endpoints</h4>
              <div className="space-y-1">
                {metrics.apiPerformance.slowestEndpoints.slice(0, 5).map((endpoint, index) => (
                  <div key={index} className="flex justify-between text-sm">
                    <span className="truncate">{endpoint.endpoint}</span>
                    <span className="font-mono">{endpoint.avgTime}ms</span>
                  </div>
                ))}
              </div>
            </div>
          </CardContent>
        </Card>
        
        {/* Database Performance */}
        <Card>
          <CardHeader>
            <CardTitle>Database Performance</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              <div className="flex justify-between">
                <span>Slow Queries:</span>
                <span className={`font-bold ${metrics.dbPerformance.slowQueries > 10 ? 'text-red-600' : 'text-green-600'}`}>
                  {metrics.dbPerformance.slowQueries}
                </span>
              </div>
              <div className="flex justify-between">
                <span>Avg Query Time:</span>
                <span className="font-bold">{metrics.dbPerformance.avgQueryTime}ms</span>
              </div>
            </div>
            
            <div className="mt-4">
              <h4 className="font-medium mb-2">Top Slow Queries</h4>
              <div className="space-y-1">
                {metrics.dbPerformance.topSlowQueries.slice(0, 5).map((query, index) => (
                  <div key={index} className="text-sm">
                    <div className="flex justify-between">
                      <span className="truncate">{query.queryName}</span>
                      <span className="font-mono">{query.avgTime}ms</span>
                    </div>
                    <div className="text-xs text-muted-foreground">
                      {query.count} executions
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

### MCP SERVER USAGE

#### Required MCP Servers
- [ ] Context7: Load docs for Web Vitals API, performance monitoring libraries
- [ ] PostgreSQL: Create performance metrics tables
- [ ] Filesystem: Create monitoring components and dashboards

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/GoogleChrome/web-vitals", "web vitals", 2000);
await mcp__context7__get-library-docs("/recharts/recharts", "performance charts", 1500);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('Performance Monitoring', () => {
  it('should track web vitals correctly', () => {
    // Test web vitals collection and storage
  });
  
  it('should detect performance budget violations', () => {
    // Test performance budget checking and alerting
  });
  
  it('should monitor database query performance', () => {
    // Test query performance tracking and slow query detection
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test('Performance dashboard displays metrics correctly', async () => {
  await mcp__playwright__browser_navigate({url: '/admin/performance'});
  await mcp__playwright__browser_snapshot();
  // Verify performance metrics are displayed and charts render
});
```

### ACCEPTANCE CRITERIA
- [ ] Web vitals are tracked for all page loads with business context
- [ ] API performance monitoring captures p95 and p99 response times
- [ ] Database queries over 100ms are logged and alerted
- [ ] Performance budgets trigger alerts when exceeded
- [ ] Performance: Monitoring adds less than 1% overhead to page load
- [ ] Security: No sensitive data included in performance logs
- [ ] Accessibility: Performance dashboard is screen reader accessible

### DEPENDENCIES
- Must complete after: Error tracking system, monitoring infrastructure
- Must complete before: Production performance optimization
- Shares code with: WS-103 (Error Tracking), WS-101 (Alert System)

### ESTIMATED EFFORT
- Team A Frontend: 16 hours (performance dashboard, web vitals tracking, real-time charts)
- Team B Backend: 14 hours (API performance monitoring, database query tracking, alerts)
- Team C Integration: 6 hours (Vercel Analytics integration, performance budgets)
- Total: 36 hours