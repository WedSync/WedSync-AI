# TECHNICAL SPECIFICATION: WS-155 - Guest Communications
## Generated by Feature Development Session - August 23, 2025

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding couple communicating with guests
**I want to:** Send bulk messages to guests with personalized content based on categories and dietary needs
**So that:** I can efficiently communicate updates while maintaining personal touches for different guest groups

### SPECIFICATION SOURCE
- **Feature ID:** WS-155
- **Original Spec:** /CORE-SPECIFICATIONS/03-WEDME-COUPLE-PLATFORM/04-Guest-Management/06-guest-communications md.md

### TECHNICAL DESIGN

#### Database Schema Required
```sql
CREATE TABLE IF NOT EXISTS guest_communications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID REFERENCES couples(id),
  message_type VARCHAR(50) CHECK (message_type IN ('save_the_date', 'invitation', 'reminder', 'update', 'thank_you')),
  subject VARCHAR(255),
  content TEXT,
  delivery_method VARCHAR(20) CHECK (delivery_method IN ('email', 'sms', 'both')),
  sent_at TIMESTAMPTZ,
  recipient_count INTEGER DEFAULT 0
);

CREATE TABLE IF NOT EXISTS communication_recipients (
  communication_id UUID REFERENCES guest_communications(id) ON DELETE CASCADE,
  guest_id UUID REFERENCES guests(id) ON DELETE CASCADE,
  delivery_status VARCHAR(30) CHECK (delivery_status IN ('pending', 'sent', 'delivered', 'failed', 'opened')),
  sent_at TIMESTAMPTZ,
  opened_at TIMESTAMPTZ,
  PRIMARY KEY (communication_id, guest_id)
);
```

### CODE EXAMPLES

```typescript
export function GuestCommunications({ coupleId }: { coupleId: string }) {
  const [selectedGuests, setSelectedGuests] = useState<string[]>([]);
  const [messageContent, setMessageContent] = useState('');

  const sendBulkMessage = async () => {
    const { data, error } = await supabase
      .from('guest_communications')
      .insert({
        couple_id: coupleId,
        message_type: 'update',
        subject: 'Wedding Update',
        content: messageContent,
        delivery_method: 'email'
      })
      .select()
      .single();

    if (!error) {
      // Send to selected guests
      const recipients = selectedGuests.map(guestId => ({
        communication_id: data.id,
        guest_id: guestId,
        delivery_status: 'pending'
      }));

      await supabase
        .from('communication_recipients')
        .insert(recipients);
    }
  };

  return (
    <div className="guest-communications">
      <h2>Guest Communications</h2>
      {/* Message composer and recipient selector */}
    </div>
  );
}
```

### ACCEPTANCE CRITERIA
- [x] Bulk messaging to guest segments
- [x] Email and SMS delivery options
- [x] Message templates for common communications
- [x] Delivery status tracking and analytics
- [x] Personalization based on guest categories and dietary needs

### DEPENDENCIES
- Must complete after: WS-151 (Guest List Builder), WS-152 (Dietary Requirements)
- Estimated Effort: 38 hours total