# TECHNICAL SPECIFICATION: WS-001 - Client List Views
## Generated by Feature Development Session - 2025-08-21

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer
**I want to:** View and organize all my clients in different formats (list, grid, calendar, kanban)
**So that:** I can quickly find specific couples and manage 50+ weddings without losing track of any client

**Real Wedding Scenario:**
A photographer managing 40 weddings per year currently uses spreadsheets and loses 2 hours weekly searching for client info across multiple tools. With this feature, they see all clients in their preferred view (visual grid with photos or data table) and instantly filter by wedding date, status, or tags - saving 100+ hours annually on admin work.

### SPECIFICATION SOURCE
- **Feature ID:** WS-001
- **Original Spec:** /CORE-SPECIFICATIONS/02-WEDSYNC-SUPPLIER-PLATFORM/03-Client-Management/01-client-list-views.md
- **Current Implementation:** 0% complete
- **Files to Modify:** None - new feature
- **New Files to Create:** 
  - /src/app/(dashboard)/clients/page.tsx
  - /src/components/clients/ClientListView.tsx
  - /src/components/clients/ClientGridView.tsx
  - /src/components/clients/ClientCalendarView.tsx
  - /src/components/clients/ClientKanbanView.tsx
  - /src/lib/stores/clientListStore.ts
  - /src/app/api/clients/route.ts

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Client list optimized view
CREATE TABLE IF NOT EXISTS client_list_cache (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  client_id UUID NOT NULL,
  couple_names TEXT NOT NULL,
  wedding_date DATE,
  venue_name TEXT,
  status TEXT CHECK (status IN ('active', 'past', 'upcoming', 'draft')),
  last_activity TIMESTAMP,
  completion_percentage INTEGER DEFAULT 0,
  wedme_status TEXT CHECK (wedme_status IN ('connected', 'invited', 'not_connected')),
  tags TEXT[],
  photo_url TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Indexes for performance
CREATE INDEX idx_client_list_supplier_id ON client_list_cache(supplier_id);
CREATE INDEX idx_client_list_wedding_date ON client_list_cache(wedding_date);
CREATE INDEX idx_client_list_status ON client_list_cache(status);

-- User view preferences
CREATE TABLE IF NOT EXISTS user_view_preferences (
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  view_type TEXT DEFAULT 'list' CHECK (view_type IN ('list', 'grid', 'calendar', 'kanban')),
  sort_by TEXT DEFAULT 'wedding_date',
  sort_order TEXT DEFAULT 'asc',
  filters JSONB DEFAULT '{}',
  columns_visible TEXT[] DEFAULT ARRAY['couple_names', 'wedding_date', 'venue', 'status', 'last_activity'],
  PRIMARY KEY (user_id)
);
```

#### API Endpoints Required
```typescript
// GET /api/clients
interface GetClientsRequest {
  page?: number;
  limit?: number;
  search?: string;
  filters?: {
    status?: ('active' | 'past' | 'upcoming' | 'draft')[];
    dateRange?: { start: string; end: string };
    tags?: string[];
    wedmeStatus?: ('connected' | 'invited' | 'not_connected')[];
  };
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
}

interface ClientListItem {
  id: string;
  coupleNames: string;
  weddingDate: string | null;
  venueName: string | null;
  status: 'active' | 'past' | 'upcoming' | 'draft';
  lastActivity: string;
  completionPercentage: number;
  wedmeStatus: 'connected' | 'invited' | 'not_connected';
  tags: string[];
  photoUrl: string | null;
}

interface GetClientsResponse {
  success: boolean;
  data: {
    clients: ClientListItem[];
    pagination: {
      page: number;
      limit: number;
      total: number;
      totalPages: number;
    };
  };
}

// PATCH /api/clients/preferences
interface UpdatePreferencesRequest {
  viewType?: 'list' | 'grid' | 'calendar' | 'kanban';
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
  filters?: Record<string, any>;
  columnsVisible?: string[];
}

interface UpdatePreferencesResponse {
  success: boolean;
  data: {
    preferences: UpdatePreferencesRequest;
  };
}
```

#### Frontend Components Required
```typescript
// Component: ClientListView
// Location: /src/components/clients/ClientListView.tsx

interface ClientListViewProps {
  clients: ClientListItem[];
  onSelectClient: (clientId: string) => void;
  onBulkSelect: (clientIds: string[]) => void;
  loading: boolean;
}

// Key functionality:
- Virtual scrolling using react-window for 100+ clients
- Sortable columns with click handlers
- Checkbox selection for bulk operations
- Inline quick actions (message, edit, view)
- Responsive table with priority columns on mobile

// Component: ClientGridView
// Location: /src/components/clients/ClientGridView.tsx

interface ClientGridViewProps {
  clients: ClientListItem[];
  onSelectClient: (clientId: string) => void;
  loading: boolean;
}

// Key functionality:
- Card-based layout with couple photos
- Lazy loading images with intersection observer
- Hover effects showing quick stats
- Responsive grid (1-4 columns based on viewport)

// Component: ClientViewSwitcher
// Location: /src/components/clients/ClientViewSwitcher.tsx

interface ClientViewSwitcherProps {
  currentView: 'list' | 'grid' | 'calendar' | 'kanban';
  onViewChange: (view: string) => void;
}

// Key functionality:
- Tab-based view switcher
- Persists selection to localStorage
- Keyboard shortcuts (1-4 for views)
```

#### Integration Points
```typescript
// Store: clientListStore
// Dependencies: zustand, supabase client

import { create } from 'zustand';
import { supabase } from '@/lib/supabase/client';

interface ClientListStore {
  clients: ClientListItem[];
  loading: boolean;
  filters: Record<string, any>;
  viewType: 'list' | 'grid' | 'calendar' | 'kanban';
  
  fetchClients: (params?: GetClientsRequest) => Promise<void>;
  setViewType: (type: string) => void;
  setFilters: (filters: Record<string, any>) => void;
  selectClient: (id: string) => void;
  bulkSelectClients: (ids: string[]) => void;
}

// Key methods:
- fetchClients: Server-side filtering with cache
- setViewType: Update view and save preference
- Real-time search with debouncing
```

### CODE EXAMPLES

#### Example 1: Client List Fetching with Cache
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabase';
import { useDebounce } from '@/hooks/useDebounce';

export async function fetchClientList(params: GetClientsRequest) {
  // Step 1: Build query with filters
  let query = supabase
    .from('client_list_cache')
    .select('*', { count: 'exact' });
  
  // Step 2: Apply filters
  if (params.search) {
    query = query.ilike('couple_names', `%${params.search}%`);
  }
  
  if (params.filters?.status?.length) {
    query = query.in('status', params.filters.status);
  }
  
  // Step 3: Apply pagination
  const limit = params.limit || 50;
  const offset = ((params.page || 1) - 1) * limit;
  query = query.range(offset, offset + limit - 1);
  
  // Step 4: Execute and return
  const { data, error, count } = await query;
  
  if (error) throw error;
  
  return {
    clients: data,
    pagination: {
      page: params.page || 1,
      limit,
      total: count || 0,
      totalPages: Math.ceil((count || 0) / limit)
    }
  };
}
```

#### Example 2: Virtual Scrolling Implementation
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { FixedSizeList } from 'react-window';
import { ClientListItem } from '@/types/client';

export function VirtualClientList({ clients }: { clients: ClientListItem[] }) {
  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => {
    const client = clients[index];
    
    return (
      <div style={style} className="flex items-center p-4 border-b">
        <input type="checkbox" className="mr-4" />
        <div className="flex-1">
          <h3 className="font-semibold">{client.coupleNames}</h3>
          <p className="text-sm text-gray-600">
            {client.weddingDate} â€¢ {client.venueName}
          </p>
        </div>
        <div className="flex gap-2">
          <button className="px-3 py-1 text-sm border rounded">View</button>
          <button className="px-3 py-1 text-sm border rounded">Message</button>
        </div>
      </div>
    );
  };
  
  return (
    <FixedSizeList
      height={600}
      itemCount={clients.length}
      itemSize={80}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
}
```

### MCP SERVER USAGE

#### Required MCP Servers
- [x] Context7: Load docs for React Window, Zustand
- [ ] Playwright: Test view switching and filtering
- [x] Filesystem: Access component directories

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/vercel/next.js", "app router pages", 3000);
await mcp__context7__get-library-docs("/supabase/supabase", "select queries filters", 2000);
await mcp__context7__get-library-docs("/pmndrs/zustand", "store creation", 2000);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('ClientListView', () => {
  it('should render list of clients', () => {
    // Test rendering with mock data
  });
  
  it('should handle sorting by column', () => {
    // Test sort functionality
  });
  
  it('should support bulk selection', () => {
    // Test checkbox selection
  });
});

describe('clientListStore', () => {
  it('should fetch and cache clients', () => {
    // Test API call and state update
  });
  
  it('should persist view preferences', () => {
    // Test localStorage persistence
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test('Client list view switching', async () => {
  await mcp__playwright__browser_navigate({url: '/clients'});
  await mcp__playwright__browser_snapshot();
  
  // Test switching between views
  await mcp__playwright__browser_click({
    element: 'Grid view button',
    ref: '[data-testid="view-grid"]'
  });
  
  // Verify grid layout renders
  await mcp__playwright__browser_snapshot();
});

test('Client filtering and search', async () => {
  await mcp__playwright__browser_type({
    element: 'Search input',
    ref: '[data-testid="client-search"]',
    text: 'Smith'
  });
  
  // Verify filtered results
  await mcp__playwright__browser_wait_for({text: 'John & Jane Smith'});
});
```

### ACCEPTANCE CRITERIA
- [ ] All 4 view types (list, grid, calendar, kanban) render correctly
- [ ] Search filters results in under 200ms
- [ ] Virtual scrolling handles 500+ clients smoothly
- [ ] View preference persists across sessions
- [ ] Bulk selection works for batch operations
- [ ] Mobile swipe actions function correctly
- [ ] Keyboard navigation (j/k) works in list view
- [ ] WedMe connection status indicators display correctly

### DEPENDENCIES
- Must complete after: None (foundational feature)
- Must complete before: WS-002 (Client Profiles), WS-003 (Import), WS-004 (Bulk Ops)
- Shares code with: WS-002 (data models), WS-005 (tagging system)

### ESTIMATED EFFORT
- Team A Frontend: 16 hours
- Team B Backend: 8 hours
- Team C Integration: 0 hours
- Total: 24 hours