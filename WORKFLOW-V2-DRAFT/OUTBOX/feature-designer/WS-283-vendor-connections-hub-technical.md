# TECHNICAL SPECIFICATION: WS-283 - Vendor Connections Hub
## Generated by Feature Development Session - 2025-01-20

### USER STORY & BUSINESS CONTEXT (FACTUAL)
**As a:** Couple planning their wedding with multiple vendors
**I want to:** Have one central place to see all my vendors' contact information, status, and communicate with them
**So that:** I don't have to switch between different apps, emails, and phone numbers to coordinate my wedding vendors

**Real Wedding Scenario:**
Couples typically work with 8-15 vendors (photographer, venue, caterer, florist, DJ, etc.) and currently manage vendor communications through scattered emails, phone calls, and different vendor portals. They lose track of vendor contact preferences, miss important updates, and struggle to coordinate between vendors. A centralized hub eliminates this chaos by providing unified vendor management and communication.

### SPECIFICATION SOURCE
- **Feature ID:** WS-283
- **Original Spec:** Centralized vendor communication and relationship management requirements
- **Current Implementation:** Basic vendor list (25% complete)
- **Files to Modify:** 
  - `/src/components/vendors/VendorList.tsx`
  - `/src/app/(dashboard)/vendors/page.tsx`
  - `/src/app/api/vendors/route.ts`
- **New Files to Create:**
  - `/src/components/vendors/VendorConnectionsHub.tsx`
  - `/src/components/vendors/VendorContactCard.tsx`
  - `/src/components/vendors/VendorCommunicationCenter.tsx`
  - `/src/components/vendors/VendorStatusTracker.tsx`
  - `/src/app/api/vendors/[id]/contact/route.ts`
  - `/src/app/api/vendors/[id]/messages/route.ts`
  - `/src/lib/vendors/vendor-communication-service.ts`
  - `/src/hooks/useVendorCommunication.ts`
  - `/src/app/(dashboard)/vendors/[id]/page.tsx`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Enhanced vendor contact information and preferences
CREATE TABLE IF NOT EXISTS vendor_contact_methods (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  vendor_id UUID REFERENCES vendors(id) ON DELETE CASCADE,
  contact_type VARCHAR(20) NOT NULL CHECK (contact_type IN ('email', 'phone', 'text', 'whatsapp', 'portal')),
  contact_value VARCHAR(255) NOT NULL,
  contact_label VARCHAR(100), -- "Primary Email", "Emergency Phone", "Business Line"
  is_primary BOOLEAN DEFAULT FALSE,
  is_preferred BOOLEAN DEFAULT FALSE,
  availability_hours JSONB DEFAULT '{}', -- When they prefer to be contacted
  response_time_expectation VARCHAR(50), -- "within 24 hours", "same day", "urgent only"
  notes TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Vendor relationship status and progress tracking
CREATE TABLE IF NOT EXISTS vendor_relationships (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  wedding_id UUID REFERENCES weddings(id) ON DELETE CASCADE,
  vendor_id UUID REFERENCES vendors(id) ON DELETE CASCADE,
  relationship_status VARCHAR(30) NOT NULL DEFAULT 'prospect' CHECK (relationship_status IN (
    'prospect', 'contacted', 'quoted', 'negotiating', 'contracted', 
    'confirmed', 'in_progress', 'completed', 'cancelled'
  )),
  priority_level VARCHAR(20) DEFAULT 'normal' CHECK (priority_level IN ('low', 'normal', 'high', 'critical')),
  contract_status VARCHAR(30) DEFAULT 'not_started' CHECK (contract_status IN (
    'not_started', 'pending', 'under_review', 'signed', 'expired'
  )),
  payment_status VARCHAR(30) DEFAULT 'not_started' CHECK (payment_status IN (
    'not_started', 'deposit_paid', 'partial_paid', 'fully_paid', 'overdue'
  )),
  last_contact_date DATE,
  next_followup_date DATE,
  contract_date DATE,
  service_date DATE,
  final_payment_due_date DATE,
  vendor_rating INTEGER CHECK (vendor_rating >= 1 AND vendor_rating <= 5),
  internal_notes TEXT,
  couple_satisfaction JSONB DEFAULT '{}', -- Satisfaction tracking
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(wedding_id, vendor_id)
);

-- Vendor communication history and threads
CREATE TABLE IF NOT EXISTS vendor_communications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  wedding_id UUID REFERENCES weddings(id) ON DELETE CASCADE,
  vendor_id UUID REFERENCES vendors(id) ON DELETE CASCADE,
  initiated_by UUID REFERENCES auth.users(id), -- Couple or vendor who started conversation
  communication_type VARCHAR(30) NOT NULL CHECK (communication_type IN (
    'initial_inquiry', 'quote_request', 'quote_response', 'contract_discussion',
    'timeline_update', 'payment_reminder', 'service_confirmation', 'feedback',
    'complaint', 'general_update', 'emergency_contact'
  )),
  subject VARCHAR(300),
  message_content TEXT NOT NULL,
  communication_method VARCHAR(20) NOT NULL CHECK (communication_method IN (
    'wedsync_message', 'email', 'phone_call', 'text_message', 'in_person', 'video_call'
  )),
  status VARCHAR(20) DEFAULT 'sent' CHECK (status IN (
    'draft', 'sent', 'delivered', 'read', 'responded', 'archived'
  )),
  priority VARCHAR(20) DEFAULT 'normal' CHECK (priority IN ('low', 'normal', 'high', 'urgent')),
  response_expected BOOLEAN DEFAULT FALSE,
  response_by_date DATE,
  attachments JSONB DEFAULT '[]',
  metadata JSONB DEFAULT '{}',
  parent_communication_id UUID REFERENCES vendor_communications(id), -- For threading
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Vendor service requirements and deliverables
CREATE TABLE IF NOT EXISTS vendor_service_requirements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  wedding_id UUID REFERENCES weddings(id) ON DELETE CASCADE,
  vendor_id UUID REFERENCES vendors(id) ON DELETE CASCADE,
  requirement_category VARCHAR(50) NOT NULL, -- "photography", "catering", "music", etc.
  requirement_name VARCHAR(200) NOT NULL,
  requirement_description TEXT,
  is_mandatory BOOLEAN DEFAULT TRUE,
  requested_completion_date DATE,
  actual_completion_date DATE,
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN (
    'pending', 'in_progress', 'completed', 'not_applicable', 'cancelled'
  )),
  vendor_notes TEXT,
  couple_approval_status VARCHAR(20) DEFAULT 'pending' CHECK (couple_approval_status IN (
    'pending', 'approved', 'rejected', 'revision_requested'
  )),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes for performance
CREATE INDEX idx_vendor_contact_methods_vendor ON vendor_contact_methods(vendor_id, contact_type);
CREATE INDEX idx_vendor_relationships_wedding ON vendor_relationships(wedding_id, relationship_status);
CREATE INDEX idx_vendor_communications_vendor_date ON vendor_communications(vendor_id, created_at DESC);
CREATE INDEX idx_vendor_communications_thread ON vendor_communications(parent_communication_id);
CREATE INDEX idx_vendor_service_requirements_vendor ON vendor_service_requirements(vendor_id, status);
```

#### API Endpoints Required
```typescript
// GET /api/vendors/connections?weddingId=x - Get vendor connections overview
interface VendorConnectionsResponse {
  vendors: {
    id: string;
    name: string;
    category: string;
    contactMethods: {
      type: string;
      value: string;
      label: string;
      isPrimary: boolean;
      isPreferred: boolean;
    }[];
    relationship: {
      status: string;
      priority: string;
      contractStatus: string;
      paymentStatus: string;
      lastContactDate: string | null;
      nextFollowupDate: string | null;
    };
    recentCommunications: {
      id: string;
      type: string;
      subject: string;
      date: string;
      status: string;
    }[];
    unreadMessages: number;
    requirementsProgress: {
      total: number;
      completed: number;
      pending: number;
    };
  }[];
  summary: {
    totalVendors: number;
    contractedVendors: number;
    pendingContacts: number;
    overdueFollowups: number;
  };
}

// POST /api/vendors/[id]/contact - Initiate contact with vendor
interface ContactVendorRequest {
  weddingId: string;
  communicationType: 'initial_inquiry' | 'quote_request' | 'timeline_update' | 'general_update';
  subject: string;
  message: string;
  communicationMethod: 'wedsync_message' | 'email' | 'phone_call';
  priority: 'normal' | 'high' | 'urgent';
  responseExpected: boolean;
  responseByDate?: string;
  attachments?: FileAttachment[];
}

interface ContactVendorResponse {
  success: boolean;
  communicationId: string;
  deliveryStatus: 'sent' | 'pending' | 'failed';
}

// GET /api/vendors/[id]/communications - Get communication history
interface VendorCommunicationsResponse {
  communications: {
    id: string;
    type: string;
    subject: string;
    messageContent: string;
    method: string;
    status: string;
    priority: string;
    initiatedBy: string;
    responseExpected: boolean;
    responseByDate: string | null;
    attachments: FileAttachment[];
    createdAt: string;
    responses: VendorCommunication[];
  }[];
  unreadCount: number;
}

// PUT /api/vendors/[id]/relationship - Update vendor relationship status
interface UpdateRelationshipRequest {
  weddingId: string;
  relationshipStatus?: string;
  contractStatus?: string;
  paymentStatus?: string;
  nextFollowupDate?: string;
  internalNotes?: string;
  vendorRating?: number;
}

// GET /api/vendors/[id]/requirements - Get service requirements
interface VendorRequirementsResponse {
  requirements: {
    id: string;
    category: string;
    name: string;
    description: string;
    isMandatory: boolean;
    requestedDate: string | null;
    actualDate: string | null;
    status: string;
    coupleApprovalStatus: string;
    vendorNotes: string | null;
  }[];
}
```

#### Frontend Components Required
```typescript
// Component: VendorConnectionsHub
// Location: /src/components/vendors/VendorConnectionsHub.tsx

interface VendorConnectionsHubProps {
  weddingId: string;
  initialView?: 'overview' | 'communications' | 'requirements';
}

// Key functionality:
- Unified vendor overview dashboard
- Quick contact actions and communication center
- Status tracking and progress monitoring
- Search and filter vendors by status/category
- Bulk operations for vendor management
- Integration with communication threads

// Component: VendorContactCard
// Location: /src/components/vendors/VendorContactCard.tsx
interface VendorContactCardProps {
  vendor: Vendor;
  relationship: VendorRelationship;
  onContact: (vendorId: string, method: string) => void;
  onUpdateStatus: (vendorId: string, updates: RelationshipUpdate) => void;
  showQuickActions?: boolean;
}

// Key functionality:
- Vendor contact information display
- Preferred communication method highlighting
- Quick action buttons (call, email, message)
- Status indicators and progress tracking
- Last contact and next followup display
- Contract and payment status badges

// Component: VendorCommunicationCenter
// Location: /src/components/vendors/VendorCommunicationCenter.tsx
interface VendorCommunicationCenterProps {
  weddingId: string;
  vendorId?: string; // If viewing specific vendor
  onSendMessage: (vendorId: string, message: CommunicationData) => void;
}

// Key functionality:
- Communication history timeline
- New message composition with templates
- Response tracking and follow-up reminders
- Attachment handling and file sharing
- Priority messaging and urgent alerts
- Communication method selection

// Component: VendorStatusTracker
// Location: /src/components/vendors/VendorStatusTracker.tsx
interface VendorStatusTrackerProps {
  vendors: VendorWithRelationship[];
  onStatusUpdate: (vendorId: string, status: string) => void;
  showCompletionStats?: boolean;
}

// Key functionality:
- Visual progress tracking for all vendors
- Status change workflows with notifications
- Milestone tracking and completion dates
- Payment and contract status monitoring
- Overdue alerts and follow-up reminders
- Bulk status updates
```

#### Integration Points
```typescript
// Service: VendorCommunicationService
// Dependencies: Email service, notification system, communication threads

class VendorCommunicationService {
  async sendVendorMessage(vendorId: string, message: VendorCommunication): Promise<CommunicationResult> {
    // Send message via vendor's preferred method
    // Create communication record
    // Set up response tracking
    // Schedule follow-up reminders
    // Notify other stakeholders if needed
  }
  
  async getVendorCommunications(vendorId: string, weddingId: string): Promise<VendorCommunication[]> {
    // Retrieve communication history
    // Group by conversation threads
    // Include response status and timing
    // Apply privacy filters based on user permissions
  }
  
  async updateRelationshipStatus(vendorId: string, weddingId: string, updates: RelationshipUpdate): Promise<void> {
    // Update vendor relationship record
    // Trigger status change notifications
    // Update wedding progress tracking
    // Log status change for audit trail
  }
  
  async getVendorConnectionsOverview(weddingId: string): Promise<VendorConnectionsOverview> {
    // Aggregate all vendor data for dashboard
    // Calculate progress and completion stats
    // Identify overdue follow-ups and urgent items
    // Include recent activity summaries
  }
}

// Hook: useVendorCommunication
// Dependencies: Vendor service, real-time updates, notification system

export function useVendorCommunication(weddingId: string, vendorId?: string) {
  const [vendors, setVendors] = useState<VendorWithRelationship[]>([]);
  const [communications, setCommunications] = useState<VendorCommunication[]>([]);
  const [unreadCounts, setUnreadCounts] = useState<Record<string, number>>({});
  const [isLoading, setIsLoading] = useState(true);

  // Vendor management functions
  const sendMessage = async (vendorId: string, message: CommunicationData) => {
    // Send message and update local state
  };

  const updateVendorStatus = async (vendorId: string, updates: RelationshipUpdate) => {
    // Update vendor relationship status
  };

  const markCommunicationsRead = async (vendorId: string) => {
    // Mark vendor communications as read
  };

  return {
    vendors,
    communications,
    unreadCounts,
    isLoading,
    sendMessage,
    updateVendorStatus,
    markCommunicationsRead,
    refreshData: () => loadVendorData()
  };
}
```

### CODE EXAMPLES

#### Example 1: Vendor Connections Hub
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
'use client';
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { 
  Users, MessageCircle, Phone, Mail, Calendar, Clock, 
  CheckCircle, AlertCircle, DollarSign, FileText, Search, Filter 
} from 'lucide-react';

interface VendorWithRelationship {
  id: string;
  name: string;
  category: string;
  contactMethods: ContactMethod[];
  relationship: {
    status: string;
    priority: string;
    contractStatus: string;
    paymentStatus: string;
    lastContactDate: string | null;
    nextFollowupDate: string | null;
  };
  recentCommunications: Communication[];
  unreadMessages: number;
  requirementsProgress: {
    total: number;
    completed: number;
    pending: number;
  };
}

interface ContactMethod {
  type: 'email' | 'phone' | 'text' | 'whatsapp' | 'portal';
  value: string;
  label: string;
  isPrimary: boolean;
  isPreferred: boolean;
}

export function VendorConnectionsHub({ weddingId, initialView = 'overview' }: VendorConnectionsHubProps) {
  const [vendors, setVendors] = useState<VendorWithRelationship[]>([]);
  const [filteredVendors, setFilteredVendors] = useState<VendorWithRelationship[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('all');
  const [categoryFilter, setCategoryFilter] = useState('all');
  const [selectedVendor, setSelectedVendor] = useState<VendorWithRelationship | null>(null);
  const [showContactModal, setShowContactModal] = useState(false);
  const [activeTab, setActiveTab] = useState(initialView);

  useEffect(() => {
    loadVendorConnections();
  }, [weddingId]);

  useEffect(() => {
    filterVendors();
  }, [vendors, searchTerm, statusFilter, categoryFilter]);

  const loadVendorConnections = async () => {
    try {
      const response = await fetch(`/api/vendors/connections?weddingId=${weddingId}`);
      const data = await response.json();
      setVendors(data.vendors || []);
    } catch (error) {
      console.error('Error loading vendor connections:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const filterVendors = () => {
    let filtered = vendors;

    // Search filter
    if (searchTerm) {
      filtered = filtered.filter(vendor => 
        vendor.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        vendor.category.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }

    // Status filter
    if (statusFilter !== 'all') {
      filtered = filtered.filter(vendor => vendor.relationship.status === statusFilter);
    }

    // Category filter
    if (categoryFilter !== 'all') {
      filtered = filtered.filter(vendor => vendor.category === categoryFilter);
    }

    setFilteredVendors(filtered);
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'contracted': return 'bg-green-100 text-green-800';
      case 'confirmed': return 'bg-blue-100 text-blue-800';
      case 'negotiating': return 'bg-yellow-100 text-yellow-800';
      case 'contacted': return 'bg-purple-100 text-purple-800';
      case 'prospect': return 'bg-gray-100 text-gray-800';
      case 'cancelled': return 'bg-red-100 text-red-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'critical': return 'border-l-red-500 bg-red-50';
      case 'high': return 'border-l-orange-500 bg-orange-50';
      case 'normal': return 'border-l-blue-500 bg-blue-50';
      case 'low': return 'border-l-gray-500 bg-gray-50';
      default: return 'border-l-gray-500 bg-white';
    }
  };

  const getContactMethodIcon = (type: string) => {
    switch (type) {
      case 'email': return <Mail className="w-4 h-4" />;
      case 'phone': return <Phone className="w-4 h-4" />;
      case 'text': return <MessageCircle className="w-4 h-4" />;
      case 'whatsapp': return <MessageCircle className="w-4 h-4 text-green-600" />;
      default: return <MessageCircle className="w-4 h-4" />;
    }
  };

  const contactVendor = async (vendorId: string, method: string, contactValue: string) => {
    try {
      // Different actions based on contact method
      switch (method) {
        case 'email':
          window.location.href = `mailto:${contactValue}?subject=Wedding Coordination - ${weddingId}`;
          break;
        case 'phone':
          window.location.href = `tel:${contactValue}`;
          break;
        case 'text':
          window.location.href = `sms:${contactValue}`;
          break;
        case 'wedsync_message':
          setSelectedVendor(vendors.find(v => v.id === vendorId) || null);
          setShowContactModal(true);
          break;
        default:
          console.log(`Contact via ${method}: ${contactValue}`);
      }

      // Log the contact attempt
      await fetch(`/api/vendors/${vendorId}/contact`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          weddingId,
          communicationType: 'general_update',
          communicationMethod: method,
          subject: 'Contact initiated',
          message: `Contacted vendor via ${method}`
        })
      });
    } catch (error) {
      console.error('Error contacting vendor:', error);
    }
  };

  const updateVendorStatus = async (vendorId: string, newStatus: string) => {
    try {
      await fetch(`/api/vendors/${vendorId}/relationship`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          weddingId,
          relationshipStatus: newStatus
        })
      });

      // Update local state
      setVendors(prev => 
        prev.map(vendor => 
          vendor.id === vendorId 
            ? { ...vendor, relationship: { ...vendor.relationship, status: newStatus }}
            : vendor
        )
      );
    } catch (error) {
      console.error('Error updating vendor status:', error);
    }
  };

  const getProgressPercentage = (progress: { total: number; completed: number; pending: number }) => {
    if (progress.total === 0) return 0;
    return Math.round((progress.completed / progress.total) * 100);
  };

  const categories = [...new Set(vendors.map(v => v.category))];
  const statuses = ['prospect', 'contacted', 'quoted', 'negotiating', 'contracted', 'confirmed'];

  if (isLoading) {
    return <div className="animate-pulse p-8">Loading vendor connections...</div>;
  }

  return (
    <div className="space-y-6">
      {/* Summary Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Total Vendors</p>
                <p className="text-2xl font-bold">{vendors.length}</p>
              </div>
              <Users className="w-8 h-8 text-blue-600" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Contracted</p>
                <p className="text-2xl font-bold text-green-600">
                  {vendors.filter(v => v.relationship.status === 'contracted').length}
                </p>
              </div>
              <CheckCircle className="w-8 h-8 text-green-600" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Pending Follow-up</p>
                <p className="text-2xl font-bold text-orange-600">
                  {vendors.filter(v => v.relationship.nextFollowupDate && new Date(v.relationship.nextFollowupDate) <= new Date()).length}
                </p>
              </div>
              <Clock className="w-8 h-8 text-orange-600" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Unread Messages</p>
                <p className="text-2xl font-bold text-purple-600">
                  {vendors.reduce((sum, v) => sum + v.unreadMessages, 0)}
                </p>
              </div>
              <MessageCircle className="w-8 h-8 text-purple-600" />
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Filters and Search */}
      <Card>
        <CardContent className="p-6">
          <div className="flex flex-wrap gap-4 items-center">
            <div className="flex-1 min-w-[200px]">
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
                <Input
                  placeholder="Search vendors..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>

            <Select value={statusFilter} onValueChange={setStatusFilter}>
              <SelectTrigger className="w-40">
                <SelectValue placeholder="All Statuses" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">All Statuses</SelectItem>
                {statuses.map(status => (
                  <SelectItem key={status} value={status}>
                    {status.charAt(0).toUpperCase() + status.slice(1)}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>

            <Select value={categoryFilter} onValueChange={setCategoryFilter}>
              <SelectTrigger className="w-40">
                <SelectValue placeholder="All Categories" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">All Categories</SelectItem>
                {categories.map(category => (
                  <SelectItem key={category} value={category}>
                    {category.charAt(0).toUpperCase() + category.slice(1)}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>

            <Button variant="outline" className="flex items-center space-x-2">
              <Filter className="w-4 h-4" />
              <span>More Filters</span>
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Main Content Tabs */}
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="overview">Vendor Overview</TabsTrigger>
          <TabsTrigger value="communications">Communications</TabsTrigger>
          <TabsTrigger value="requirements">Requirements</TabsTrigger>
        </TabsList>

        <TabsContent value="overview" className="space-y-4">
          {/* Vendor Cards Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredVendors.map(vendor => (
              <Card 
                key={vendor.id} 
                className={`border-l-4 ${getPriorityColor(vendor.relationship.priority)} hover:shadow-md transition-shadow`}
              >
                <CardContent className="p-6">
                  <div className="flex items-start justify-between mb-4">
                    <div className="flex-1">
                      <h3 className="font-semibold text-lg">{vendor.name}</h3>
                      <p className="text-sm text-gray-600 capitalize">{vendor.category}</p>
                    </div>
                    {vendor.unreadMessages > 0 && (
                      <Badge className="bg-red-100 text-red-800">
                        {vendor.unreadMessages} new
                      </Badge>
                    )}
                  </div>

                  {/* Status Badges */}
                  <div className="flex flex-wrap gap-2 mb-4">
                    <Badge className={getStatusColor(vendor.relationship.status)}>
                      {vendor.relationship.status.replace('_', ' ')}
                    </Badge>
                    <Badge variant="outline">
                      {vendor.relationship.contractStatus.replace('_', ' ')}
                    </Badge>
                    <Badge variant="outline">
                      {vendor.relationship.paymentStatus.replace('_', ' ')}
                    </Badge>
                  </div>

                  {/* Progress Bar */}
                  {vendor.requirementsProgress.total > 0 && (
                    <div className="mb-4">
                      <div className="flex justify-between text-sm text-gray-600 mb-1">
                        <span>Requirements Progress</span>
                        <span>{getProgressPercentage(vendor.requirementsProgress)}%</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2">
                        <div 
                          className="bg-blue-600 h-2 rounded-full" 
                          style={{ width: `${getProgressPercentage(vendor.requirementsProgress)}%` }}
                        />
                      </div>
                    </div>
                  )}

                  {/* Contact Methods */}
                  <div className="flex flex-wrap gap-2 mb-4">
                    {vendor.contactMethods
                      .filter(method => method.isPreferred || method.isPrimary)
                      .slice(0, 3)
                      .map((method, index) => (
                      <Button
                        key={index}
                        size="sm"
                        variant="outline"
                        onClick={() => contactVendor(vendor.id, method.type, method.value)}
                        className="flex items-center space-x-1 text-xs"
                      >
                        {getContactMethodIcon(method.type)}
                        <span>{method.label}</span>
                      </Button>
                    ))}
                    {vendor.contactMethods.length > 3 && (
                      <Button size="sm" variant="ghost" className="text-xs">
                        +{vendor.contactMethods.length - 3} more
                      </Button>
                    )}
                  </div>

                  {/* Last Contact & Next Followup */}
                  <div className="text-xs text-gray-500 space-y-1">
                    {vendor.relationship.lastContactDate && (
                      <div className="flex items-center space-x-1">
                        <Calendar className="w-3 h-3" />
                        <span>Last contact: {new Date(vendor.relationship.lastContactDate).toLocaleDateString()}</span>
                      </div>
                    )}
                    {vendor.relationship.nextFollowupDate && (
                      <div className={`flex items-center space-x-1 ${
                        new Date(vendor.relationship.nextFollowupDate) <= new Date() ? 'text-red-600 font-medium' : ''
                      }`}>
                        <Clock className="w-3 h-3" />
                        <span>Follow-up: {new Date(vendor.relationship.nextFollowupDate).toLocaleDateString()}</span>
                      </div>
                    )}
                  </div>

                  {/* Quick Actions */}
                  <div className="flex justify-between items-center mt-4">
                    <Button
                      size="sm"
                      onClick={() => {
                        setSelectedVendor(vendor);
                        setShowContactModal(true);
                      }}
                      className="flex items-center space-x-1"
                    >
                      <MessageCircle className="w-4 h-4" />
                      <span>Message</span>
                    </Button>

                    <Select 
                      value={vendor.relationship.status}
                      onValueChange={(value) => updateVendorStatus(vendor.id, value)}
                    >
                      <SelectTrigger className="w-32 h-8">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        {statuses.map(status => (
                          <SelectItem key={status} value={status}>
                            {status.charAt(0).toUpperCase() + status.slice(1)}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>

          {filteredVendors.length === 0 && (
            <Card>
              <CardContent className="p-12 text-center">
                <Users className="w-12 h-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">No vendors found</h3>
                <p className="text-gray-600 mb-4">
                  {searchTerm || statusFilter !== 'all' || categoryFilter !== 'all'
                    ? 'Try adjusting your search filters.'
                    : 'Start by adding vendors to your wedding.'
                  }
                </p>
                {(!searchTerm && statusFilter === 'all' && categoryFilter === 'all') && (
                  <Button>Add Your First Vendor</Button>
                )}
              </CardContent>
            </Card>
          )}
        </TabsContent>

        <TabsContent value="communications">
          <VendorCommunicationCenter 
            weddingId={weddingId}
            vendors={filteredVendors}
          />
        </TabsContent>

        <TabsContent value="requirements">
          <VendorRequirementsTracker 
            weddingId={weddingId}
            vendors={filteredVendors}
          />
        </TabsContent>
      </Tabs>

      {/* Contact Vendor Modal */}
      {showContactModal && selectedVendor && (
        <ContactVendorModal
          vendor={selectedVendor}
          weddingId={weddingId}
          isOpen={showContactModal}
          onClose={() => {
            setShowContactModal(false);
            setSelectedVendor(null);
          }}
          onSent={() => {
            loadVendorConnections();
            setShowContactModal(false);
            setSelectedVendor(null);
          }}
        />
      )}
    </div>
  );
}
```

#### Example 2: Contact Vendor Modal
```typescript
'use client';
import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { Switch } from '@/components/ui/switch';
import { Calendar } from '@/components/ui/calendar';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { CalendarIcon, Send, Paperclip } from 'lucide-react';

interface ContactVendorModalProps {
  vendor: VendorWithRelationship;
  weddingId: string;
  isOpen: boolean;
  onClose: () => void;
  onSent: () => void;
}

export function ContactVendorModal({ vendor, weddingId, isOpen, onClose, onSent }: ContactVendorModalProps) {
  const [formData, setFormData] = useState({
    communicationType: 'general_update' as const,
    subject: '',
    message: '',
    communicationMethod: 'wedsync_message' as const,
    priority: 'normal' as const,
    responseExpected: false,
    responseByDate: null as Date | null,
    attachments: [] as File[]
  });
  const [isLoading, setIsLoading] = useState(false);

  const communicationTypes = [
    { value: 'initial_inquiry', label: 'Initial Inquiry' },
    { value: 'quote_request', label: 'Request Quote' },
    { value: 'contract_discussion', label: 'Contract Discussion' },
    { value: 'timeline_update', label: 'Timeline Update' },
    { value: 'payment_reminder', label: 'Payment Reminder' },
    { value: 'service_confirmation', label: 'Service Confirmation' },
    { value: 'general_update', label: 'General Update' },
    { value: 'emergency_contact', label: 'Emergency Contact' }
  ];

  const getMessageTemplate = (type: string) => {
    const templates = {
      initial_inquiry: `Hi ${vendor.name},\n\nWe're planning our wedding and would love to learn more about your ${vendor.category} services.\n\n`,
      quote_request: `Hi ${vendor.name},\n\nCould you please provide a quote for your ${vendor.category} services for our wedding?\n\nWedding Date: \nGuest Count: \nVenue: \n\n`,
      contract_discussion: `Hi ${vendor.name},\n\nI'd like to discuss the contract details for our wedding services.\n\n`,
      timeline_update: `Hi ${vendor.name},\n\nThere have been some updates to our wedding timeline that I wanted to share with you.\n\n`,
      service_confirmation: `Hi ${vendor.name},\n\nI wanted to confirm the details for our upcoming wedding services.\n\n`,
      general_update: `Hi ${vendor.name},\n\n`,
    };
    return templates[type as keyof typeof templates] || templates.general_update;
  };

  const handleTypeChange = (type: string) => {
    setFormData(prev => ({
      ...prev,
      communicationType: type as any,
      message: getMessageTemplate(type),
      subject: type === 'quote_request' ? `Quote Request - Wedding ${weddingId}` :
               type === 'timeline_update' ? `Timeline Update - Wedding ${weddingId}` :
               `${type.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())} - Wedding ${weddingId}`
    }));
  };

  const handleSend = async () => {
    if (!formData.subject.trim() || !formData.message.trim()) {
      alert('Please fill in both subject and message fields.');
      return;
    }

    setIsLoading(true);
    try {
      const response = await fetch(`/api/vendors/${vendor.id}/contact`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          weddingId,
          ...formData
        })
      });

      const result = await response.json();
      if (result.success) {
        onSent();
      } else {
        alert('Failed to send message. Please try again.');
      }
    } catch (error) {
      console.error('Error sending message:', error);
      alert('Failed to send message. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  const preferredMethods = vendor.contactMethods.filter(m => m.isPreferred || m.isPrimary);

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="sm:max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle className="flex items-center space-x-2">
            <Send className="w-5 h-5" />
            <span>Contact {vendor.name}</span>
          </DialogTitle>
        </DialogHeader>

        <div className="space-y-6">
          {/* Communication Type */}
          <div>
            <label className="text-sm font-medium mb-2 block">Message Type</label>
            <Select value={formData.communicationType} onValueChange={handleTypeChange}>
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {communicationTypes.map(type => (
                  <SelectItem key={type.value} value={type.value}>
                    {type.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Communication Method */}
          <div>
            <label className="text-sm font-medium mb-2 block">Contact Method</label>
            <RadioGroup 
              value={formData.communicationMethod} 
              onValueChange={(value) => setFormData(prev => ({ ...prev, communicationMethod: value as any }))}
              className="grid grid-cols-2 gap-4"
            >
              <div className="flex items-center space-x-2 p-3 border rounded">
                <RadioGroupItem value="wedsync_message" id="wedsync" />
                <label htmlFor="wedsync" className="text-sm font-medium">WedSync Message</label>
              </div>
              
              {preferredMethods.map(method => (
                <div key={method.type} className="flex items-center space-x-2 p-3 border rounded">
                  <RadioGroupItem value={method.type} id={method.type} />
                  <label htmlFor={method.type} className="text-sm font-medium">
                    {method.label} ({method.value})
                  </label>
                </div>
              ))}
            </RadioGroup>
          </div>

          {/* Subject */}
          <div>
            <label className="text-sm font-medium mb-2 block">Subject</label>
            <Input
              value={formData.subject}
              onChange={(e) => setFormData(prev => ({ ...prev, subject: e.target.value }))}
              placeholder="Enter message subject..."
            />
          </div>

          {/* Message */}
          <div>
            <label className="text-sm font-medium mb-2 block">Message</label>
            <Textarea
              value={formData.message}
              onChange={(e) => setFormData(prev => ({ ...prev, message: e.target.value }))}
              placeholder="Type your message..."
              rows={8}
            />
          </div>

          {/* Priority and Response Settings */}
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Priority</label>
              <Select 
                value={formData.priority} 
                onValueChange={(value) => setFormData(prev => ({ ...prev, priority: value as any }))}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="low">Low</SelectItem>
                  <SelectItem value="normal">Normal</SelectItem>
                  <SelectItem value="high">High</SelectItem>
                  <SelectItem value="urgent">Urgent</SelectItem>
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-2">
              <div className="flex items-center space-x-2">
                <Switch
                  id="response-expected"
                  checked={formData.responseExpected}
                  onCheckedChange={(checked) => setFormData(prev => ({ ...prev, responseExpected: checked }))}
                />
                <label htmlFor="response-expected" className="text-sm font-medium">
                  Response Expected
                </label>
              </div>

              {formData.responseExpected && (
                <Popover>
                  <PopoverTrigger asChild>
                    <Button variant="outline" className="w-full justify-start text-left font-normal">
                      <CalendarIcon className="mr-2 h-4 w-4" />
                      {formData.responseByDate ? formData.responseByDate.toDateString() : "Select deadline"}
                    </Button>
                  </PopoverTrigger>
                  <PopoverContent className="w-auto p-0">
                    <Calendar
                      mode="single"
                      selected={formData.responseByDate}
                      onSelect={(date) => setFormData(prev => ({ ...prev, responseByDate: date }))}
                      initialFocus
                    />
                  </PopoverContent>
                </Popover>
              )}
            </div>
          </div>

          {/* Attachments */}
          <div>
            <label className="text-sm font-medium mb-2 block">Attachments (Optional)</label>
            <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
              <Paperclip className="w-8 h-8 text-gray-400 mx-auto mb-2" />
              <p className="text-sm text-gray-600">Drag files here or click to select</p>
              <Button variant="outline" size="sm" className="mt-2">
                Choose Files
              </Button>
            </div>
          </div>

          {/* Actions */}
          <div className="flex justify-between">
            <Button variant="outline" onClick={onClose}>
              Cancel
            </Button>
            <div className="space-x-2">
              <Button variant="outline">Save Draft</Button>
              <Button onClick={handleSend} disabled={isLoading}>
                {isLoading ? 'Sending...' : 'Send Message'}
              </Button>
            </div>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

### MCP SERVER USAGE

#### Required MCP Servers
- [x] Ref MCP: Search docs for vendor management patterns, communication systems
- [x] Supabase MCP: Database operations and real-time vendor updates
- [x] Browser MCP: Interactive testing of vendor communication interface
- [x] Filesystem: Access vendor templates and contact configurations

#### Ref MCP Searches Needed
```bash
# Use Ref MCP to search for:
# - "React vendor management dashboard"
# - "Communication hub design patterns"
# - "Customer relationship management UI"
# - "Vendor communication best practices"
```

#### Browser MCP Interactive Testing
```bash
# Use Browser MCP for:
# - Testing vendor contact workflows
# - Verifying communication center functionality
# - Screenshot capture of vendor hub interface
# - Testing mobile responsive vendor management
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('VendorConnectionsHub', () => {
  it('should load and display vendor connections', async () => {
    // Test vendor data loading and display
  });
  
  it('should filter vendors by status and category', () => {
    // Test vendor filtering functionality
  });
  
  it('should initiate vendor contact correctly', async () => {
    // Test vendor contact initiation
  });
  
  it('should update vendor relationship status', async () => {
    // Test status update functionality
  });
});

describe('VendorCommunicationService', () => {
  it('should send messages via preferred method', async () => {
    // Test message sending logic
  });
  
  it('should track communication history', async () => {
    // Test communication logging and retrieval
  });
});
```

#### E2E Tests Required
```typescript
test('Vendor communication workflow', async () => {
  await mcp__playwright__browser_navigate({url: '/wedding/test-wedding/vendors'});
  
  // View vendor connections hub
  const vendorHub = await page.waitForSelector('[data-testid="vendor-connections-hub"]');
  expect(vendorHub).toBeTruthy();
  
  // Filter vendors by status
  await mcp__playwright__browser_select_option({element: 'Status filter', ref: '[data-testid="status-filter"]', values: ['contracted']});
  
  // Open contact modal for a vendor
  await mcp__playwright__browser_click({element: 'Message vendor button', ref: '[data-testid="message-vendor"]'});
  
  // Fill in message details
  await mcp__playwright__browser_select_option({element: 'Message type', ref: '[data-testid="message-type"]', values: ['timeline_update']});
  await mcp__playwright__browser_type({element: 'Subject input', ref: '[data-testid="subject-input"]', text: 'Timeline Update'});
  await mcp__playwright__browser_type({element: 'Message content', ref: '[data-testid="message-content"]', text: 'Wedding timeline has been updated'});
  
  // Send message
  await mcp__playwright__browser_click({element: 'Send message', ref: '[data-testid="send-message"]'});
  
  // Verify success
  const successMessage = await page.waitForSelector('[data-testid="message-sent"]');
  expect(successMessage).toBeTruthy();
});
```

### ACCEPTANCE CRITERIA
- [x] Centralized vendor contact information and communication hub
- [x] Multiple contact method support (email, phone, SMS, WedSync messages)
- [x] Vendor relationship status tracking and progress monitoring
- [x] Communication history and response tracking
- [x] Service requirements and deliverables tracking
- [x] Search and filter vendors by status, category, priority
- [x] Quick contact actions and bulk operations
- [x] Follow-up reminders and overdue alerts
- [x] Mobile-responsive vendor management interface
- [x] **Navigation Integration: Vendor hub accessible from main wedding dashboard**
  - [x] Vendors tab/section in main wedding navigation
  - [x] Unread message indicators in vendor navigation
  - [x] Quick access to urgent vendor communications
  - [x] Mobile navigation support for vendor management
  - [x] Integration with timeline and task management navigation

### DEPENDENCIES
- Must complete after: Vendor management system, user authentication, communication threads (WS-278)
- Must complete before: Wedding Basics Setup (WS-284)
- Shares code with: Communication system, user management, notification system

### ESTIMATED EFFORT
- Team A Frontend: 36 hours (Vendor hub UI, contact components, communication center, mobile responsive)
- Team B Backend: 32 hours (Vendor APIs, communication service, relationship tracking, messaging integration)
- Team C Integration: 12 hours (Communication threads integration, notification system)
- Team D Platform: 16 hours (Vendor relationship management, status tracking, requirements system)
- Team E General: 20 hours (Testing, mobile responsive, accessibility, error handling)
- Team F Workflows: 12 hours (Vendor communication workflows, contact optimization)
- Team G Performance: 8 hours (Vendor data optimization, real-time updates)
- Total: 136 hours