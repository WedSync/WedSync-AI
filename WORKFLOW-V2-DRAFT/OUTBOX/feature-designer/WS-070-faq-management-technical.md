# TECHNICAL SPECIFICATION: WS-070 - FAQ Management
## Generated by Feature Development Session - August 22, 2025

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer who answers the same 20 questions every week
**I want to:** Create a searchable FAQ system that reduces repetitive support inquiries
**So that:** I save 8+ hours per week on client support and provide instant answers to common questions

**Real Wedding Scenario:**
A photographer currently receives identical questions about "when will photos be ready", "do you include engagement sessions", and "what if it rains" from every client. With this FAQ system, they create comprehensive answers once and clients find instant answers, reducing support emails by 80% while improving client satisfaction through immediate responses.

### SPECIFICATION SOURCE
- **Feature ID:** WS-070
- **Original Spec:** /CORE-SPECIFICATIONS/02-WEDSYNC-SUPPLIER-PLATFORM/09-Documents-Articles/03-faq-management md.md
- **Current Implementation:** 0% complete
- **Files to Modify:** 
  - /wedsync/src/app/(dashboard)/settings/page.tsx (add FAQ management tab)
  - /wedsync/src/components/navigation/sidebar.tsx (add FAQ menu item)
- **New Files to Create:**
  - /wedsync/src/app/(dashboard)/faq/page.tsx
  - /wedsync/src/app/(dashboard)/faq/create/page.tsx
  - /wedsync/src/app/(dashboard)/faq/[id]/edit/page.tsx
  - /wedsync/src/app/api/faq/route.ts
  - /wedsync/src/app/api/faq/[id]/route.ts
  - /wedsync/src/components/faq/FAQManager.tsx
  - /wedsync/src/components/faq/FAQEditor.tsx
  - /wedsync/src/components/faq/FAQDisplay.tsx
  - /wedsync/src/lib/services/faqService.ts

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- FAQ categories table
CREATE TABLE IF NOT EXISTS faq_categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID NOT NULL REFERENCES suppliers(id),
  name VARCHAR(255) NOT NULL,
  description TEXT,
  display_order INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- FAQ items table
CREATE TABLE IF NOT EXISTS faq_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID NOT NULL REFERENCES suppliers(id),
  category_id UUID REFERENCES faq_categories(id),
  question TEXT NOT NULL,
  answer TEXT NOT NULL,
  search_tags TEXT[],
  visibility_rule VARCHAR(50) DEFAULT 'public', -- 'public', 'clients_only', 'stage_specific', 'conditional'
  display_order INTEGER DEFAULT 0,
  view_count INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- FAQ analytics table
CREATE TABLE IF NOT EXISTS faq_analytics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID NOT NULL REFERENCES suppliers(id),
  faq_item_id UUID REFERENCES faq_items(id),
  search_query TEXT,
  client_id UUID REFERENCES clients(id),
  viewed_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- Create indexes for performance
CREATE INDEX idx_faq_items_supplier_id ON faq_items(supplier_id);
CREATE INDEX idx_faq_items_category_id ON faq_items(category_id);
CREATE INDEX idx_faq_analytics_supplier_id ON faq_analytics(supplier_id);
```

#### API Endpoints Required
```typescript
// GET /api/faq - Get all FAQ items for supplier
interface GetFAQResponse {
  categories: {
    id: string;
    name: string;
    description: string;
    items: {
      id: string;
      question: string;
      answer: string;
      tags: string[];
      visibility: string;
      viewCount: number;
    }[];
  }[];
}

// POST /api/faq - Create new FAQ item
interface CreateFAQRequest {
  categoryId?: string;
  question: string;
  answer: string;
  searchTags: string[];
  visibilityRule: 'public' | 'clients_only' | 'stage_specific' | 'conditional';
}

// PUT /api/faq/[id] - Update FAQ item
interface UpdateFAQRequest {
  question?: string;
  answer?: string;
  searchTags?: string[];
  visibilityRule?: string;
  isActive?: boolean;
}

// GET /api/faq/search?q={query} - Search FAQ items
interface SearchFAQResponse {
  results: {
    id: string;
    question: string;
    answer: string;
    relevanceScore: number;
  }[];
  suggestions: string[];
}
```

#### Frontend Components Required
```typescript
// Component: FAQManager
// Location: /src/components/faq/FAQManager.tsx

interface FAQManagerProps {
  supplierId: string;
}

// Key functionality:
- Display FAQ categories and items in organized layout
- Drag-and-drop reordering for categories and items
- Bulk actions (activate/deactivate multiple items)
- Search and filter FAQ items
- Analytics dashboard showing most viewed questions

// Component: FAQEditor
// Location: /src/components/faq/FAQEditor.tsx

interface FAQEditorProps {
  faqItem?: FAQItem;
  onSave: (item: FAQItem) => void;
  onCancel: () => void;
}

// Key functionality:
- Rich text editor for answers with formatting options
- Category assignment dropdown
- Tag input with suggestions
- Visibility rule configuration
- Preview mode for answer display

// Component: FAQDisplay
// Location: /src/components/faq/FAQDisplay.tsx

interface FAQDisplayProps {
  faqItems: FAQItem[];
  searchable?: boolean;
  accordion?: boolean;
}

// Key functionality:
- Accordion-style display of FAQ items
- Search functionality with instant results
- Category filtering
- View tracking for analytics
```

#### Integration Points
```typescript
// Service: FAQService
// Dependencies: Supabase, search indexing

class FAQService {
  async createFAQItem(supplierId: string, item: CreateFAQRequest) {
    // Validate supplier permissions
    // Insert into database with auto-generated search tags
    // Update search index
    // Log creation event
  }
  
  async searchFAQs(supplierId: string, query: string) {
    // Full-text search across questions and answers
    // Return ranked results with relevance scoring
    // Log search query for analytics
    // Suggest similar questions if no results
  }
  
  async getFAQAnalytics(supplierId: string, dateRange?: DateRange) {
    // Return most viewed questions
    // Search queries without results
    // Question effectiveness metrics
    // Usage trends over time
  }
}
```

### CODE EXAMPLES

#### Example 1: FAQ Search Implementation
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabase';

export async function searchFAQItems(supplierId: string, query: string) {
  // Step 1: Perform full-text search on questions and answers
  const { data: results, error } = await supabase
    .from('faq_items')
    .select('*')
    .eq('supplier_id', supplierId)
    .eq('is_active', true)
    .or(`question.ilike.%${query}%, answer.ilike.%${query}%, search_tags.cs.{${query}}`)
    .order('view_count', { ascending: false });
    
  if (error) throw error;
  
  // Step 2: Log search query for analytics
  await supabase
    .from('faq_analytics')
    .insert({
      supplier_id: supplierId,
      search_query: query,
      viewed_at: new Date().toISOString()
    });
  
  // Step 3: Return results with relevance scoring
  return results.map(item => ({
    ...item,
    relevanceScore: calculateRelevance(item, query)
  })).sort((a, b) => b.relevanceScore - a.relevanceScore);
}

function calculateRelevance(item: FAQItem, query: string): number {
  const queryLower = query.toLowerCase();
  let score = 0;
  
  // Higher score for question title matches
  if (item.question.toLowerCase().includes(queryLower)) score += 10;
  
  // Medium score for answer content matches
  if (item.answer.toLowerCase().includes(queryLower)) score += 5;
  
  // Lower score for tag matches
  if (item.search_tags.some(tag => tag.toLowerCase().includes(queryLower))) score += 3;
  
  // Boost score for frequently viewed items
  score += Math.log(item.view_count + 1);
  
  return score;
}
```

### MCP SERVER USAGE

#### Required MCP Servers
- [ ] Context7: Load docs for React DnD, rich text editors
- [ ] Playwright: Test FAQ search functionality and accordion behavior
- [ ] Filesystem: Access FAQ templates and example content

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/react-beautiful-dnd/react-beautiful-dnd", "drag and drop lists", 2000);
await mcp__context7__get-library-docs("/tinymce/tinymce", "rich text editor", 2500);
await mcp__context7__get-library-docs("/tanstack/react-query", "data fetching", 1500);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('FAQ Service', () => {
  it('should create FAQ item with auto-generated tags', async () => {
    const item = await faqService.createFAQItem('supplier-123', {
      question: 'What is your pricing?',
      answer: 'Our wedding packages start at $2000...',
      searchTags: ['pricing', 'packages'],
      visibilityRule: 'public'
    });
    expect(item.search_tags).toContain('pricing');
  });
  
  it('should search FAQs with relevance ranking', async () => {
    const results = await faqService.searchFAQs('supplier-123', 'pricing');
    expect(results[0].relevanceScore).toBeGreaterThan(0);
    expect(results).toBeSorted((a, b) => b.relevanceScore - a.relevanceScore);
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test('FAQ management workflow', async () => {
  await mcp__playwright__browser_navigate({url: '/faq'});
  await mcp__playwright__browser_snapshot();
  
  // Test creating new FAQ
  await mcp__playwright__browser_click({
    element: "Create FAQ button",
    ref: "button[data-testid='create-faq']"
  });
  
  await mcp__playwright__browser_type({
    element: "Question input",
    ref: "input[name='question']",
    text: "What is your cancellation policy?"
  });
  
  // Verify accordion functionality
  await mcp__playwright__browser_click({
    element: "FAQ accordion item",
    ref: "div[data-testid='faq-item-0']"
  });
  
  // Test search functionality
  await mcp__playwright__browser_type({
    element: "Search input",
    ref: "input[data-testid='faq-search']",
    text: "pricing"
  });
  
  await mcp__playwright__browser_wait_for({text: "search results"});
});
```

### ACCEPTANCE CRITERIA
- [ ] Suppliers can create, edit, and delete FAQ items with rich text answers
- [ ] FAQ items are organized in categories with drag-and-drop reordering
- [ ] Search functionality returns relevant results ranked by score
- [ ] Analytics track most viewed questions and search queries
- [ ] Visibility rules control when FAQ items are shown to different audiences
- [ ] Performance: FAQ search returns results within 200ms
- [ ] Security: Only supplier owners/admins can manage FAQs
- [ ] Accessibility: FAQ accordion follows WCAG 2.1 AA standards

### DEPENDENCIES
- Must complete after: WS-069 (Article Creation) - uses shared rich text editor
- Must complete before: Client FAQ display integration
- Shares code with: Article management system, search functionality

### ESTIMATED EFFORT
- Team A Frontend: 16 hours (FAQ management UI, search interface)
- Team B Backend: 12 hours (API endpoints, search indexing, analytics)
- Team C Integration: 4 hours (FAQ display on client portals)
- Total: 32 hours