# TECHNICAL SPECIFICATION: WS-093 - E2E Tests Implementation
## Generated by Feature Development Session - 2025-08-22

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** WedSync development team
**I want to:** Test complete user workflows from a real browser perspective
**So that:** Critical wedding coordination workflows never break for real users, preventing couples from losing their wedding data or suppliers missing important deadlines

**Real Wedding Scenario:**
A photographer's onboarding breaks in Safari, preventing them from importing 200+ client records before their busy season.
With E2E tests across browsers, we catch these user-facing issues before production.

### SPECIFICATION SOURCE
- **Feature ID:** WS-093
- **Original Spec:** /CORE-SPECIFICATIONS/11-TESTING-DEPLOYMENT/01-Testing/03-e2e-tests md.md
- **Current Implementation:** 0% complete
- **Files to Modify:** 
  - /wedsync/package.json (add E2E scripts)
  - /wedsync/playwright.config.ts (create)
- **New Files to Create:** 
  - /wedsync/tests/e2e/**/*.spec.ts
  - /wedsync/tests/e2e/pages/*.ts (page objects)

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- No new schema - uses test database from WS-092
-- E2E tests will use existing tables with test data
```

#### API Endpoints Required
```typescript
// No new endpoints - testing existing user-facing flows
interface E2ETestConfig {
  baseURL: string;
  testUser: { email: string; password: string };
  testData: {
    supplier: Supplier;
    couple: Couple;
    forms: Form[];
  };
}
```

#### Frontend Components Required
```typescript
// No new components - testing existing UI workflows
// Page Object Models for test organization
class SupplierDashboard {
  constructor(private page: Page) {}
  
  async addClient(clientData: {
    name: string;
    email: string;
    weddingDate: string;
  }) {
    await this.page.click('[data-testid="add-client"]');
    await this.page.fill('[data-testid="client-name"]', clientData.name);
    await this.page.fill('[data-testid="client-email"]', clientData.email);
    await this.page.fill('[data-testid="wedding-date"]', clientData.weddingDate);
    await this.page.click('[data-testid="save-client"]');
  }
}
```

#### Integration Points
```typescript
// E2E Testing Service
class E2ETestingService {
  async setupTestEnvironment() {
    // Start test server
    // Seed test database
    // Configure test authentication
  }
  
  async cleanupAfterTest() {
    // Clear browser storage
    // Reset test data
  }
  
  async authenticateSupplier(email: string, password: string) {
    // Handle login flow
  }
  
  async authenticateCouple(email: string, password: string) {
    // Handle couple login
  }
}
```

### CODE EXAMPLES

#### Example 1: Playwright Configuration
```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  timeout: 30000,
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: [
    ['html'],
    ['junit', { outputFile: 'test-results/junit.xml' }],
    ['list']
  ],
  use: {
    baseURL: process.env.E2E_BASE_URL || 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] }
    },
    {
      name: 'firefox', 
      use: { ...devices['Desktop Firefox'] }
    },
    {
      name: 'mobile-safari',
      use: { ...devices['iPhone 13'] }
    }
  ],
  webServer: {
    command: 'npm run dev',
    port: 3000,
    reuseExistingServer: !process.env.CI
  }
});
```

#### Example 2: Critical User Journey Test
```typescript
// tests/e2e/supplier-onboarding.spec.ts
import { test, expect } from '@playwright/test';
import { SupplierSignup } from './pages/SupplierSignup';
import { SupplierDashboard } from './pages/SupplierDashboard';

test.describe('Supplier Onboarding Flow', () => {
  test('photographer completes full onboarding journey', async ({ page }) => {
    const signup = new SupplierSignup(page);
    const dashboard = new SupplierDashboard(page);
    
    // Start onboarding process
    await signup.goto();
    await signup.selectVendorType('photographer');
    
    // Complete account creation
    await signup.fillAccountDetails({
      email: 'test@photography.com',
      password: 'SecurePass123!',
      businessName: 'Test Photography Studio',
      tier: 'professional'
    });
    
    await expect(page).toHaveURL('/onboarding/clients');
    
    // Import client list
    await page.setInputFiles(
      '[data-testid="csv-upload"]', 
      'tests/fixtures/sample-clients.csv'
    );
    
    await expect(page.getByText('127 clients imported successfully')).toBeVisible();
    await page.click('[data-testid="continue-to-forms"]');
    
    // Create first form
    await expect(page).toHaveURL('/forms/builder');
    await page.fill('[data-testid="form-name"]', 'Photography Questionnaire');
    
    // Add core fields via drag & drop
    const weddingDateField = page.getByTestId('field-type-wedding-date');
    const venueField = page.getByTestId('field-type-venue-name');
    const canvas = page.getByTestId('form-canvas');
    
    await weddingDateField.dragTo(canvas);
    await venueField.dragTo(canvas);
    
    await page.click('[data-testid="save-form"]');
    await expect(page.getByText('Form saved successfully')).toBeVisible();
    
    // Complete onboarding
    await page.click('[data-testid="finish-onboarding"]');
    
    // Verify dashboard access
    await expect(page).toHaveURL('/dashboard');
    await expect(page.getByTestId('welcome-message')).toContainText('Test Photography Studio');
    await expect(page.getByTestId('client-count')).toContainText('127 clients');
    await expect(page.getByTestId('form-count')).toContainText('1 form');
  });
});
```

#### Example 3: Core Fields Auto-Population Test
```typescript
// tests/e2e/core-fields-sync.spec.ts
import { test, expect } from '@playwright/test';

test('core fields auto-populate across supplier forms', async ({ page }) => {
  // Couple enters core wedding details in WedMe
  await page.goto('/wedme/setup');
  
  await page.fill('[data-testid="wedding-date"]', '2025-06-15');
  await page.fill('[data-testid="venue-name"]', 'The Grand Ballroom');
  await page.fill('[data-testid="guest-count"]', '150');
  await page.fill('[data-testid="couple-names"]', 'Sarah & Michael');
  
  await page.click('[data-testid="save-core-details"]');
  await expect(page.getByText('Wedding details saved')).toBeVisible();
  
  // Connect to photographer
  await page.goto('/suppliers/connect');
  await page.fill('[data-testid="supplier-code"]', 'PHOTO123');
  await page.click('[data-testid="connect-supplier"]');
  
  await expect(page.getByText('Connected to photographer')).toBeVisible();
  
  // Access photographer's questionnaire
  await page.click('[data-testid="photography-questionnaire-link"]');
  
  // Verify core fields are pre-filled
  await expect(page.getByTestId('field-wedding-date')).toHaveValue('2025-06-15');
  await expect(page.getByTestId('field-venue-name')).toHaveValue('The Grand Ballroom');
  await expect(page.getByTestId('field-guest-count')).toHaveValue('150');
  await expect(page.getByTestId('field-couple-names')).toHaveValue('Sarah & Michael');
  
  // Fill photographer-specific fields
  await page.selectOption('[data-testid="photo-style"]', 'natural');
  await page.fill('[data-testid="special-requests"]', 'Golden hour engagement shots');
  
  await page.click('[data-testid="submit-form"]');
  await expect(page.getByText('Questionnaire submitted successfully')).toBeVisible();
  
  // Verify submission from supplier side
  await page.goto('/login');
  await page.fill('[data-testid="email"]', 'photographer@test.com');
  await page.fill('[data-testid="password"]', 'password123');
  await page.click('[data-testid="login"]');
  
  await page.goto('/clients/sarah-michael');
  await expect(page.getByText('Photography Questionnaire')).toBeVisible();
  await expect(page.getByText('Completed')).toBeVisible();
  await expect(page.getByText('Golden hour engagement shots')).toBeVisible();
});
```

### MCP SERVER USAGE

#### Required MCP Servers
- [x] Playwright: Native browser automation for E2E tests
- [ ] Context7: Load Playwright documentation
- [ ] Filesystem: Manage test files and fixtures

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/playwright/test", "page objects", 2000);
await mcp__context7__get-library-docs("/playwright/test", "fixtures", 1500);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
// E2E tests ARE the implementation - no separate unit tests needed
// Framework tests for page objects and utilities
describe('E2E Test Framework', () => {
  it('should provide reliable page object models', () => {
    // Test page object helper methods
  });
});
```

#### E2E Tests Required
```typescript
describe('Critical User Journeys', () => {
  it('should test supplier onboarding flow', () => {});
  it('should test couple onboarding flow', () => {});
  it('should test form creation and sharing', () => {});
  it('should test core fields synchronization', () => {});
  it('should test customer journey automation', () => {});
  it('should test mobile responsiveness', () => {});
});
```

### ACCEPTANCE CRITERIA
- [ ] Playwright configured for multiple browsers and devices
- [ ] Critical user journeys tested end-to-end
- [ ] Supplier onboarding flow tested completely
- [ ] Couple onboarding and form filling tested
- [ ] Core fields auto-population verified across forms
- [ ] Mobile responsiveness tested on key flows
- [ ] Screenshot/video capture on failures
- [ ] Test reports generated in HTML and JUnit formats
- [ ] Integration with CI/CD pipeline

### DEPENDENCIES
- Must complete after: WS-091 (Unit Tests), WS-092 (Integration Tests)
- Must complete before: WS-095 (CI/CD) needs test integration
- Shares code with: All user-facing features (testing them)

### ESTIMATED EFFORT
- Team A Frontend: 16 hours (UI workflow tests)
- Team B Backend: 8 hours (API integration in E2E flows)
- Team C Full-stack: 20 hours (complete user journeys)
- Total: 44 hours