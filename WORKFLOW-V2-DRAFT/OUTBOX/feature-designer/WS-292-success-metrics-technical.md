# TECHNICAL SPECIFICATION: WS-292 - Success Metrics
## Generated by Feature Development Session - 2025-08-25

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Executive Team / Product Manager / Analytics Team Member
**I want to:** Implement comprehensive success metrics tracking and dashboards to monitor viral growth, engagement, and revenue performance
**So that:** We can make data-driven decisions, identify issues early, and optimize toward our Â£50k MRR and 1.5+ K-factor targets

**Real Wedding Scenario:**
"Our success metrics system tracks that a photographer (Day 1) imports 20 clients, creates their first form (Day 2), and sends 5 couple invitations (Day 3) - hitting our 'time to first invite <3 days' target. When couples activate their dashboards (Day 7), complete their first form (85% completion rate), and invite 3 other suppliers, we measure the viral coefficient reaching our 1.5+ K-factor goal."

### SPECIFICATION SOURCE
- **Feature ID:** WS-292
- **Original Spec:** /CORE-SPECIFICATIONS/00-PROJECT-OVERVIEW/07-success-metrics.md
- **Current Implementation:** 15% complete (basic analytics setup)
- **Files to Modify:**
  - /src/lib/analytics/tracking.ts
  - /src/components/admin/Dashboard.tsx
- **New Files to Create:**
  - /src/lib/metrics/success-tracker.ts
  - /src/lib/metrics/viral-coefficient.ts
  - /src/lib/metrics/engagement-analytics.ts
  - /src/components/analytics/MetricsDashboard.tsx
  - /src/components/analytics/AlertSystem.tsx

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Success Metrics Tracking
CREATE TABLE IF NOT EXISTS success_metrics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  date DATE NOT NULL,
  
  -- Business Metrics
  mrr DECIMAL(10,2) DEFAULT 0,
  mrr_growth_rate DECIMAL(5,3) DEFAULT 0, -- Month over month
  total_users INTEGER DEFAULT 0,
  paid_users INTEGER DEFAULT 0,
  trial_to_paid_conversion DECIMAL(4,3) DEFAULT 0,
  cac DECIMAL(8,2) DEFAULT 0,
  payback_period_months DECIMAL(4,2) DEFAULT 0,
  
  -- Retention Metrics
  monthly_churn_rate DECIMAL(4,3) DEFAULT 0,
  annual_churn_rate DECIMAL(4,3) DEFAULT 0,
  net_revenue_retention DECIMAL(4,3) DEFAULT 0,
  clv DECIMAL(8,2) DEFAULT 0,
  clv_cac_ratio DECIMAL(5,2) DEFAULT 0,
  
  -- Viral Metrics
  k_factor DECIMAL(4,3) DEFAULT 0,
  supplier_invite_rate DECIMAL(4,3) DEFAULT 0, -- % actively inviting
  avg_invites_per_supplier DECIMAL(4,1) DEFAULT 0,
  couple_activation_rate DECIMAL(4,3) DEFAULT 0,
  time_to_first_invite_hours INTEGER DEFAULT 0,
  suppliers_per_couple DECIMAL(3,1) DEFAULT 0,
  couples_per_supplier DECIMAL(4,1) DEFAULT 0,
  
  -- Engagement Metrics
  supplier_dau_rate DECIMAL(4,3) DEFAULT 0, -- % of suppliers active daily
  supplier_wau_rate DECIMAL(4,3) DEFAULT 0, -- % of suppliers active weekly
  couple_wau_rate DECIMAL(4,3) DEFAULT 0,
  avg_session_duration_minutes INTEGER DEFAULT 0,
  mobile_usage_rate DECIMAL(4,3) DEFAULT 0,
  
  -- Feature Adoption
  forms_usage_rate DECIMAL(4,3) DEFAULT 0,
  journey_builder_adoption DECIMAL(4,3) DEFAULT 0,
  ai_features_usage DECIMAL(4,3) DEFAULT 0,
  template_marketplace_purchases DECIMAL(4,3) DEFAULT 0,
  
  -- Performance Metrics
  avg_page_load_time_ms INTEGER DEFAULT 0,
  avg_api_response_time_ms INTEGER DEFAULT 0,
  uptime_percentage DECIMAL(5,3) DEFAULT 0,
  error_rate DECIMAL(4,3) DEFAULT 0,
  
  -- Support Metrics
  avg_first_response_minutes INTEGER DEFAULT 0,
  avg_resolution_hours DECIMAL(4,1) DEFAULT 0,
  csat_score DECIMAL(3,2) DEFAULT 0,
  nps_score INTEGER DEFAULT 0,
  
  UNIQUE(date)
);

-- User Journey Tracking
CREATE TABLE IF NOT EXISTS user_journey_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  user_type VARCHAR(20) NOT NULL, -- 'supplier' or 'couple'
  
  -- Event details
  event_name VARCHAR(100) NOT NULL,
  event_category VARCHAR(50) NOT NULL, -- 'onboarding', 'engagement', 'viral', etc.
  event_timestamp TIMESTAMP DEFAULT NOW(),
  
  -- Context
  session_id VARCHAR(100),
  page_url TEXT,
  user_agent TEXT,
  
  -- Properties
  properties JSONB,
  
  -- Time tracking
  time_since_signup_minutes INTEGER,
  time_since_last_event_minutes INTEGER,
  
  -- Indexes for fast queries
  INDEX idx_user_journey_user_type_event (user_id, user_type, event_name),
  INDEX idx_user_journey_event_timestamp (event_timestamp),
  INDEX idx_user_journey_event_name (event_name),
  
  CONSTRAINT fk_user_journey_user FOREIGN KEY (user_id) 
    REFERENCES users(id) ON DELETE CASCADE
);

-- Success Metric Alerts
CREATE TABLE IF NOT EXISTS metric_alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- Alert definition
  metric_name VARCHAR(100) NOT NULL,
  alert_type VARCHAR(20) NOT NULL, -- 'threshold', 'change', 'trend'
  threshold_value DECIMAL(10,3),
  comparison VARCHAR(10), -- '>', '<', '=', 'change_%'
  severity VARCHAR(20) DEFAULT 'warning', -- 'critical', 'warning', 'info'
  
  -- Alert status
  is_active BOOLEAN DEFAULT true,
  last_triggered_at TIMESTAMP,
  trigger_count INTEGER DEFAULT 0,
  
  -- Notification settings
  notification_channels JSONB, -- ['email', 'slack', 'webhook']
  recipients JSONB, -- Array of email addresses or webhook URLs
  
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Engagement Cohort Analysis
CREATE TABLE IF NOT EXISTS user_cohorts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  cohort_month DATE NOT NULL, -- First month of user signup
  user_type VARCHAR(20) NOT NULL,
  
  -- Cohort size and retention
  cohort_size INTEGER NOT NULL,
  month_0_retained INTEGER NOT NULL,
  month_1_retained INTEGER,
  month_3_retained INTEGER,
  month_6_retained INTEGER,
  month_12_retained INTEGER,
  
  -- Revenue metrics
  month_0_revenue DECIMAL(10,2) DEFAULT 0,
  month_1_revenue DECIMAL(10,2) DEFAULT 0,
  month_3_revenue DECIMAL(10,2) DEFAULT 0,
  month_6_revenue DECIMAL(10,2) DEFAULT 0,
  month_12_revenue DECIMAL(10,2) DEFAULT 0,
  
  -- Engagement metrics
  avg_forms_created DECIMAL(5,2) DEFAULT 0,
  avg_invitations_sent DECIMAL(5,2) DEFAULT 0,
  avg_feature_adoption DECIMAL(4,3) DEFAULT 0,
  
  updated_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(cohort_month, user_type)
);

-- Feature Usage Tracking
CREATE TABLE IF NOT EXISTS feature_usage (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  
  -- Feature details
  feature_name VARCHAR(100) NOT NULL,
  feature_category VARCHAR(50) NOT NULL,
  usage_count INTEGER DEFAULT 1,
  
  -- Usage context
  first_used_at TIMESTAMP DEFAULT NOW(),
  last_used_at TIMESTAMP DEFAULT NOW(),
  total_time_spent_minutes INTEGER DEFAULT 0,
  
  -- Success metrics
  successful_completions INTEGER DEFAULT 0,
  completion_rate DECIMAL(4,3) DEFAULT 0,
  
  updated_at TIMESTAMP DEFAULT NOW(),
  
  CONSTRAINT fk_feature_usage_user FOREIGN KEY (user_id) 
    REFERENCES users(id) ON DELETE CASCADE,
    
  UNIQUE(user_id, feature_name)
);
```

#### API Endpoints Required
```typescript
// Success Metrics API
interface SuccessMetricsAPI {
  // GET /api/v1/metrics/overview
  getMetricsOverview(timeframe: string): Promise<MetricsOverview>;
  
  // GET /api/v1/metrics/viral-coefficient
  getViralCoefficient(period: string): Promise<ViralMetrics>;
  
  // GET /api/v1/metrics/engagement
  getEngagementMetrics(segment?: string): Promise<EngagementMetrics>;
  
  // POST /api/v1/metrics/track
  trackEvent(event: AnalyticsEvent): Promise<void>;
  
  // GET /api/v1/metrics/cohorts
  getCohortAnalysis(userType?: string): Promise<CohortData>;
  
  // GET /api/v1/metrics/alerts
  getActiveAlerts(): Promise<MetricAlert[]>;
  
  // POST /api/v1/metrics/alerts
  createAlert(alert: CreateAlertRequest): Promise<MetricAlert>;
}

interface MetricsOverview {
  // Business Health
  current_mrr: number;
  mrr_growth_rate: number;
  total_users: number;
  paid_users: number;
  trial_conversion: number;
  
  // Viral Performance
  k_factor: number;
  avg_invites_per_user: number;
  invitation_conversion_rate: number;
  time_to_first_invite_avg: number; // hours
  
  // Engagement
  dau_rate: number;
  wau_rate: number;
  avg_session_duration: number; // minutes
  feature_adoption_rates: {
    forms: number;
    journey_builder: number;
    ai_features: number;
    marketplace: number;
  };
  
  // Performance
  avg_page_load_time: number; // ms
  uptime_percentage: number;
  error_rate: number;
  
  // Targets vs Actuals
  targets: {
    mrr_target: number;
    k_factor_target: number;
    churn_target: number;
    conversion_target: number;
  };
  
  alert_count: number;
}

interface ViralMetrics {
  k_factor: number;
  k_factor_trend: number[];
  
  supplier_metrics: {
    active_inviters_percentage: number;
    avg_invites_per_supplier: number;
    time_to_first_invite_hours: number;
  };
  
  couple_metrics: {
    activation_rate: number;
    avg_suppliers_invited: number;
    connection_completion_rate: number;
  };
  
  network_effects: {
    suppliers_per_couple: number;
    couples_per_supplier: number;
    cross_connection_rate: number;
    network_density: number;
  };
}

interface AnalyticsEvent {
  user_id: string;
  event_name: string;
  event_category: string;
  properties?: Record<string, any>;
  timestamp?: Date;
}
```

#### Frontend Components Required
```typescript
// Component: ExecutiveDashboard
// Location: /src/components/analytics/ExecutiveDashboard.tsx

interface Props {
  timeframe: '7d' | '30d' | '90d' | '1y';
  showComparisons?: boolean;
  showAlerts?: boolean;
}

// Key functionality:
- High-level KPI overview with trend indicators
- Target vs actual progress tracking
- Alert notifications and status
- Drill-down capabilities to detailed metrics
- Export functionality for reporting

// Component: ViralCoefficientTracker
// Location: /src/components/analytics/ViralCoefficientTracker.tsx

interface Props {
  showBreakdown?: boolean;
  showTrends?: boolean;
  alertThreshold?: number;
}

// Key functionality:
- Real-time K-factor calculation and display
- Viral loop performance breakdown
- Invitation flow analysis
- Network effect visualization
- Automated alerts for threshold breaches

// Component: AlertsManager
// Location: /src/components/analytics/AlertsManager.tsx

interface Props {
  showAllAlerts?: boolean;
  severityFilter?: 'critical' | 'warning' | 'info';
}

// Key functionality:
- Real-time alert monitoring
- Alert configuration and management
- Notification channel setup
- Alert history and resolution tracking
```

#### Integration Points
```typescript
// Service: SuccessMetricsTracker
// Dependencies: Analytics service, database, notification system

class SuccessMetricsTracker {
  async trackUserJourneyEvent(userId: string, event: AnalyticsEvent) {
    // Track individual user event
    await this.database.insert('user_journey_events', {
      user_id: userId,
      event_name: event.event_name,
      event_category: event.event_category,
      properties: event.properties,
      time_since_signup_minutes: await this.getTimeSinceSignup(userId),
      session_id: event.session_id
    });
    
    // Update aggregated metrics
    await this.updateDailyMetrics(event);
    
    // Check if this triggers any success milestones
    await this.checkSuccessMilestones(userId, event);
    
    // Check alert conditions
    await this.evaluateAlerts(event);
  }
  
  async calculateViralCoefficient(period: DateRange): Promise<number> {
    // Get invitation data
    const invitationData = await this.database.query(`
      SELECT 
        COUNT(*) as total_invitations,
        COUNT(DISTINCT inviter_id) as unique_inviters,
        COUNT(CASE WHEN converted_at IS NOT NULL THEN 1 END) as conversions
      FROM viral_invitations 
      WHERE sent_at BETWEEN $1 AND $2
    `, [period.start, period.end]);
    
    const avgInvitesPerUser = invitationData.total_invitations / invitationData.unique_inviters;
    const conversionRate = invitationData.conversions / invitationData.total_invitations;
    
    return avgInvitesPerUser * conversionRate;
  }
  
  async updateDailyMetrics(date: Date) {
    const metrics = await this.calculateAllMetrics(date);
    
    await this.database.upsert('success_metrics', {
      date,
      ...metrics
    });
    
    // Check if we need to send alerts
    await this.checkMetricThresholds(metrics);
  }
  
  async checkMetricThresholds(metrics: SuccessMetrics) {
    const alerts = await this.getActiveAlerts();
    
    for (const alert of alerts) {
      const currentValue = metrics[alert.metric_name];
      const shouldTrigger = this.evaluateAlertCondition(
        currentValue, 
        alert.threshold_value, 
        alert.comparison
      );
      
      if (shouldTrigger) {
        await this.triggerAlert(alert, currentValue);
      }
    }
  }
}

// Service: EngagementAnalytics
// Dependencies: User activity data, feature usage tracking

class EngagementAnalytics {
  async calculateFeatureAdoption(feature: string, timeframe: DateRange): Promise<number> {
    const totalUsers = await this.getTotalActiveUsers(timeframe);
    const featureUsers = await this.database.count('feature_usage', {
      feature_name: feature,
      first_used_at: { gte: timeframe.start, lte: timeframe.end }
    });
    
    return featureUsers / totalUsers;
  }
  
  async analyzeUserJourney(userId: string): Promise<UserJourneyAnalysis> {
    const events = await this.database.query(`
      SELECT event_name, event_timestamp, properties
      FROM user_journey_events
      WHERE user_id = $1
      ORDER BY event_timestamp ASC
    `, [userId]);
    
    return {
      signup_to_first_value: this.calculateTimeToFirstValue(events),
      onboarding_completion: this.getOnboardingProgress(events),
      engagement_score: this.calculateEngagementScore(events),
      viral_actions: this.countViralActions(events),
      churn_risk_score: this.calculateChurnRisk(events)
    };
  }
  
  async generateCohortAnalysis(cohortMonth: Date): Promise<CohortAnalysis> {
    // Get users who signed up in this month
    const cohortUsers = await this.getUsersInCohort(cohortMonth);
    
    // Calculate retention for each month
    const retention = await this.calculateCohortRetention(cohortUsers, cohortMonth);
    
    // Calculate revenue progression
    const revenue = await this.calculateCohortRevenue(cohortUsers, cohortMonth);
    
    return {
      cohort_month: cohortMonth,
      cohort_size: cohortUsers.length,
      retention_rates: retention,
      revenue_progression: revenue,
      ltv_projection: this.projectLifetimeValue(retention, revenue)
    };
  }
}

// Service: AlertsManager
// Dependencies: Notification services, metric calculations

class AlertsManager {
  async evaluateAllAlerts() {
    const alerts = await this.getActiveAlerts();
    const currentMetrics = await this.getCurrentMetrics();
    
    for (const alert of alerts) {
      const shouldTrigger = this.evaluateCondition(alert, currentMetrics);
      
      if (shouldTrigger && this.shouldSendNotification(alert)) {
        await this.sendAlert(alert, currentMetrics[alert.metric_name]);
      }
    }
  }
  
  async createAlert(alert: CreateAlertRequest): Promise<MetricAlert> {
    // Validate alert configuration
    this.validateAlertConfig(alert);
    
    // Create alert record
    const newAlert = await this.database.insert('metric_alerts', {
      metric_name: alert.metric_name,
      alert_type: alert.alert_type,
      threshold_value: alert.threshold_value,
      comparison: alert.comparison,
      severity: alert.severity,
      notification_channels: alert.notification_channels,
      recipients: alert.recipients
    });
    
    return newAlert;
  }
}
```

### CODE EXAMPLES

#### Example 1: Success Metrics Tracking
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { createClient } from '@/lib/supabase/server';

export class SuccessMetricsService {
  private supabase = createClient();
  
  async trackSuccessEvent(userId: string, eventName: string, properties?: any) {
    // Track the event
    await this.supabase.from('user_journey_events').insert({
      user_id: userId,
      event_name: eventName,
      event_category: this.categorizeEvent(eventName),
      properties,
      time_since_signup_minutes: await this.getTimeSinceSignup(userId)
    });
    
    // Check for milestone achievements
    await this.checkMilestones(userId, eventName);
  }
  
  async calculateDailyMetrics(date: Date): Promise<SuccessMetrics> {
    // Get MRR
    const mrr = await this.calculateMRR(date);
    
    // Get viral metrics
    const kFactor = await this.calculateKFactor(date);
    
    // Get engagement metrics
    const engagement = await this.calculateEngagement(date);
    
    // Get performance metrics
    const performance = await this.calculatePerformance(date);
    
    return {
      date,
      mrr,
      k_factor: kFactor,
      supplier_dau_rate: engagement.supplierDAU,
      couple_wau_rate: engagement.coupleWAU,
      avg_page_load_time_ms: performance.pageLoadTime,
      uptime_percentage: performance.uptime
    };
  }
  
  private async calculateKFactor(date: Date): Promise<number> {
    // Get invitation data for the period
    const { data: invitationData } = await this.supabase.rpc('get_viral_metrics', {
      start_date: date,
      end_date: new Date(date.getTime() + 24 * 60 * 60 * 1000)
    });
    
    if (!invitationData || invitationData.length === 0) return 0;
    
    const avgInvitesPerUser = invitationData.total_invites / invitationData.unique_inviters;
    const conversionRate = invitationData.conversions / invitationData.total_invites;
    
    return avgInvitesPerUser * conversionRate;
  }
  
  private async checkMilestones(userId: string, eventName: string) {
    const milestones = {
      'first_form_created': async () => {
        // Track time to first form
        const timeSinceSignup = await this.getTimeSinceSignup(userId);
        if (timeSinceSignup <= 24 * 60) { // Within 24 hours
          await this.recordMilestone(userId, 'fast_activation', { hours: timeSinceSignup / 60 });
        }
      },
      
      'first_invitation_sent': async () => {
        // Track viral activation
        const timeSinceSignup = await this.getTimeSinceSignup(userId);
        if (timeSinceSignup <= 3 * 24 * 60) { // Within 3 days
          await this.recordMilestone(userId, 'viral_activation', { days: timeSinceSignup / (24 * 60) });
        }
      },
      
      'first_client_imported': async () => {
        // Track onboarding completion
        await this.recordMilestone(userId, 'onboarding_complete');
      }
    };
    
    if (milestones[eventName]) {
      await milestones[eventName]();
    }
  }
}
```

#### Example 2: Real-time Metrics Dashboard
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import React, { useEffect, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Alert, AlertDescription } from '@/components/ui/alert';

export function ExecutiveMetricsDashboard() {
  const [metrics, setMetrics] = useState<MetricsOverview | null>(null);
  const [alerts, setAlerts] = useState<MetricAlert[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    loadDashboard();
    
    // Set up real-time updates
    const interval = setInterval(loadDashboard, 60000); // Update every minute
    
    return () => clearInterval(interval);
  }, []);
  
  const loadDashboard = async () => {
    try {
      const [metricsRes, alertsRes] = await Promise.all([
        fetch('/api/v1/metrics/overview?timeframe=30d'),
        fetch('/api/v1/metrics/alerts')
      ]);
      
      const metricsData = await metricsRes.json();
      const alertsData = await alertsRes.json();
      
      setMetrics(metricsData);
      setAlerts(alertsData.filter(a => a.severity === 'critical'));
    } catch (error) {
      console.error('Failed to load dashboard:', error);
    } finally {
      setLoading(false);
    }
  };
  
  if (loading || !metrics) return <div>Loading metrics...</div>;
  
  const mrrProgress = (metrics.current_mrr / metrics.targets.mrr_target) * 100;
  const kFactorStatus = metrics.k_factor >= metrics.targets.k_factor_target ? 'success' : 
                       metrics.k_factor >= 1.0 ? 'warning' : 'danger';
  
  return (
    <div className="space-y-6">
      {/* Critical Alerts */}
      {alerts.length > 0 && (
        <div className="space-y-2">
          {alerts.map((alert, index) => (
            <Alert key={index} variant="destructive">
              <AlertDescription>
                ð¨ {alert.metric_name}: {alert.current_value} {alert.comparison} {alert.threshold_value}
              </AlertDescription>
            </Alert>
          ))}
        </div>
      )}
      
      {/* Key Metrics Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <Card>
          <CardHeader>
            <CardTitle>MRR Progress</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold">
              Â£{metrics.current_mrr.toLocaleString()}
            </div>
            <div className="text-sm text-muted-foreground">
              Target: Â£{metrics.targets.mrr_target.toLocaleString()}
            </div>
            <div className="mt-2 w-full bg-gray-200 rounded-full h-2">
              <div 
                className="bg-blue-600 h-2 rounded-full" 
                style={{ width: `${Math.min(mrrProgress, 100)}%` }}
              />
            </div>
            <div className="text-xs mt-1">
              {mrrProgress.toFixed(1)}% of target
            </div>
            <div className={`text-sm mt-2 ${
              metrics.mrr_growth_rate >= 0.20 ? 'text-green-600' : 'text-orange-600'
            }`}>
              {(metrics.mrr_growth_rate * 100).toFixed(1)}% growth rate
            </div>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader>
            <CardTitle>Viral Coefficient (K-Factor)</CardTitle>
          </CardHeader>
          <CardContent>
            <div className={`text-3xl font-bold ${
              kFactorStatus === 'success' ? 'text-green-600' :
              kFactorStatus === 'warning' ? 'text-yellow-600' : 'text-red-600'
            }`}>
              {metrics.k_factor.toFixed(2)}
            </div>
            <div className="text-sm text-muted-foreground">
              Target: {metrics.targets.k_factor_target}+ (viral)
            </div>
            <div className="mt-2">
              <div className="text-xs">
                Invites/User: {metrics.avg_invites_per_user.toFixed(1)}
              </div>
              <div className="text-xs">
                Conversion: {(metrics.invitation_conversion_rate * 100).toFixed(1)}%
              </div>
            </div>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader>
            <CardTitle>User Growth</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold">
              {metrics.total_users.toLocaleString()}
            </div>
            <div className="text-sm text-muted-foreground">
              {metrics.paid_users} paid ({(metrics.trial_conversion * 100).toFixed(1)}%)
            </div>
            <div className="mt-4 space-y-1">
              <div className="flex justify-between text-xs">
                <span>DAU Rate:</span>
                <span>{(metrics.dau_rate * 100).toFixed(1)}%</span>
              </div>
              <div className="flex justify-between text-xs">
                <span>WAU Rate:</span>
                <span>{(metrics.wau_rate * 100).toFixed(1)}%</span>
              </div>
            </div>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader>
            <CardTitle>System Health</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              <div>
                <div className="text-sm font-medium">Uptime</div>
                <div className="text-xl">{(metrics.uptime_percentage * 100).toFixed(2)}%</div>
              </div>
              <div>
                <div className="text-sm font-medium">Page Load</div>
                <div className="text-xl">{metrics.avg_page_load_time}ms</div>
              </div>
              <div>
                <div className="text-sm font-medium">Error Rate</div>
                <div className="text-xl">{(metrics.error_rate * 100).toFixed(2)}%</div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
      
      {/* Feature Adoption */}
      <Card>
        <CardHeader>
          <CardTitle>Feature Adoption Rates</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {Object.entries(metrics.feature_adoption_rates).map(([feature, rate]) => (
              <div key={feature}>
                <div className="text-sm capitalize">{feature.replace('_', ' ')}</div>
                <div className="text-2xl font-bold">{(rate * 100).toFixed(1)}%</div>
                <div className="w-full bg-gray-200 rounded-full h-1 mt-1">
                  <div 
                    className="bg-green-500 h-1 rounded-full" 
                    style={{ width: `${rate * 100}%` }}
                  />
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

### MCP SERVER USAGE

#### Required MCP Servers
- [ ] Context7: Load docs for analytics frameworks
- [ ] Supabase: Real-time metrics tracking and alerts
- [ ] Playwright: Performance monitoring and testing

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/vercel/analytics", "custom events", 2000);
await mcp__context7__get-library-docs("/supabase/supabase", "realtime subscriptions", 2000);
await mcp__context7__get-library-docs("/mixpanel/mixpanel-js", "event tracking", 1500);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('Success Metrics Tracking', () => {
  it('should calculate K-factor correctly', () => {
    const tracker = new SuccessMetricsTracker();
    // Test viral coefficient calculation
  });
  
  it('should trigger alerts when thresholds are breached', () => {
    const alertsManager = new AlertsManager();
    // Test alert triggering logic
  });
  
  it('should track user journey milestones accurately', () => {
    // Test milestone tracking and timing
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test('Success metrics dashboard loads and updates', async () => {
  await mcp__playwright__browser_navigate({url: '/admin/metrics'});
  
  // Verify key metrics display
  await mcp__playwright__browser_snapshot();
  
  // Test real-time updates
  // Trigger a test event and verify metrics update
});
```

### ACCEPTANCE CRITERIA
- [ ] Comprehensive KPI tracking system covering all success metrics
- [ ] Real-time viral coefficient calculation (target: >1.5)
- [ ] MRR tracking and growth rate monitoring (target: Â£50k within 12 months)
- [ ] User engagement analytics (DAU, WAU, session duration)
- [ ] Feature adoption tracking for all major features
- [ ] Automated alert system for threshold breaches
- [ ] Cohort analysis for retention and revenue
- [ ] Performance monitoring (page load <2s, uptime >99.9%)
- [ ] Executive dashboard with key metrics visualization
- [ ] Export capabilities for reporting and analysis

### DEPENDENCIES
- Must complete after: Revenue model (WS-291)
- Must complete before: Technical architecture (WS-293)
- Shares code with: Analytics system, user tracking, billing system, notification system

### ESTIMATED EFFORT
- Team A Frontend: 24 hours (metrics dashboards, alert interfaces, visualization)
- Team B Backend: 32 hours (metrics calculation engine, alert system, cohort analysis)
- Team C Integration: 16 hours (analytics integrations, notification webhooks)
- Team D Platform: 8 hours (performance monitoring, system health tracking)
- Team E General: 10 hours (metrics documentation, KPI definitions)
- Team F Workflows: 6 hours (metrics workflow integration)
- Team G Performance: 8 hours (metrics system optimization)
- Total: 104 hours