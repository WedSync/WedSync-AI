# TECHNICAL SPECIFICATION: WS-036 - Photo Management
## Generated by Feature Development Session - 2025-08-21

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer who delivers 800+ photos per wedding
**I want to:** Organize, preview, and share client photos within their profile
**So that:** I can quickly show couples their gallery progress and share sneak peeks without using separate photo hosting services

**Real Wedding Scenario:**
A photographer uploads engagement photos, wedding day sneak peeks, and final gallery images directly to a couple's profile. The couple can access these immediately through their WedMe app, and the photographer can reference specific shots during timeline planning without switching between multiple platforms.

### SPECIFICATION SOURCE
- **Feature ID:** WS-036
- **Original Spec:** /CORE-SPECIFICATIONS/02-WEDSYNC-SUPPLIER-PLATFORM/03-Client-Management/09-photo-management md.md
- **Current Implementation:** 0% complete
- **Files to Modify:**
  - `/src/components/clients/tabs/PhotosTab.tsx` (new)
- **New Files to Create:**
  - `/src/components/photos/PhotoGallery.tsx`
  - `/src/components/photos/PhotoUpload.tsx`
  - `/src/components/photos/PhotoViewer.tsx`
  - `/src/lib/services/photoService.ts`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Photo albums for organization
CREATE TABLE IF NOT EXISTS photo_albums (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  client_id UUID REFERENCES clients(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  description TEXT,
  cover_photo_url TEXT,
  photo_count INTEGER DEFAULT 0,
  is_shared BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Individual photos
CREATE TABLE IF NOT EXISTS client_photos (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  album_id UUID REFERENCES photo_albums(id) ON DELETE CASCADE,
  client_id UUID REFERENCES clients(id) ON DELETE CASCADE,
  file_name TEXT NOT NULL,
  file_path TEXT NOT NULL,
  thumbnail_path TEXT,
  file_size INTEGER NOT NULL,
  width INTEGER,
  height INTEGER,
  taken_at TIMESTAMPTZ,
  is_favorite BOOLEAN DEFAULT false,
  upload_status TEXT CHECK (upload_status IN ('uploading', 'processing', 'ready', 'failed')) DEFAULT 'uploading',
  uploaded_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_photo_albums_client_id ON photo_albums(client_id);
CREATE INDEX IF NOT EXISTS idx_client_photos_album_id ON client_photos(album_id);
CREATE INDEX IF NOT EXISTS idx_client_photos_client_id ON client_photos(client_id);
```

#### API Endpoints Required
```typescript
// POST /api/clients/[id]/photos/upload
interface PhotoUploadRequest {
  files: File[];
  album_id?: string;
  album_name?: string;
}

// GET /api/clients/[id]/photos
interface GetPhotosResponse {
  albums: PhotoAlbum[];
  photos: ClientPhoto[];
}

// POST /api/clients/[id]/photos/share
interface SharePhotosRequest {
  photo_ids: string[];
  share_with_client: boolean;
}
```

#### Frontend Components Required
```typescript
// Component: PhotoGallery
interface PhotoGalleryProps {
  clientId: string;
  albums: PhotoAlbum[];
  photos: ClientPhoto[];
  onUpload: (files: File[]) => void;
}

// Key functionality:
- Grid layout with album organization
- Drag-and-drop upload
- Bulk selection and sharing
- Lightbox viewer
- Progress indicators for uploads

// Component: PhotoUpload
interface PhotoUploadProps {
  onUpload: (files: File[]) => void;
  maxFiles?: number;
  acceptedTypes?: string[];
}

// Key functionality:
- Multi-file selection
- Drag-and-drop support
- Image preview before upload
- Progress tracking
- Error handling for large files
```

#### Integration Points
```typescript
class PhotoService {
  async uploadPhotos(clientId: string, files: File[], albumId?: string): Promise<void> {
    const uploads = files.map(file => this.uploadSinglePhoto(clientId, file, albumId));
    await Promise.all(uploads);
  }
  
  private async uploadSinglePhoto(clientId: string, file: File, albumId?: string): Promise<void> {
    // Upload to Supabase Storage
    const filePath = `clients/${clientId}/photos/${file.name}`;
    const { data, error } = await supabase.storage
      .from('client-photos')
      .upload(filePath, file);
      
    if (error) throw error;
    
    // Generate thumbnail
    const thumbnailPath = await this.generateThumbnail(filePath);
    
    // Save photo record
    await supabase.from('client_photos').insert({
      client_id: clientId,
      album_id: albumId,
      file_name: file.name,
      file_path: filePath,
      thumbnail_path: thumbnailPath,
      file_size: file.size,
      upload_status: 'ready'
    });
  }
}
```

### ACCEPTANCE CRITERIA
- [x] Supports JPEG, PNG, HEIC photo uploads up to 10MB each
- [x] Generates thumbnails automatically for gallery view
- [x] Organizes photos into albums with drag-and-drop
- [x] Share photos with clients through WedMe integration
- [x] Performance: Loads 50+ photos in <3 seconds
- [x] Security: Photos isolated by client via RLS
- [x] Accessibility: Alt text support, keyboard navigation

### DEPENDENCIES
- Must complete after: WS-032 (Client Profiles)
- Must complete before: None (enhances client profiles)
- Shares code with: File upload utilities, image processing

### ESTIMATED EFFORT
- Team A Frontend: 16 hours
- Team B Backend: 12 hours
- Team D Media/Storage: 8 hours
- Total: 36 hours