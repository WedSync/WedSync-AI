# TECHNICAL SPECIFICATION: WS-208 - AI Journey Suggestions System
## Generated by Feature Development Session - 2025-08-25

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding supplier (photographer, caterer, DJ, planner)
**I want to:** Generate optimal customer journey templates using AI based on my service type, pricing tier, and client timeline
**So that:** I save 3-4 hours of manual journey design while ensuring I follow proven industry workflows that increase client satisfaction by 25%

**Real Wedding Scenario:**
Sarah is a luxury wedding photographer who books clients 8-12 months in advance. She needs different journey templates for engagement sessions (12+ month bookings), elopements (2-3 month bookings), and destination weddings. Currently she creates each journey manually, often missing critical touchpoints like final shot list reviews or equipment prep reminders.

### SPECIFICATION SOURCE
- **Feature ID:** WS-208
- **Original Spec:** /Users/skyphotography/CODE/WedSync-2.0/WedSync2/CORE-SPECIFICATIONS/04-AI-INTEGRATION/03-Content-Generation/03-journey-suggestions md.md
- **Current Implementation:** 0% complete
- **Files to Modify:** None - new feature
- **New Files to Create:**
  - `/wedsync/src/lib/ai/journey-suggestions-engine.ts`
  - `/wedsync/src/lib/services/vendor-journey-specialist.ts`
  - `/wedsync/src/lib/services/journey-optimizer.ts`
  - `/wedsync/src/components/ai/JourneySuggestionsPanel.tsx`
  - `/wedsync/src/app/api/ai/journey/suggest/route.ts`
  - `/wedsync/src/app/api/ai/journey/optimize/route.ts`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Store generated journeys for learning and reuse
CREATE TABLE ai_generated_journeys (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  vendor_type TEXT NOT NULL CHECK (vendor_type IN ('photographer', 'dj', 'caterer', 'venue', 'planner')),
  service_level TEXT NOT NULL CHECK (service_level IN ('basic', 'premium', 'luxury')),
  wedding_timeline_months INTEGER NOT NULL CHECK (wedding_timeline_months > 0),
  generated_structure JSONB NOT NULL,
  performance_metrics JSONB DEFAULT '{}',
  usage_count INTEGER DEFAULT 0,
  avg_completion_rate DECIMAL(3,2) DEFAULT 0.00,
  supplier_id UUID REFERENCES suppliers(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Track journey performance for ML improvement
CREATE TABLE journey_performance_data (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  journey_id UUID REFERENCES customer_journeys(id),
  ai_suggestion_id UUID REFERENCES ai_generated_journeys(id),
  actual_completion_rate DECIMAL(3,2),
  client_satisfaction_score INTEGER CHECK (client_satisfaction_score BETWEEN 1 AND 5),
  supplier_rating INTEGER CHECK (supplier_rating BETWEEN 1 AND 5),
  modifications_made JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_ai_journeys_vendor_type ON ai_generated_journeys(vendor_type);
CREATE INDEX idx_ai_journeys_service_level ON ai_generated_journeys(service_level);
CREATE INDEX idx_journey_performance_journey_id ON journey_performance_data(journey_id);
```

#### API Endpoints Required
```typescript
// Generate new AI journey suggestion
interface JourneySuggestionRequest {
  vendorType: 'photographer' | 'dj' | 'caterer' | 'venue' | 'planner';
  serviceLevel: 'basic' | 'premium' | 'luxury';
  weddingTimeline: number; // months until wedding
  clientPreferences?: {
    communicationStyle: 'formal' | 'casual' | 'detailed';
    frequency: 'minimal' | 'regular' | 'frequent';
  };
}

interface GeneratedJourney {
  id: string;
  nodes: JourneyNode[];
  metadata: {
    generatedAt: Date;
    basedOn: JourneySuggestionRequest;
    confidence: number;
    estimatedPerformance: {
      completionRate: number;
      engagementScore: number;
      timeToCompletion: number;
    };
  };
}

// POST /api/ai/journey/suggest
// POST /api/ai/journey/optimize
// GET /api/ai/journey/similar?vendor_type=:type&service_level=:level
```

#### Frontend Components Required
- **JourneySuggestionsPanel**: Main AI journey generation interface
- **VendorSpecificControls**: Service type and timeline inputs
- **GeneratedJourneyPreview**: Visual preview of suggested journey with edit capabilities
- **PerformancePredictionDisplay**: Shows predicted metrics and confidence scores
- **OptimizationSuggestions**: Displays recommendations for improving existing journeys

#### Integration Points
- **JourneyAI Service**: Core AI generation using OpenAI GPT-4
- **VendorJourneySpecialist**: Vendor-specific touchpoint logic and timing
- **JourneyOptimizer**: Performance analysis and improvement suggestions
- **ContextualJourneyBuilder**: Seasonal adjustments and personalization
- **Journey Engine**: Integration with existing journey execution system

### CODE EXAMPLES

#### AI Journey Generation Service
```typescript
class JourneyAI {
  async suggestJourney(request: JourneySuggestionRequest): Promise<GeneratedJourney> {
    const baseTemplate = await this.getBaseTemplate(request.vendorType);
    const industryData = await this.getIndustryBenchmarks(request.vendorType);
    
    const systemPrompt = `You are an expert wedding industry consultant. Create an optimal customer journey for a ${request.vendorType} offering ${request.serviceLevel} service level.
    
    Wedding timeline: ${request.weddingTimeline} months
    
    Include:
    - Specific touchpoint timing (days from booking)
    - Content type for each touchpoint
    - Goal of each interaction
    - Conditional branching logic
    - Vendor-specific best practices
    
    Return as structured JSON with nodes and connections.`;
    
    const response = await openai.chat.completions.create({
      model: 'gpt-4',
      messages: [{ role: 'system', content: systemPrompt }],
      response_format: { type: 'json_object' },
      temperature: 0.3
    });
    
    const journeyData = JSON.parse(response.choices[0].message.content);
    return this.validateAndEnhanceJourney(journeyData, request);
  }
}
```

#### Vendor-Specific Journey Specialist
```typescript
class VendorJourneySpecialist {
  private vendorTouchpoints = {
    photographer: {
      critical: ['contract_signing', 'engagement_session', 'timeline_review', 'final_details'],
      optimal_timing: {
        'engagement_session': 90, // days before wedding
        'timeline_review': 30,
        'final_details': 7
      },
      seasonal_adjustments: {
        'peak_season': { buffer_days: 14 },
        'off_season': { buffer_days: 7 }
      }
    },
    caterer: {
      critical: ['menu_tasting', 'final_headcount', 'dietary_confirmation', 'setup_coordination'],
      optimal_timing: {
        'menu_tasting': 120,
        'final_headcount': 14,
        'dietary_confirmation': 7,
        'setup_coordination': 1
      }
    }
  };

  buildVendorJourney(vendorType: string, timeline: number): JourneyNode[] {
    const spec = this.vendorTouchpoints[vendorType];
    const nodes = [];
    
    // Add booking confirmation node
    nodes.push({
      id: 'booking_confirmation',
      type: 'email',
      timing: 'immediate',
      content: 'booking_confirmation_template',
      triggers: ['contract_signed']
    });
    
    // Add critical touchpoints based on timeline
    for (const [touchpoint, daysOut] of Object.entries(spec.optimal_timing)) {
      if (daysOut < timeline * 30) { // Only if timeline allows
        nodes.push({
          id: touchpoint,
          type: this.determineContentType(touchpoint),
          timing: `${daysOut}_days_before`,
          content: `${touchpoint}_template`,
          conditional: this.getConditionalLogic(touchpoint)
        });
      }
    }
    
    return this.optimizeNodeSequence(nodes);
  }
}
```

### MCP SERVER USAGE
- **Context7 MCP**: Fetch OpenAI and Next.js documentation for API implementation
- **GitHub MCP**: Create feature branch and track development progress
- **PostgreSQL MCP**: Execute database migrations and verify schema
- **Supabase MCP**: Apply migrations and test database functionality

Required Context7 queries:
```graphql
query {
  searchDocs(query: "OpenAI GPT-4 API completions") {
    nodes {
      title
      content
      href
    }
  }
}
```

### TEST REQUIREMENTS

#### Unit Tests
- **JourneyAI.suggestJourney()**: Test AI generation with various inputs
- **VendorJourneySpecialist.buildVendorJourney()**: Test vendor-specific logic
- **Journey validation**: Test timing logic and constraint validation
- **Performance prediction**: Test metrics calculation accuracy

#### Integration Tests
- **Full journey generation flow**: Request → AI → Validation → Storage
- **Database operations**: Test journey storage and retrieval
- **API endpoints**: Test request/response formats and error handling

#### E2E Tests
```typescript
test('Photographer generates engagement session journey', async ({ page }) => {
  await page.goto('/dashboard/journeys/new');
  await page.selectOption('[data-testid="vendor-type"]', 'photographer');
  await page.selectOption('[data-testid="service-level"]', 'premium');
  await page.fill('[data-testid="timeline"]', '10');
  await page.click('[data-testid="generate-ai-journey"]');
  
  await expect(page.locator('[data-testid="generated-journey"]')).toBeVisible();
  await expect(page.locator('[data-testid="engagement-session-node"]')).toContainText('90 days before');
});
```

### ACCEPTANCE CRITERIA
- [ ] AI generates contextually appropriate journey templates for all 5 vendor types
- [ ] Generated journeys include vendor-specific touchpoints and optimal timing
- [ ] System validates generated journeys for logical consistency
- [ ] Performance predictions show confidence scores above 70%
- [ ] Journey suggestions can be customized and saved for reuse
- [ ] API handles errors gracefully with fallback to template-based generation
- [ ] Database tracks usage and performance for continuous improvement
- [ ] Integration with existing journey execution engine works seamlessly

### DEPENDENCIES
- **Before:** Journey Canvas (WS-013) and Journey Execution Engine (WS-030) must be complete
- **After:** Content Personalization Engine (WS-209) will enhance AI-generated content
- **Parallel:** FAQ Extraction System (WS-207) shares OpenAI service infrastructure

### ESTIMATED EFFORT
- **Backend Development:** 24 hours (AI service, vendor logic, optimization engine)
- **Frontend Development:** 16 hours (suggestion panel, preview components)
- **API Development:** 12 hours (endpoints, validation, error handling)
- **Database Work:** 8 hours (schema, migrations, performance tracking)
- **Testing:** 16 hours (unit, integration, E2E)
- **Total:** 76 hours across teams