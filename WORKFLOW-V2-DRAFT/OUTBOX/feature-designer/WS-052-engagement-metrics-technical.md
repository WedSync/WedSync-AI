# TECHNICAL SPECIFICATION: WS-052 - Engagement Metrics Dashboard
## Generated by Feature Development Session - 2025-08-21

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding venue coordinator managing 50 couples
**I want to:** See engagement scores showing which couples need attention
**So that:** I can focus on at-risk clients and prevent cancellations that cost $15,000+ each

**Real Wedding Scenario:**
Venue manager Lisa sees couple #23's engagement score dropped from 85 to 45 - they haven't logged in for 2 weeks and stopped responding to forms. The dashboard alerts "High churn risk". Lisa calls immediately, discovers they're overwhelmed with planning, and schedules a personal consultation. The couple stays booked and becomes one of her highest-rated reviews.

### SPECIFICATION SOURCE
- **Feature ID:** WS-052
- **Original Spec:** /CORE-SPECIFICATIONS/02-WEDSYNC-SUPPLIER-PLATFORM/10-Analytics/02-engagement-metrics md.md
- **Current Implementation:** 0% complete
- **Dependencies:** Client Activity Tracking (WS-051)

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Engagement Metrics table
CREATE TABLE IF NOT EXISTS engagement_metrics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  client_id UUID NOT NULL REFERENCES couples(id),
  supplier_id UUID NOT NULL REFERENCES suppliers(id),
  date DATE NOT NULL,
  overall_score DECIMAL(5,2) NOT NULL, -- 0-100
  recency_score DECIMAL(5,2) NOT NULL,
  frequency_score DECIMAL(5,2) NOT NULL,
  depth_score DECIMAL(5,2) NOT NULL,
  completion_score DECIMAL(5,2) NOT NULL,
  responsiveness_score DECIMAL(5,2) NOT NULL,
  engagement_segment VARCHAR(10) NOT NULL, -- 'hot', 'warm', 'cool', 'cold'
  churn_risk_score DECIMAL(5,2) DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(client_id, supplier_id, date)
);

-- Engagement Alerts table
CREATE TABLE IF NOT EXISTS engagement_alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID NOT NULL REFERENCES suppliers(id),
  client_id UUID NOT NULL REFERENCES couples(id),
  alert_type VARCHAR(30) NOT NULL, -- 'score_drop', 'churn_risk', 'inactive'
  previous_score DECIMAL(5,2),
  current_score DECIMAL(5,2),
  threshold_breached DECIMAL(5,2),
  is_acknowledged BOOLEAN DEFAULT FALSE,
  acknowledged_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### API Endpoints Required
```typescript
// GET /api/analytics/engagement/[supplierId]
interface GetEngagementMetricsResponse {
  success: boolean;
  metrics: {
    averageEngagement: number;
    segmentDistribution: {
      hot: number;
      warm: number;
      cool: number;
      cold: number;
    };
    trends: TimeSeriesData;
    topPerformers: Array<{
      clientId: string;
      clientName: string;
      score: number;
      segment: string;
    }>;
    atRiskClients: Array<{
      clientId: string;
      clientName: string;
      score: number;
      riskLevel: string;
      lastActivity: string;
    }>;
  };
}

// POST /api/analytics/engagement/calculate
interface CalculateEngagementRequest {
  supplierId?: string;
  clientId?: string;
  dateRange?: {
    from: string;
    to: string;
  };
}
```

#### Integration Points
```typescript
// Service: EngagementCalculator
class EngagementCalculator {
  async calculateEngagementScore(clientId: string, supplierId: string): Promise<EngagementScore> {
    // Weighted engagement scoring algorithm
    const recencyScore = await this.calculateRecencyScore(clientId);
    const frequencyScore = await this.calculateFrequencyScore(clientId);
    const depthScore = await this.calculateDepthScore(clientId);
    const completionScore = await this.calculateCompletionScore(clientId);
    const responsivenessScore = await this.calculateResponsivenessScore(clientId);
    
    const overallScore = (
      recencyScore * 0.3 +
      frequencyScore * 0.2 +
      depthScore * 0.2 +
      completionScore * 0.2 +
      responsivenessScore * 0.1
    );
    
    return {
      overall: overallScore,
      components: {
        recency: recencyScore,
        frequency: frequencyScore,
        depth: depthScore,
        completion: completionScore,
        responsiveness: responsivenessScore
      }
    };
  }
}
```

### ACCEPTANCE CRITERIA
- [x] Engagement scores update daily at 2 AM
- [x] Alerts trigger for >30% score drops
- [x] Comparative benchmarks against category averages
- [x] Predictive churn identification with 85% accuracy

### ESTIMATED EFFORT
- Team A Frontend: 18 hours
- Team D Analytics: 22 hours
- Total: 40 hours