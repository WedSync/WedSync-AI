# TECHNICAL SPECIFICATION: WS-185 - Verification Process System
## Generated by Feature Development Session - August 25, 2025

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Couple searching for trustworthy wedding suppliers through the WedSync directory
**I want to:** See verified badges (business registration, insurance, portfolio authenticity) on supplier profiles so I can confidently hire legitimate professionals
**So that:** I can avoid wedding vendor scams, ensure proper insurance coverage, and trust that portfolio images are authentic work from the actual supplier

**Real Wedding Scenario:**
A couple found a photographer with stunning portfolio images but later discovered they were stolen from another photographer, resulting in a disastrous wedding day with an inexperienced amateur. The Verification Process System prevents this by running reverse image searches on portfolio images, verifying business registration through government APIs, and checking insurance certificates through OCR document processing, displaying trust badges that help couples identify legitimate professionals.

### SPECIFICATION SOURCE
- **Feature ID:** WS-185
- **Original Spec:** /CORE-SPECIFICATIONS/06-DIRECTORY/02-Supplier-Profiles/02-verification-process md.md
- **Current Implementation:** 0% complete (new)
- **Files to Modify:** None (new feature)
- **New Files to Create:** 
  - `/wedsync/src/components/directory/VerificationBadges.tsx`
  - `/wedsync/src/components/admin/VerificationQueue.tsx`
  - `/wedsync/src/lib/verification/verification-engine.ts`
  - `/wedsync/src/app/api/verification/route.ts`
  - `/wedsync/supabase/migrations/verification-system.sql`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Supplier verification status
CREATE TABLE supplier_verifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID REFERENCES users(id),
  business_verified BOOLEAN DEFAULT false,
  insurance_verified BOOLEAN DEFAULT false,
  social_media_verified BOOLEAN DEFAULT false,
  portfolio_verified BOOLEAN DEFAULT false,
  reviews_verified BOOLEAN DEFAULT false,
  background_checked BOOLEAN DEFAULT false,
  payment_verified BOOLEAN DEFAULT false,
  verification_tier TEXT CHECK (verification_tier IN ('basic', 'gold', 'premium')),
  last_verified TIMESTAMPTZ,
  expires_at TIMESTAMPTZ
);

-- Verification processes and documents
CREATE TABLE verification_documents (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID REFERENCES users(id),
  document_type TEXT CHECK (document_type IN ('insurance', 'license', 'certification')),
  file_url TEXT NOT NULL,
  extracted_data JSONB,
  expiry_date DATE,
  status TEXT CHECK (status IN ('pending', 'approved', 'rejected', 'requires_info')),
  reviewed_by UUID REFERENCES users(id),
  reviewed_at TIMESTAMPTZ,
  notes TEXT
);

-- Manual review queue
CREATE TABLE verification_queue (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID REFERENCES users(id),
  verification_type TEXT NOT NULL,
  priority INTEGER DEFAULT 0,
  assigned_reviewer UUID REFERENCES users(id),
  status TEXT DEFAULT 'pending',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  reviewed_at TIMESTAMPTZ
);
```

#### API Endpoints Required
```typescript
// POST /api/verification/submit
interface VerificationSubmissionRequest {
  supplierId: string;
  documentType: 'insurance' | 'license' | 'certification';
  file: File;
}

interface VerificationResponse {
  success: boolean;
  data: {
    documentId: string;
    extractedData: ExtractedData;
    estimatedReviewTime: string;
  };
}
```

#### Frontend Components Required
```typescript
// Component: VerificationBadges
// Location: /src/components/directory/VerificationBadges.tsx

interface Props {
  verificationStatus: VerificationStatus;
  showTooltips: boolean;
}

// Key functionality:
- Trust badge display (Blue checkmark, Gold shield, Premium crown)
- Verification status tooltips explaining each badge type
- Badge expiry warnings and renewal prompts for suppliers
- Clickable verification details modal for transparency
```

#### Integration Points
```typescript
// Service: VerificationEngine
// Dependencies: OCR processing, business registry APIs, image verification

class VerificationEngine {
  async runAutomatedChecks(verification: VerificationProcess): Promise<AutoCheckResult> {
    // Business registry verification, social media validation, portfolio authenticity
  }
  
  async processInsuranceDocument(file: File): Promise<ExtractedData> {
    // OCR extraction of policy numbers, coverage amounts, expiry dates
  }
}
```

### CODE EXAMPLES

#### Example 1: Automated Business Verification
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { supabase } from '@/lib/supabase';

export async function verifyBusinessRegistration(businessName: string, registrationNumber?: string) {
  // Step 1: Check against government business registries
  const { data, error } = await supabase.functions.invoke('business-verification', {
    body: {
      business_name: businessName,
      registration_number: registrationNumber,
      country: 'UK' // or detect from supplier location
    }
  });
    
  // Step 2: Process verification results
  if (error) throw new Error('Business verification failed');
  
  return {
    isVerified: data.registration_found,
    companyDetails: data.company_data,
    registrationStatus: data.status,
    lastUpdated: data.last_filed_date
  };
}
```

### MCP SERVER USAGE

#### Required MCP Servers
- [x] Context7: Load docs for OCR libraries, image processing APIs
- [x] Filesystem: Process uploaded verification documents  
- [x] Playwright: Test verification submission and review flows

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/tesseract/tesseract", "ocr text extraction", 3000);
await mcp__context7__get-library-docs("/supabase/supabase", "file upload storage", 2000);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('VerificationEngine', () => {
  it('should accurately extract insurance policy data from documents', () => {
    // Test OCR extraction accuracy with sample insurance certificates
  });
  
  it('should detect portfolio image authenticity through reverse search', () => {
    // Test image verification algorithms
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test('Supplier can submit verification documents and track status', async () => {
  await mcp__playwright__browser_navigate({url: '/supplier/verification'});
  await mcp__playwright__browser_file_upload({paths: ['/test/insurance-cert.pdf']});
  // Verify document upload and processing workflow
});
```

### ACCEPTANCE CRITERIA
- [x] Automated business verification completes within 30 seconds for 90%+ of submissions
- [x] OCR document processing extracts key data with 95%+ accuracy
- [x] Verification badges display correctly on supplier profiles with proper tooltip explanations
- [x] Performance: Manual review queue processes 50+ verifications per hour
- [x] Security: Verification documents encrypted and access-controlled
- [x] Accessibility: Badge tooltips work with screen readers and keyboard navigation

### DEPENDENCIES
- Must complete after: Supplier profile foundation and document storage system
- Must complete before: Advanced directory features requiring trust indicators
- Shares code with: File upload infrastructure and admin review tools

### ESTIMATED EFFORT
- Team A Frontend: 36 hours (Verification UI, badge components, document upload interface)
- Team B Backend: 44 hours (OCR processing, API integrations, automated verification engine)
- Team E Full-stack: 28 hours (Admin review queue, manual verification workflows)
- Total: 108 hours