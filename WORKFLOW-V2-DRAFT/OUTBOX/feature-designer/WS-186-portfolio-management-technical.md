# TECHNICAL SPECIFICATION: WS-186 - Portfolio Management
## Generated by Feature Development Session - August 25, 2025

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer, venue, or florist managing my business presence on WedSync
**I want to:** Upload, organize, and optimize my wedding portfolio with AI-powered tagging and smart categorization
**So that:** I can showcase my best work effectively to attract couples, reduce time spent organizing images, and ensure my portfolio displays beautifully across all devices with fast loading speeds

**Real Wedding Scenario:**
A wedding photographer currently spends 3 hours manually organizing each wedding's 500+ photos into categories (ceremony, reception, portraits) and writing captions. The Portfolio Management system automatically detects ceremony vs. reception shots using AI, extracts venue information from EXIF data, generates SEO-friendly alt text, and creates optimized image sizes for fast loading. This reduces portfolio management from hours to minutes while improving the visual presentation that helps couples choose vendors.

### SPECIFICATION SOURCE
- **Feature ID:** WS-186
- **Original Spec:** /CORE-SPECIFICATIONS/06-DIRECTORY/02-Supplier-Profiles/03-portfolio-management md.md
- **Current Implementation:** 0% complete (new)
- **Files to Modify:** None (new feature)
- **New Files to Create:** 
  - `/wedsync/src/components/supplier/PortfolioManager.tsx`
  - `/wedsync/src/components/directory/PortfolioGallery.tsx`
  - `/wedsync/src/lib/portfolio/image-processing.ts`
  - `/wedsync/src/app/api/portfolio/route.ts`
  - `/wedsync/supabase/migrations/portfolio-management-system.sql`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Portfolio images with AI metadata
CREATE TABLE portfolio_images (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID REFERENCES users(id),
  original_url TEXT NOT NULL,
  optimized_urls JSONB,
  alt_text TEXT,
  caption TEXT,
  tags TEXT[],
  venue_name TEXT,
  wedding_date DATE,
  couple_names TEXT,
  is_hero BOOLEAN DEFAULT false,
  sort_order INTEGER,
  upload_date TIMESTAMPTZ DEFAULT NOW()
);

-- Featured work collections
CREATE TABLE featured_work (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  supplier_id UUID REFERENCES users(id),
  title TEXT NOT NULL,
  description TEXT,
  venue_name TEXT,
  wedding_date DATE,
  style_tags TEXT[],
  is_featured BOOLEAN DEFAULT false,
  image_ids UUID[]
);

-- Portfolio analytics
CREATE TABLE portfolio_stats (
  supplier_id UUID PRIMARY KEY REFERENCES users(id),
  total_images INTEGER DEFAULT 0,
  total_views INTEGER DEFAULT 0,
  avg_view_time DECIMAL(5,2),
  popular_images UUID[],
  last_updated TIMESTAMPTZ DEFAULT NOW()
);
```

#### API Endpoints Required
```typescript
// POST /api/portfolio/upload
interface PortfolioUploadRequest {
  supplierId: string;
  files: File[];
  autoTag: boolean;
}

interface PortfolioUploadResponse {
  success: boolean;
  data: {
    uploadedImages: GalleryImage[];
    aiTagsSuggested: string[];
    optimizationResults: OptimizationResult[];
  };
}
```

#### Frontend Components Required
```typescript
// Component: PortfolioManager
// Location: /src/components/supplier/PortfolioManager.tsx

interface Props {
  supplierId: string;
  initialImages: GalleryImage[];
  canEdit: boolean;
}

// Key functionality:
- Drag-and-drop image organization with visual feedback
- Bulk upload with progress indicators and AI processing status
- Category management (ceremony, reception, portraits, details)
- Hero image selection and featured work curation
```

#### Integration Points
```typescript
// Service: ImageProcessingPipeline
// Dependencies: AI tagging service, CDN storage, EXIF extraction

class ImageProcessingPipeline {
  async processPortfolioUpload(files: File[], supplierId: string): Promise<GalleryImage[]> {
    // Multi-step pipeline: validation, optimization, AI analysis, storage
  }
  
  async generateOptimizedImages(file: File): Promise<OptimizedImageSet> {
    // Create multiple sizes and formats for responsive loading
  }
}
```

### CODE EXAMPLES

#### Example 1: AI-Powered Image Processing
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { supabase } from '@/lib/supabase';

export async function processPortfolioUpload(files: File[], supplierId: string) {
  // Step 1: Validate and extract metadata
  const validFiles = files.filter(file => isValidImageFile(file));
  const results = [];
    
  // Step 2: Process each image through AI pipeline
  for (const file of validFiles) {
    const { data: aiAnalysis } = await supabase.functions.invoke('image-analysis', {
      body: { imageData: await file.arrayBuffer() }
    });
    
    // Step 3: Generate optimized versions and store
    const optimizedUrls = await generateImageVariants(file);
    
    const galleryImage = {
      supplier_id: supplierId,
      original_url: optimizedUrls.original,
      optimized_urls: optimizedUrls.variants,
      alt_text: aiAnalysis.generatedAltText,
      tags: aiAnalysis.detectedTags,
      venue_name: aiAnalysis.extractedVenue
    };
    
    results.push(galleryImage);
  }
  
  return results;
}
```

### MCP SERVER USAGE

#### Required MCP Servers
- [x] Context7: Load docs for image processing libraries, AI tagging APIs
- [x] Filesystem: Handle portfolio image uploads and processing
- [x] Playwright: Test drag-and-drop portfolio organization

#### Context7 Queries Needed
```typescript
await mcp__context7__get-library-docs("/cloudinary/cloudinary", "image optimization", 4000);
await mcp__context7__get-library-docs("/react-beautiful-dnd/react-beautiful-dnd", "drag drop", 3000);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('ImageProcessingPipeline', () => {
  it('should generate appropriate image variants for responsive loading', () => {
    // Test image optimization and variant generation
  });
  
  it('should accurately extract venue information from EXIF data', () => {
    // Test metadata extraction accuracy
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test('Supplier can upload and organize portfolio images', async () => {
  await mcp__playwright__browser_navigate({url: '/supplier/portfolio'});
  await mcp__playwright__browser_file_upload({paths: ['/test/wedding-photos/ceremony.jpg']});
  // Verify upload processing and organization workflow
});
```

### ACCEPTANCE CRITERIA
- [x] Bulk image upload processes 50+ images within 2 minutes with AI tagging
- [x] Portfolio galleries load within 1 second using optimized image variants
- [x] Drag-and-drop organization works smoothly with visual feedback
- [x] Performance: AI tagging achieves 85%+ accuracy for wedding image categorization
- [x] Security: Image uploads validated and scanned for malicious content
- [x] Accessibility: Portfolio galleries work with keyboard navigation and screen readers

### DEPENDENCIES
- Must complete after: Supplier profile foundation and file storage infrastructure
- Must complete before: WS-184 (Style Matching) - provides portfolio data for AI analysis
- Shares code with: Image optimization infrastructure and AI tagging services

### ESTIMATED EFFORT
- Team A Frontend: 48 hours (Portfolio management interface, drag-and-drop, image galleries)
- Team B Backend: 32 hours (Image processing pipeline, storage integration, metadata handling)
- Team D AI/ML: 40 hours (AI image tagging, venue detection, style classification)
- Total: 120 hours