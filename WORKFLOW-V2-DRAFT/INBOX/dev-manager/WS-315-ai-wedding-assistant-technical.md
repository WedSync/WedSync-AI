# TECHNICAL SPECIFICATION: WS-315 - AI Wedding Assistant & Chatbot
## Generated by Feature Development Session - 2025-01-05

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding couple planning their big day with multiple vendors
**I want to:** Ask natural language questions and get instant, personalized answers about my wedding
**So that:** I don't have to wait for vendor responses and can get help 24/7 during stressful planning periods

**Real Wedding Scenario:**
Emma is planning her September wedding at 11 PM, feeling overwhelmed about timeline coordination. She asks the AI: "What should happen 2 hours before our 4 PM ceremony if it might rain?" The AI instantly provides a detailed contingency timeline based on her venue, weather forecast, and vendor capabilities.

### SPECIFICATION SOURCE
- **Feature ID:** WS-315
- **Original Spec:** AI-Powered Features - Wedding Planning Assistant
- **Current Implementation:** 0% complete
- **Files to Modify:** None - completely new AI system
- **New Files to Create:**
  - `/src/components/ai/WeddingAssistant.tsx`
  - `/src/app/api/ai/chat/route.ts`
  - `/src/lib/ai/wedding-context-engine.ts`
  - `/src/lib/ai/prompt-templates.ts`
  - `/src/app/(dashboard)/ai-assistant/page.tsx`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- AI Conversations table
CREATE TABLE IF NOT EXISTS ai_conversations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id),
  organization_id UUID REFERENCES organizations(id),
  conversation_type VARCHAR(20) DEFAULT 'general' CHECK (conversation_type IN ('general', 'vendor_specific', 'emergency', 'planning')),
  title VARCHAR(200),
  status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'archived', 'escalated')),
  context_data JSONB DEFAULT '{}', -- Wedding details, vendor info, timeline data
  satisfaction_rating INTEGER CHECK (satisfaction_rating BETWEEN 1 AND 5),
  escalated_to_human BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AI Messages table
CREATE TABLE IF NOT EXISTS ai_messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  conversation_id UUID NOT NULL REFERENCES ai_conversations(id),
  role VARCHAR(20) NOT NULL CHECK (role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL,
  content_type VARCHAR(20) DEFAULT 'text' CHECK (content_type IN ('text', 'image', 'file', 'structured')),
  metadata JSONB DEFAULT '{}', -- Attachments, quick replies, context used
  tokens_used INTEGER,
  processing_time_ms INTEGER,
  confidence_score DECIMAL(3,2), -- 0.00 to 1.00
  sources_used JSONB, -- References to knowledge base articles, vendor info
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AI Knowledge Base table
CREATE TABLE IF NOT EXISTS ai_knowledge_base (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID REFERENCES organizations(id), -- Null for global knowledge
  category VARCHAR(50) NOT NULL,
  subcategory VARCHAR(50),
  title VARCHAR(200) NOT NULL,
  content TEXT NOT NULL,
  keywords TEXT[] DEFAULT '{}',
  embedding vector(1536), -- OpenAI embedding dimension
  relevance_score DECIMAL(3,2) DEFAULT 1.00,
  is_active BOOLEAN DEFAULT TRUE,
  version INTEGER DEFAULT 1,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AI Analytics table
CREATE TABLE IF NOT EXISTS ai_analytics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  conversation_id UUID NOT NULL REFERENCES ai_conversations(id),
  query_intent VARCHAR(100),
  response_type VARCHAR(50),
  user_satisfaction BOOLEAN,
  escalation_reason VARCHAR(100),
  cost_cents INTEGER, -- OpenAI API costs in cents
  date DATE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### CORE FUNCTIONALITY REQUIREMENTS

#### Natural Language Processing
- Intent recognition for wedding-specific queries
- Entity extraction (dates, venues, vendors, budgets)
- Context awareness from previous conversations
- Multilingual support (English, Spanish, French initially)

#### Wedding Domain Knowledge
- Venue-specific information and policies
- Vendor service capabilities and availability
- Timeline and logistics planning
- Budget optimization suggestions
- Weather contingency planning
- Guest management advice

#### Conversation Management
- Multi-turn conversations with context retention
- Conversation summarization and archiving
- Human escalation triggers and handoff
- Proactive suggestions based on wedding timeline

#### Integration Capabilities
- Real-time access to client wedding data
- Vendor availability and booking status
- Calendar integration for scheduling
- Document and photo analysis capabilities

### AI SYSTEM ARCHITECTURE
```typescript
interface WeddingAssistantConfig {
  organizationId?: string;
  weddingData: WeddingContext;
  userPreferences: UserPreferences;
  knowledgeBase: KnowledgeSource[];
}

interface WeddingContext {
  weddingDate: string;
  venue: VenueInfo;
  vendors: VendorInfo[];
  guestCount: number;
  budget: BudgetInfo;
  timeline: TimelineEvent[];
  preferences: WeddingPreferences;
}

class WeddingAssistantEngine {
  private openai: OpenAI;
  private knowledgeBase: VectorDB;
  private contextManager: ContextManager;
  
  async processQuery(
    query: string, 
    conversationId: string,
    context: WeddingContext
  ): Promise<AssistantResponse> {
    // 1. Intent classification
    const intent = await this.classifyIntent(query);
    
    // 2. Context enrichment
    const enrichedContext = await this.enrichContext(context, intent);
    
    // 3. Knowledge retrieval
    const relevantKnowledge = await this.retrieveKnowledge(query, enrichedContext);
    
    // 4. Response generation
    const response = await this.generateResponse(query, enrichedContext, relevantKnowledge);
    
    // 5. Post-processing
    return await this.postProcess(response, intent);
  }
  
  private async classifyIntent(query: string): Promise<Intent> {
    const prompt = `
    Classify this wedding planning query into one of these intents:
    - timeline_planning: Questions about when things should happen
    - vendor_coordination: Questions about vendor services or communication
    - budget_management: Questions about costs and spending
    - guest_management: Questions about guests, RSVPs, seating
    - venue_logistics: Questions about venue specifics and policies
    - emergency_planning: Questions about contingencies and problem-solving
    - general_advice: General wedding planning guidance
    
    Query: "${query}"
    
    Return only the intent category.
    `;
    
    const response = await this.openai.chat.completions.create({
      model: "gpt-4",
      messages: [{ role: "system", content: prompt }],
      temperature: 0.1
    });
    
    return response.choices[0].message.content as Intent;
  }
}
```

### API ENDPOINTS REQUIRED
```typescript
// Chat Interface
POST /api/ai/chat/send
GET /api/ai/chat/[conversationId]/history
POST /api/ai/chat/[conversationId]/feedback

// Conversation Management
GET /api/ai/conversations
POST /api/ai/conversations/new
PUT /api/ai/conversations/[id]/archive
POST /api/ai/conversations/[id]/escalate

// Knowledge Management
GET /api/ai/knowledge/search
POST /api/admin/ai/knowledge/upload
PUT /api/admin/ai/knowledge/[id]
DELETE /api/admin/ai/knowledge/[id]

// Analytics & Monitoring
GET /api/admin/ai/analytics/usage
GET /api/admin/ai/analytics/performance
GET /api/admin/ai/analytics/costs
```

### FRONTEND COMPONENTS REQUIRED

#### Chat Interface
```typescript
const WeddingAssistant: React.FC = () => {
  // Features:
  // - Floating chat bubble
  // - Full-screen chat modal
  // - Message history with search
  // - Quick action buttons
  // - Voice input support
  // - File upload for photos/documents
  // - Suggested questions based on context
};

const ChatMessage: React.FC<{
  message: AIMessage;
  isUser: boolean;
  showSources?: boolean;
}> = ({ message, isUser, showSources }) => {
  // Features:
  // - Rich text formatting
  // - Action buttons (book appointment, view document)
  // - Source citations with links
  // - Feedback buttons (helpful/not helpful)
  // - Copy message content
};
```

#### Admin Dashboard
```typescript
const AIAnalyticsDashboard: React.FC = () => {
  // Features:
  // - Conversation volume metrics
  // - User satisfaction scores
  // - Common query analysis
  // - Cost tracking and optimization
  // - Knowledge base performance
  // - Escalation rate monitoring
};
```

### SPECIALIZED WEDDING PROMPTS
```typescript
const WeddingPromptTemplates = {
  timeline_planning: `
    You are an expert wedding planner helping create a timeline for a wedding.
    
    Wedding Details:
    - Date: {weddingDate}
    - Venue: {venueName} 
    - Guest Count: {guestCount}
    - Ceremony Time: {ceremonyTime}
    
    Provide a detailed timeline that accounts for:
    - Setup and vendor arrival times
    - Photography schedule
    - Guest arrival and seating
    - Ceremony duration
    - Cocktail hour and reception flow
    - Vendor breakdown times
    
    Be specific with times and explain the reasoning.
  `,
  
  vendor_coordination: `
    You are coordinating between wedding vendors to ensure smooth collaboration.
    
    Available Vendors:
    {vendorList}
    
    Current Timeline:
    {timeline}
    
    Help resolve coordination issues and suggest optimal vendor scheduling.
    Focus on dependency management and communication protocols.
  `,
  
  emergency_planning: `
    You are an experienced wedding crisis manager helping with contingency planning.
    
    Wedding Details: {weddingContext}
    
    Provide specific, actionable contingency plans for common wedding day issues:
    - Weather problems (indoor/outdoor ceremonies)
    - Vendor no-shows or delays
    - Technical difficulties (sound, lighting)
    - Guest-related issues
    - Timeline delays
    
    Include backup options and emergency contacts.
  `
};
```

### ACCEPTANCE CRITERIA
- [x] 24/7 AI assistant available via chat interface across all platforms
- [x] Context-aware responses using complete wedding and vendor data
- [x] Natural language processing with 90%+ intent recognition accuracy
- [x] Integration with all wedding data (timeline, vendors, guests, budget)
- [x] Human escalation for complex issues with seamless handoff
- [x] Multi-language support for international wedding planning
- [x] Voice input and output capabilities for hands-free interaction
- [x] Mobile-optimized chat experience with offline message queuing

### DEPENDENCIES
- Must complete after: Customer Journey System - needs wedding context data
- Must complete before: Advanced Analytics Dashboard - provides conversation insights
- Integrates with: All data systems, vendor management, timeline planning

### ESTIMATED EFFORT
- Team A (Chat Interface): 40 hours
- Team B (AI Engine): 64 hours
- Team C (Knowledge System): 32 hours
- Team D (Analytics): 24 hours
- Team E (Testing/QA): 20 hours
- Total: 180 hours