# TECHNICAL SPECIFICATION: WS-136 - Responsive Design System
## Generated by Feature Development Session - August 23, 2025

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer on-site at a ceremony
**I want to:** Access all critical wedding information on my phone while moving between locations
**So that:** I can check the timeline, contact vendors, and update shot lists without carrying a laptop, ensuring I never miss key moments because I couldn't access information quickly enough on a 5.5" screen

**Real Wedding Scenario:**
A photographer is at a wedding venue switching between ceremony and reception locations. They need to quickly check the timeline on their phone (next event in 15 minutes), message the videographer about the first dance timing, and mark completed shot list items. With proper responsive design, all these actions take seconds on mobile. Without it, they're pinching and zooming, missing critical moments while fighting with desktop-only interfaces.

### SPECIFICATION SOURCE
- **Feature ID:** WS-136
- **Original Spec:** /CORE-SPECIFICATIONS/09-MOBILE-OPTIMIZATION/01-responsive-design md.md
- **Current Implementation:** 0% complete
- **Files to Modify:** 
  - /src/styles/globals.css
  - /src/app/layout.tsx
  - /src/components/navigation/nav-bar.tsx
- **New Files to Create:**
  - /src/hooks/useResponsive.ts
  - /src/components/responsive/responsive-container.tsx
  - /src/components/responsive/mobile-nav.tsx
  - /src/components/responsive/touch-optimized-form.tsx
  - /src/components/wedding-day/mobile-view.tsx
  - /src/lib/responsive/breakpoints.ts

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- User device preferences and responsive settings
CREATE TABLE IF NOT EXISTS user_device_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,
  preferred_view TEXT CHECK (preferred_view IN ('mobile', 'tablet', 'desktop', 'auto')),
  compact_mode BOOLEAN DEFAULT false,
  font_size_multiplier DECIMAL(2,1) DEFAULT 1.0,
  high_contrast BOOLEAN DEFAULT false,
  reduce_motion BOOLEAN DEFAULT false,
  touch_target_size TEXT DEFAULT 'normal' CHECK (touch_target_size IN ('small', 'normal', 'large')),
  last_device_type TEXT,
  last_viewport_width INTEGER,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Track mobile usage patterns for optimization
CREATE TABLE IF NOT EXISTS mobile_usage_analytics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES user_profiles(id),
  session_id UUID,
  device_type TEXT,
  viewport_width INTEGER,
  viewport_height INTEGER,
  feature_used TEXT,
  interaction_type TEXT CHECK (interaction_type IN ('touch', 'mouse', 'keyboard')),
  load_time_ms INTEGER,
  network_type TEXT,
  timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- Wedding day mobile access patterns
CREATE TABLE IF NOT EXISTS wedding_day_mobile_sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  wedding_id UUID REFERENCES clients(id),
  user_id UUID REFERENCES user_profiles(id),
  device_info JSONB,
  features_accessed TEXT[],
  offline_actions JSONB,
  battery_level INTEGER,
  location_access BOOLEAN,
  session_duration_seconds INTEGER,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_device_preferences_user ON user_device_preferences(user_id);
CREATE INDEX idx_mobile_analytics_user ON mobile_usage_analytics(user_id);
CREATE INDEX idx_wedding_mobile_sessions ON wedding_day_mobile_sessions(wedding_id);
```

#### API Endpoints Required
```typescript
// POST /api/responsive/preferences
interface UpdatePreferencesRequest {
  preferredView?: 'mobile' | 'tablet' | 'desktop' | 'auto';
  compactMode?: boolean;
  fontSizeMultiplier?: number;
  touchTargetSize?: 'small' | 'normal' | 'large';
}

interface UpdatePreferencesResponse {
  success: boolean;
  preferences: UserDevicePreferences;
}

// POST /api/responsive/analytics
interface TrackMobileUsageRequest {
  deviceType: string;
  viewport: { width: number; height: number };
  featureUsed: string;
  interactionType: 'touch' | 'mouse' | 'keyboard';
  loadTime?: number;
  networkType?: string;
}

// GET /api/responsive/wedding-day-mode
interface WeddingDayModeResponse {
  isWeddingDay: boolean;
  weddingData?: {
    coupleNames: string;
    timeline: TimelineEvent[];
    vendorContacts: VendorContact[];
    venue: VenueInfo;
  };
  offlineData?: any; // Cached data for offline use
}
```

#### Frontend Components Required
```typescript
// Component: ResponsiveNavigation
// Location: /src/components/navigation/responsive-nav.tsx

interface ResponsiveNavigationProps {
  user: User;
  currentPath: string;
  notifications?: number;
  isWeddingDay?: boolean;
}

// Key functionality:
- Desktop: Horizontal top navigation with all menu items
- Tablet: Collapsible sidebar with icons and labels
- Mobile: Bottom tab bar with 5 primary actions + "More" menu
- Wedding Day: Simplified navigation with critical features only
- Gesture support for swipe navigation
- Badge indicators for notifications

// Component: TouchOptimizedForm
// Location: /src/components/forms/touch-optimized-form.tsx

interface TouchOptimizedFormProps {
  fields: FormField[];
  onSubmit: (data: any) => void;
  showProgress?: boolean;
  autoSave?: boolean;
}

// Key functionality:
- Minimum 48x48px touch targets
- Single column layout on mobile
- Input zoom prevention (font-size: 16px)
- Sticky action buttons at bottom
- Swipe between form sections
- Auto-save on field blur

// Component: WeddingDayMobileView
// Location: /src/components/wedding-day/mobile-view.tsx

interface WeddingDayMobileViewProps {
  wedding: WeddingData;
  currentLocation?: GeolocationPosition;
  isOffline?: boolean;
}

// Key functionality:
- Full-screen takeover on mobile
- Critical info in fixed header
- One-tap actions (call, navigate, message)
- Offline-capable with cached data
- Large touch targets for stress situations
- High contrast mode for outdoor viewing
```

#### Integration Points
```typescript
// Service: ResponsiveManager
// Dependencies: Tailwind CSS, React hooks, Device detection

class ResponsiveManager {
  private breakpoints = {
    xs: 375,   // iPhone SE
    sm: 640,   // Large phones
    md: 768,   // iPad Mini
    lg: 1024,  // iPad Pro
    xl: 1280,  // Desktop
    '2xl': 1536 // Large screens
  };
  
  private deviceDetector: DeviceDetector;
  private preferences: UserDevicePreferences;
  
  getDeviceType(): 'mobile' | 'tablet' | 'desktop' {
    const width = window.innerWidth;
    
    if (width < this.breakpoints.md) return 'mobile';
    if (width < this.breakpoints.lg) return 'tablet';
    return 'desktop';
  }
  
  async optimizeForDevice() {
    const deviceType = this.getDeviceType();
    
    // Load device-specific components
    if (deviceType === 'mobile') {
      // Lazy load mobile-specific features
      const { MobileOptimizations } = await import('./mobile-optimizations');
      MobileOptimizations.apply();
    }
    
    // Adjust touch targets
    this.adjustTouchTargets(deviceType);
    
    // Configure gesture handlers
    this.setupGestureHandlers(deviceType);
    
    // Optimize images for viewport
    this.optimizeImages(deviceType);
  }
  
  private adjustTouchTargets(deviceType: string) {
    const root = document.documentElement;
    
    if (deviceType === 'mobile') {
      root.style.setProperty('--min-touch-target', '48px');
      root.style.setProperty('--touch-spacing', '8px');
    } else if (deviceType === 'tablet') {
      root.style.setProperty('--min-touch-target', '44px');
      root.style.setProperty('--touch-spacing', '6px');
    } else {
      root.style.setProperty('--min-touch-target', '32px');
      root.style.setProperty('--touch-spacing', '4px');
    }
  }
}
```

### CODE EXAMPLES

#### Example 1: Responsive Hook Implementation
```typescript
// ACTUAL CODE PATTERN TO FOLLOW:
import { useState, useEffect } from 'react';
import { useMediaQuery } from '@/hooks/useMediaQuery';

export function useResponsive() {
  const [mounted, setMounted] = useState(false);
  
  // Define breakpoint queries
  const isMobile = useMediaQuery('(max-width: 640px)');
  const isTablet = useMediaQuery('(min-width: 641px) and (max-width: 1024px)');
  const isDesktop = useMediaQuery('(min-width: 1025px)');
  
  // Specific device queries
  const isIPhone = useMediaQuery('(max-width: 414px)');
  const isIPad = useMediaQuery('(min-width: 768px) and (max-width: 1024px)');
  
  // Feature queries
  const hasTouch = useMediaQuery('(pointer: coarse)');
  const prefersReducedMotion = useMediaQuery('(prefers-reduced-motion: reduce)');
  const isHighContrast = useMediaQuery('(prefers-contrast: high)');
  
  // Wedding day specific
  const [isWeddingDayMode, setWeddingDayMode] = useState(false);
  
  useEffect(() => {
    setMounted(true);
    
    // Check if today is a wedding day for this user
    checkWeddingDayMode().then(setWeddingDayMode);
  }, []);
  
  // Prevent hydration mismatch
  if (!mounted) {
    return {
      isMobile: false,
      isTablet: false,
      isDesktop: true,
      deviceType: 'desktop' as const,
      hasTouch: false,
      isWeddingDayMode: false
    };
  }
  
  return {
    // Device types
    isMobile,
    isTablet,
    isDesktop,
    deviceType: isMobile ? 'mobile' : isTablet ? 'tablet' : 'desktop',
    
    // Specific devices
    isIPhone,
    isIPad,
    
    // Capabilities
    hasTouch,
    prefersReducedMotion,
    isHighContrast,
    
    // Wedding specific
    isWeddingDayMode,
    
    // Helper functions
    getColumns: () => isMobile ? 1 : isTablet ? 2 : 4,
    getImageSize: () => isMobile ? 'small' : isTablet ? 'medium' : 'large',
    shouldShowMobileNav: () => isMobile || (isTablet && hasTouch)
  };
}

// Wedding Day responsive component
export function WeddingDayDashboard() {
  const { isMobile, isWeddingDayMode } = useResponsive();
  
  if (!isWeddingDayMode) {
    return <RegularDashboard />;
  }
  
  if (isMobile) {
    return (
      <div className="fixed inset-0 bg-white flex flex-col">
        {/* Fixed header with couple names and countdown */}
        <header className="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4 safe-top">
          <h1 className="text-xl font-bold">Sarah & Mike's Wedding</h1>
          <p className="text-sm opacity-90">Next: First Dance in 45 min</p>
        </header>
        
        {/* Scrollable timeline */}
        <main className="flex-1 overflow-y-auto">
          <WeddingTimeline mobile={true} />
        </main>
        
        {/* Fixed bottom actions */}
        <footer className="border-t bg-white p-4 safe-bottom">
          <div className="grid grid-cols-3 gap-2">
            <button className="btn-wedding-action h-12 flex items-center justify-center gap-2">
              <PhoneIcon className="w-5 h-5" />
              <span>Call</span>
            </button>
            <button className="btn-wedding-action h-12 flex items-center justify-center gap-2">
              <MapIcon className="w-5 h-5" />
              <span>Navigate</span>
            </button>
            <button className="btn-wedding-action h-12 flex items-center justify-center gap-2">
              <CameraIcon className="w-5 h-5" />
              <span>Photos</span>
            </button>
          </div>
        </footer>
      </div>
    );
  }
  
  // Desktop wedding day view
  return <WeddingDayDesktopDashboard />;
}
```

#### Example 2: Responsive Table/Card Pattern
```typescript
// Responsive data display that switches between table and cards
export function ClientList({ clients }: { clients: Client[] }) {
  const { isMobile, isTablet } = useResponsive();
  
  // Mobile: Card view
  if (isMobile) {
    return (
      <div className="space-y-3 px-4 pb-20"> {/* Padding for bottom nav */}
        {clients.map(client => (
          <div 
            key={client.id}
            className="bg-white rounded-lg shadow-sm p-4 active:scale-98 transition-transform"
          >
            {/* Client info in mobile-friendly layout */}
            <div className="flex justify-between items-start mb-3">
              <div>
                <h3 className="font-semibold text-lg">{client.coupleNames}</h3>
                <p className="text-sm text-gray-600 mt-1">
                  {formatDate(client.weddingDate, 'mobile')}
                </p>
              </div>
              <StatusBadge status={client.status} size="small" />
            </div>
            
            {/* Venue with tap-to-navigate */}
            <button 
              className="text-left w-full py-2 px-3 bg-gray-50 rounded-md"
              onClick={() => navigateToVenue(client.venue)}
            >
              <div className="flex items-center justify-between">
                <span className="text-sm">{client.venue.name}</span>
                <MapPinIcon className="w-4 h-4 text-gray-400" />
              </div>
            </button>
            
            {/* Quick actions */}
            <div className="mt-3 grid grid-cols-2 gap-2">
              <button className="btn-secondary h-10">
                <MessageIcon className="w-4 h-4 mr-1" />
                Message
              </button>
              <button className="btn-primary h-10">
                <EyeIcon className="w-4 h-4 mr-1" />
                View
              </button>
            </div>
          </div>
        ))}
      </div>
    );
  }
  
  // Tablet: Hybrid view
  if (isTablet) {
    return (
      <div className="grid grid-cols-2 gap-4 p-4">
        {clients.map(client => (
          <ClientCard key={client.id} client={client} variant="tablet" />
        ))}
      </div>
    );
  }
  
  // Desktop: Table view
  return (
    <div className="overflow-x-auto">
      <table className="w-full">
        <thead className="bg-gray-50">
          <tr>
            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Couple
            </th>
            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Wedding Date
            </th>
            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Venue
            </th>
            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Status
            </th>
            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Next Action
            </th>
            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
              Actions
            </th>
          </tr>
        </thead>
        <tbody className="bg-white divide-y divide-gray-200">
          {clients.map(client => (
            <ClientTableRow key={client.id} client={client} />
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

### MCP SERVER USAGE

#### Required MCP Servers
- [ ] Context7: Load Tailwind CSS and responsive design patterns
- [ ] Playwright: Test responsive layouts across devices
- [ ] Filesystem: Access component files for responsive updates

#### Context7 Queries Needed
```typescript
// Load Tailwind CSS responsive utilities
await mcp__context7__get-library-docs("/tailwindlabs/tailwindcss", "responsive breakpoints screens", 3000);

// Load React responsive patterns
await mcp__context7__get-library-docs("/react/react", "useMediaQuery useEffect hydration", 2000);

// Load gesture handling libraries
await mcp__context7__get-library-docs("/react-swipeable/react-swipeable", "swipe gestures touch", 2000);
```

### TEST REQUIREMENTS

#### Unit Tests Required
```typescript
describe('ResponsiveManager', () => {
  it('should detect correct device type', () => {
    // Mock window.innerWidth
    Object.defineProperty(window, 'innerWidth', { value: 375 });
    expect(manager.getDeviceType()).toBe('mobile');
    
    Object.defineProperty(window, 'innerWidth', { value: 768 });
    expect(manager.getDeviceType()).toBe('tablet');
    
    Object.defineProperty(window, 'innerWidth', { value: 1920 });
    expect(manager.getDeviceType()).toBe('desktop');
  });
  
  it('should apply correct touch target sizes', () => {
    manager.adjustTouchTargets('mobile');
    const minTarget = getComputedStyle(document.documentElement)
      .getPropertyValue('--min-touch-target');
    expect(minTarget).toBe('48px');
  });
  
  it('should handle wedding day mode correctly', async () => {
    const weddingDate = new Date();
    const result = await checkWeddingDayMode(weddingDate);
    expect(result.isWeddingDay).toBe(true);
    expect(result.criticalFeatures).toContain('timeline');
  });
});
```

#### E2E Tests Required
```typescript
// Using Playwright MCP
test.describe('Responsive Design', () => {
  const devices = [
    { name: 'iPhone 12', viewport: { width: 390, height: 844 } },
    { name: 'iPad', viewport: { width: 768, height: 1024 } },
    { name: 'Desktop', viewport: { width: 1920, height: 1080 } }
  ];
  
  devices.forEach(({ name, viewport }) => {
    test(`renders correctly on ${name}`, async () => {
      await mcp__playwright__browser_resize(viewport);
      await mcp__playwright__browser_navigate({url: '/dashboard'});
      
      // Take screenshot for visual regression
      await mcp__playwright__browser_take_screenshot({
        filename: `dashboard-${name.toLowerCase()}.png`,
        fullPage: true
      });
      
      // Verify navigation structure
      await mcp__playwright__browser_snapshot();
      
      if (viewport.width < 768) {
        // Mobile should have bottom nav
        await mcp__playwright__browser_evaluate({
          function: () => !!document.querySelector('.bottom-nav')
        });
      } else {
        // Desktop should have top nav
        await mcp__playwright__browser_evaluate({
          function: () => !!document.querySelector('.top-nav')
        });
      }
    });
  });
  
  test('wedding day mode on mobile', async () => {
    await mcp__playwright__browser_resize({ width: 375, height: 667 });
    await mcp__playwright__browser_navigate({url: '/wedding-day'});
    
    // Should be full screen
    await mcp__playwright__browser_snapshot();
    
    // Test touch interactions
    await mcp__playwright__browser_click({
      element: 'Navigate button',
      ref: 'button[aria-label="Navigate to venue"]'
    });
  });
});
```

### ACCEPTANCE CRITERIA
- [ ] All breakpoints work correctly (375px to 2560px)
- [ ] Touch targets minimum 48x48px on mobile
- [ ] Bottom navigation appears on mobile only
- [ ] Forms prevent zoom on iOS (font-size: 16px)
- [ ] Tables convert to cards on mobile
- [ ] Wedding day mode provides full-screen mobile experience
- [ ] Images load appropriate sizes per device
- [ ] Gesture navigation works on touch devices
- [ ] Text remains readable without horizontal scrolling
- [ ] Performance: <3s load time on 3G mobile

### DEPENDENCIES
- Must complete after: None - foundational mobile feature
- Must complete before: WS-137 (PWA Configuration), WS-138 (Touch Optimization)
- Shares code with: All UI components (affects entire application)

### ESTIMATED EFFORT
- Team A Frontend: 32 hours (component updates, responsive layouts)
- Team B Mobile: 24 hours (mobile-specific features, testing)
- Team E UX: 16 hours (responsive patterns, accessibility)
- Total: 72 hours