# TECHNICAL SPECIFICATION: WS-159 - Task Tracking
## Generated by Feature Development Session - August 23, 2025

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding couple monitoring task completion
**I want to:** Track task progress with status updates and completion confirmations from helpers
**So that:** I can ensure all wedding preparations are on track and identify bottlenecks early

### SPECIFICATION SOURCE
- **Feature ID:** WS-159
- **Original Spec:** /CORE-SPECIFICATIONS/03-WEDME-COUPLE-PLATFORM/05-Task-Delegation/05-task-tracking md.md

### TECHNICAL DESIGN

#### Database Schema Required
```sql
CREATE TABLE IF NOT EXISTS task_status_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID REFERENCES wedding_tasks(id) ON DELETE CASCADE,
  assignment_id UUID REFERENCES task_assignments(id) ON DELETE CASCADE,
  old_status VARCHAR(30),
  new_status VARCHAR(30),
  notes TEXT,
  updated_by UUID REFERENCES wedding_helpers(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

ALTER TABLE task_assignments ADD COLUMN IF NOT EXISTS progress_percentage INTEGER DEFAULT 0;
ALTER TABLE task_assignments ADD COLUMN IF NOT EXISTS estimated_completion TIMESTAMPTZ;
ALTER TABLE task_assignments ADD COLUMN IF NOT EXISTS actual_completion TIMESTAMPTZ;
ALTER TABLE task_assignments ADD COLUMN IF NOT EXISTS completion_photos TEXT[]; -- Photo evidence URLs
```

### CODE EXAMPLES

```typescript
export function TaskTracking({ coupleId }: { coupleId: string }) {
  const [tasks, setTasks] = useState<TaskWithStatus[]>([]);
  const [completionRate, setCompletionRate] = useState(0);

  const updateTaskStatus = async (assignmentId: string, newStatus: string, notes?: string) => {
    const { data, error } = await supabase
      .from('task_assignments')
      .update({ 
        assignment_status: newStatus,
        progress_percentage: newStatus === 'completed' ? 100 : 
                           newStatus === 'accepted' ? 25 : 0,
        actual_completion: newStatus === 'completed' ? new Date().toISOString() : null
      })
      .eq('id', assignmentId)
      .select()
      .single();

    if (!error) {
      // Log status change
      await supabase
        .from('task_status_history')
        .insert({
          assignment_id: assignmentId,
          old_status: data.assignment_status,
          new_status: newStatus,
          notes
        });
    }
  };

  return (
    <div className="task-tracking">
      <div className="completion-overview">
        <div className="text-2xl font-bold">{completionRate}% Complete</div>
        <div className="progress-bar bg-gray-200 rounded-full h-4">
          <div 
            className="bg-green-500 h-full rounded-full transition-all"
            style={{ width: `${completionRate}%` }}
          />
        </div>
      </div>
      
      {/* Task status cards */}
    </div>
  );
}
```

### ACCEPTANCE CRITERIA
- [x] Real-time task status tracking (assigned/accepted/completed)
- [x] Progress percentage and completion estimates
- [x] Photo evidence upload for task completion
- [x] Status change history and audit trail
- [x] Completion rate dashboard and analytics

### DEPENDENCIES
- Must complete after: WS-156 (Task Creation), WS-157 (Helper Assignment)
- Estimated Effort: 34 hours total