# TECHNICAL SPECIFICATION: WS-316 - Multi-Language Platform System
## Generated by Feature Development Session - 2025-01-05

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Wedding photographer serving international clients in London, Paris, and Milan
**I want to:** Provide my services in English, French, Italian, and Spanish with localized wedding customs
**So that:** I can expand my market to international couples planning destination weddings

**Real Wedding Scenario:**
Roberto's Photography serves high-end international couples planning weddings across Europe. His French clients need forms in French with French wedding traditions, his Italian clients expect Italian customs and terminology, while maintaining his English business operations. Each language needs proper currency, date formats, and cultural wedding practices.

### SPECIFICATION SOURCE
- **Feature ID:** WS-316
- **Original Spec:** International Features - Multi-Language Support
- **Current Implementation:** 0% complete
- **Files to Modify:** All frontend components, email templates, forms
- **New Files to Create:**
  - `/src/lib/i18n/translations.ts`
  - `/src/components/i18n/LanguageProvider.tsx`
  - `/src/app/api/i18n/translations/route.ts`
  - `/src/lib/i18n/locale-utils.ts`
  - `/src/app/(admin)/language-management/page.tsx`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- Supported Languages table
CREATE TABLE IF NOT EXISTS supported_languages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  language_code VARCHAR(5) NOT NULL UNIQUE, -- 'en-US', 'fr-FR', 'it-IT'
  language_name VARCHAR(50) NOT NULL,
  native_name VARCHAR(50) NOT NULL,
  is_rtl BOOLEAN DEFAULT FALSE,
  date_format VARCHAR(20) DEFAULT 'MM/DD/YYYY',
  currency_code VARCHAR(3) DEFAULT 'USD',
  currency_symbol VARCHAR(5) DEFAULT '$',
  number_format VARCHAR(20) DEFAULT '1,234.56',
  is_active BOOLEAN DEFAULT TRUE,
  completion_percentage DECIMAL(5,2) DEFAULT 0.00,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Translation Keys table
CREATE TABLE IF NOT EXISTS translation_keys (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  key_path VARCHAR(200) NOT NULL UNIQUE, -- 'common.buttons.save'
  context VARCHAR(100), -- 'button', 'label', 'error_message'
  description TEXT,
  is_system BOOLEAN DEFAULT TRUE, -- System vs custom translations
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Translations table
CREATE TABLE IF NOT EXISTS translations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  key_id UUID NOT NULL REFERENCES translation_keys(id),
  language_code VARCHAR(5) NOT NULL REFERENCES supported_languages(language_code),
  translation_value TEXT NOT NULL,
  is_approved BOOLEAN DEFAULT FALSE,
  translated_by UUID REFERENCES users(id),
  approved_by UUID REFERENCES users(id),
  translation_notes TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(key_id, language_code)
);

-- Organization Language Preferences table
CREATE TABLE IF NOT EXISTS organization_languages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  language_code VARCHAR(5) NOT NULL REFERENCES supported_languages(language_code),
  is_primary BOOLEAN DEFAULT FALSE,
  is_active BOOLEAN DEFAULT TRUE,
  custom_translations JSONB DEFAULT '{}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(organization_id, language_code)
);

-- User Language Preferences table
CREATE TABLE IF NOT EXISTS user_language_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) UNIQUE,
  preferred_language VARCHAR(5) NOT NULL REFERENCES supported_languages(language_code),
  timezone VARCHAR(50) DEFAULT 'UTC',
  date_format_preference VARCHAR(20),
  currency_preference VARCHAR(3),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### CORE FUNCTIONALITY REQUIREMENTS

#### Language Management System
- Support for 15+ major languages (English, Spanish, French, Italian, German, Portuguese, Dutch, Russian, Chinese, Japanese, Korean, Arabic, Hindi)
- Right-to-left (RTL) language support for Arabic and Hebrew
- Dynamic language switching without page reload
- Browser language detection with user override
- Custom translation management for organizations

#### Localization Features
- Currency formatting by region (£, €, $, ¥, etc.)
- Date and time formatting based on locale
- Number formatting (1,234.56 vs 1.234,56)
- Address formats by country
- Phone number formatting by region
- Cultural wedding traditions and terminology

#### Content Translation System
- AI-powered initial translations using OpenAI
- Human review and approval workflow
- Translation memory for consistency
- Placeholder and variable handling
- Context-aware translations
- Bulk translation import/export

### API ENDPOINTS REQUIRED
```typescript
// Language Management
GET /api/i18n/languages
POST /api/admin/i18n/languages
PUT /api/admin/i18n/languages/[code]

// Translation Management
GET /api/i18n/translations/[languageCode]
POST /api/admin/i18n/translations/batch
PUT /api/admin/i18n/translations/[id]
POST /api/admin/i18n/translations/approve/[id]

// User Preferences
GET /api/users/language-preferences
PUT /api/users/language-preferences
POST /api/i18n/detect-language

// Organization Settings
GET /api/organizations/[id]/languages
POST /api/organizations/[id]/languages
PUT /api/organizations/[id]/languages/[code]

// Translation Tools
POST /api/admin/i18n/auto-translate
GET /api/admin/i18n/missing-translations
POST /api/admin/i18n/export
POST /api/admin/i18n/import
```

### INTERNATIONALIZATION ARCHITECTURE
```typescript
interface LocaleConfig {
  code: string; // 'en-US'
  name: string; // 'English (United States)'
  nativeName: string; // 'English'
  currency: {
    code: string; // 'USD'
    symbol: string; // '$'
    position: 'before' | 'after';
  };
  dateFormat: string; // 'MM/DD/YYYY'
  timeFormat: string; // '12' | '24'
  numberFormat: {
    decimal: string; // '.'
    thousands: string; // ','
  };
  isRTL: boolean;
}

interface TranslationNamespace {
  common: CommonTranslations;
  forms: FormTranslations;
  emails: EmailTranslations;
  wedding: WeddingTranslations;
  vendors: VendorTranslations;
}

interface WeddingTranslations {
  traditions: {
    [key: string]: string; // Cultural wedding traditions
  };
  roles: {
    [key: string]: string; // Wedding party roles by culture
  };
  terminology: {
    [key: string]: string; // Wedding-specific terms
  };
}

class InternationalizationEngine {
  async translateText(
    text: string, 
    fromLang: string, 
    toLang: string,
    context?: string
  ): Promise<string> {
    // Use OpenAI for context-aware translation
    const prompt = `
    Translate this wedding industry text from ${fromLang} to ${toLang}.
    Context: ${context || 'general'}
    
    Text: "${text}"
    
    Provide a culturally appropriate translation that considers wedding traditions and terminology in the target language.
    `;
    
    const response = await this.openai.chat.completions.create({
      model: "gpt-4",
      messages: [{ role: "system", content: prompt }],
      temperature: 0.3
    });
    
    return response.choices[0].message.content || text;
  }
  
  formatCurrency(amount: number, locale: string): string {
    const config = this.getLocaleConfig(locale);
    return new Intl.NumberFormat(locale, {
      style: 'currency',
      currency: config.currency.code
    }).format(amount);
  }
  
  formatDate(date: Date, locale: string): string {
    const config = this.getLocaleConfig(locale);
    return new Intl.DateTimeFormat(locale, {
      dateStyle: 'medium'
    }).format(date);
  }
}
```

### FRONTEND COMPONENTS REQUIRED

#### Language Provider System
```typescript
const LanguageProvider: React.FC<{
  children: React.ReactNode;
  defaultLanguage?: string;
}> = ({ children, defaultLanguage }) => {
  // Features:
  // - Automatic language detection
  // - Translation loading and caching
  // - Language switching
  // - Fallback to default language
  // - RTL layout support
};

const LanguageSwitcher: React.FC = () => {
  // Features:
  // - Dropdown with flag icons
  // - Search functionality for many languages
  // - Current language indicator
  // - Keyboard navigation support
};

const useTranslation = (namespace?: string) => {
  // Hook providing:
  // - t() function for translations
  // - Current language info
  // - Loading states
  // - Error handling
};
```

#### Admin Translation Management
```typescript
const TranslationManager: React.FC = () => {
  // Features:
  // - Translation key management
  // - Batch translation operations
  // - Translation approval workflow
  // - Missing translation detection
  // - Export/import functionality
  // - Translation statistics
};

const TranslationEditor: React.FC<{
  keyPath: string;
  languages: string[];
}> = ({ keyPath, languages }) => {
  // Features:
  // - Side-by-side translation editing
  // - Context information display
  // - Translation suggestions
  // - Approval status indicators
  // - Version history
};
```

### CULTURAL WEDDING ADAPTATIONS
```typescript
const WeddingCultureAdaptations = {
  'en-US': {
    traditions: {
      bridal_party: 'Bridesmaids and Groomsmen',
      ceremony_length: '30-45 minutes',
      reception_style: 'Dinner and dancing'
    },
    terminology: {
      engagement_party: 'Engagement Party',
      bachelor_party: 'Bachelor Party',
      bridal_shower: 'Bridal Shower'
    }
  },
  'es-ES': {
    traditions: {
      bridal_party: 'Damas de honor y Padrinos',
      ceremony_length: '45-60 minutos',
      reception_style: 'Banquete y baile'
    },
    terminology: {
      engagement_party: 'Fiesta de Compromiso',
      bachelor_party: 'Despedida de Soltero',
      bridal_shower: 'Despedida de Soltera'
    }
  },
  'it-IT': {
    traditions: {
      bridal_party: 'Damigelle e Testimoni',
      ceremony_length: '30-40 minuti',
      reception_style: 'Ricevimento con banchetto'
    },
    terminology: {
      engagement_party: 'Festa di Fidanzamento',
      bachelor_party: 'Addio al Celibato',
      bridal_shower: 'Addio al Nubilato'
    }
  }
};
```

### ACCEPTANCE CRITERIA
- [x] Support for 15+ major languages with proper localization
- [x] Real-time language switching without page reload
- [x] Cultural adaptation for wedding traditions and terminology
- [x] Currency, date, and number formatting by locale
- [x] RTL language support for Arabic and Hebrew
- [x] AI-powered translation with human review workflow
- [x] Organization-specific custom translations capability
- [x] Mobile-optimized language selection and switching

### DEPENDENCIES  
- Must complete after: User Management System - needs user preferences
- Must complete before: White Label System - supports multi-language branding
- Integrates with: All frontend components, email system, forms

### ESTIMATED EFFORT
- Team A (Frontend I18n): 48 hours
- Team B (Translation System): 40 hours
- Team C (Localization): 32 hours
- Team D (Cultural Adaptation): 24 hours
- Team E (Testing/QA): 16 hours
- Total: 160 hours