# TECHNICAL SPECIFICATION: WS-313 - White Label Customization System
## Generated by Feature Development Session - 2025-01-05

### USER STORY & BUSINESS CONTEXT (THINK HARD - BE FACTUAL)
**As a:** Large wedding venue or enterprise client paying Â£149/month Enterprise tier
**I want to:** Completely rebrand WedSync with my company colors, logo, and domain
**So that:** Clients see my brand throughout their wedding planning journey, not WedSync branding

**Real Wedding Scenario:**
The Ritz London wants their couples to use wedding planning tools at planning.ritzcarlton.com with full Ritz branding, colors, and luxury aesthetic. Couples should never see "WedSync" branding - only Ritz Carlton throughout their entire experience.

### SPECIFICATION SOURCE
- **Feature ID:** WS-313
- **Original Spec:** Enterprise Features - White Label Capability
- **Current Implementation:** 0% complete
- **Files to Modify:** All frontend components, email templates
- **New Files to Create:**
  - `/src/components/branding/WhiteLabelProvider.tsx`
  - `/src/app/api/admin/branding/route.ts`
  - `/src/lib/branding/theme-engine.ts`
  - `/src/app/(admin)/white-label/page.tsx`
  - `/src/styles/themes/dynamic.css`

### TECHNICAL DESIGN

#### Database Schema Required
```sql
-- White Label Configurations table
CREATE TABLE IF NOT EXISTS white_label_configs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id) UNIQUE,
  brand_name VARCHAR(100) NOT NULL,
  custom_domain VARCHAR(255),
  domain_verified BOOLEAN DEFAULT FALSE,
  logo_url TEXT,
  favicon_url TEXT,
  primary_color VARCHAR(7) NOT NULL DEFAULT '#3B82F6',
  secondary_color VARCHAR(7) NOT NULL DEFAULT '#10B981',
  accent_color VARCHAR(7) NOT NULL DEFAULT '#F59E0B',
  background_color VARCHAR(7) NOT NULL DEFAULT '#FFFFFF',
  text_color VARCHAR(7) NOT NULL DEFAULT '#111827',
  font_family VARCHAR(100) DEFAULT 'Inter',
  custom_css TEXT,
  email_template_overrides JSONB DEFAULT '{}',
  footer_text TEXT,
  privacy_policy_url TEXT,
  terms_of_service_url TEXT,
  support_email VARCHAR(255),
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Custom Domain Verification table
CREATE TABLE IF NOT EXISTS domain_verifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  white_label_config_id UUID NOT NULL REFERENCES white_label_configs(id),
  domain VARCHAR(255) NOT NULL,
  verification_token VARCHAR(100) NOT NULL,
  verification_method VARCHAR(20) CHECK (verification_method IN ('dns_txt', 'dns_cname', 'file_upload')),
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'verified', 'failed', 'expired')),
  ssl_certificate_status VARCHAR(20) DEFAULT 'pending',
  verified_at TIMESTAMP WITH TIME ZONE,
  expires_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Asset Storage table
CREATE TABLE IF NOT EXISTS white_label_assets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  white_label_config_id UUID NOT NULL REFERENCES white_label_configs(id),
  asset_type VARCHAR(20) CHECK (asset_type IN ('logo', 'favicon', 'background', 'email_header')),
  file_name VARCHAR(255) NOT NULL,
  file_url TEXT NOT NULL,
  file_size INTEGER,
  mime_type VARCHAR(100),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### CORE FUNCTIONALITY REQUIREMENTS

#### Visual Branding System
- Logo upload and management (SVG, PNG support)
- Color palette customization (primary, secondary, accent)
- Typography selection from approved font library
- Custom CSS injection for advanced styling
- Favicon and touch icon management

#### Domain Management
- Custom domain configuration (subdomain or full domain)
- DNS verification process (TXT/CNAME records)
- SSL certificate provisioning and renewal
- Domain health monitoring and alerts

#### Email Template Customization
- Branded email headers and footers
- Color scheme application to all email types
- Custom sender information and support contacts
- Email preview and testing tools

#### Multi-Tenant Architecture
- Theme isolation per organization
- Runtime theme switching based on domain/organization
- Asset CDN management for performance
- Cache invalidation for theme updates

### API ENDPOINTS REQUIRED
```typescript
// White Label Configuration
GET /api/admin/white-label
PUT /api/admin/white-label
POST /api/admin/white-label/preview

// Asset Management
POST /api/admin/white-label/assets/upload
DELETE /api/admin/white-label/assets/[id]
GET /api/admin/white-label/assets

// Domain Management
POST /api/admin/white-label/domain/verify
GET /api/admin/white-label/domain/status
PUT /api/admin/white-label/domain/configure

// Theme API (Public)
GET /api/theme/[domain]
GET /api/theme/css/[organizationId]
```

### FRONTEND COMPONENTS REQUIRED

#### Theme Provider System
```typescript
interface WhiteLabelTheme {
  brandName: string;
  colors: {
    primary: string;
    secondary: string;
    accent: string;
    background: string;
    text: string;
  };
  typography: {
    fontFamily: string;
    headingFont?: string;
  };
  assets: {
    logo?: string;
    favicon?: string;
  };
  customCSS?: string;
}

const WhiteLabelProvider: React.FC<{
  children: React.ReactNode;
  theme: WhiteLabelTheme;
}>;
```

#### Admin Configuration Interface
- Visual theme builder with live preview
- Asset upload and management
- Domain configuration wizard
- Email template preview system
- Export/import theme configurations

#### Runtime Theme Application
- CSS custom properties injection
- Dynamic component styling
- Email template rendering
- Asset URL resolution
- SEO meta tag management

### ACCEPTANCE CRITERIA
- [x] Complete visual rebrand capability for Enterprise tier clients
- [x] Custom domain support with SSL certificate provisioning
- [x] Real-time theme preview before publishing changes
- [x] Email template customization with brand consistency
- [x] Mobile-responsive branding across all platforms
- [x] Asset management with optimization and CDN delivery
- [x] Multi-language support for brand-specific content
- [x] Performance: Theme loading <200ms, no layout shifts

### DEPENDENCIES
- Must complete after: Asset Management System - needs file upload capability
- Must complete before: Enterprise Client Onboarding - uses white label features
- Integrates with: All frontend components, email system, admin dashboard

### ESTIMATED EFFORT
- Team A (Frontend/Theming): 48 hours
- Team B (Backend API): 32 hours
- Team C (Domain Management): 24 hours
- Team D (Asset Pipeline): 20 hours
- Team E (Testing/QA): 16 hours
- Total: 140 hours