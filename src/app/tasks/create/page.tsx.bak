import React from 'react'
import { Metadata } from 'next'
import { TouchTaskCreationForm } from '@/components/tasks/mobile/TouchTaskCreationForm'
import { TaskTemplateGallery } from '@/components/tasks/mobile/TaskTemplateGallery'
import TouchInputSecurityValidator from '@/components/security/TouchInputValidator'
import CameraSecurityValidator from '@/components/security/CameraSecurityValidator'

export const metadata: Metadata = {
  title: 'Create Task - WedSync',
  description: 'Create a new wedding task with mobile-optimized interface',
  robots: 'noindex'
}

export default function CreateTaskPage() {
  return (
    <TouchInputSecurityValidator>
      <div className="min-h-screen bg-gray-50">
        <div className="container mx-auto max-w-2xl">
          {/* Header */}
          <div className="sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-4">
            <h1 className="text-xl font-semibold text-gray-900">Create New Task</h1>
            <p className="text-sm text-gray-600">Add a task to your wedding timeline</p>
          </div>

          {/* Task Creation Form */}
          <div className="bg-white">
            <TouchTaskCreationForm
              onTaskCreate={async (taskData) => {
                const response = await fetch('/api/tasks/create', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                  },
                  body: JSON.stringify(taskData)
                })
                
                if (!response.ok) {
                  throw new Error('Failed to create task')
                }
                
                return response.json()
              }}
              isOffline={!navigator.onLine}
            />
          </div>

          {/* Task Templates */}
          <div className="bg-white mt-6">
            <div className="px-4 py-4 border-b border-gray-200">
              <h2 className="text-lg font-medium text-gray-900">Wedding Task Templates</h2>
              <p className="text-sm text-gray-600">Quick start with pre-built templates</p>
            </div>
            <TaskTemplateGallery
              onTemplateSelect={(template) => {
                // Handle template selection
                console.log('Template selected:', template)
              }}
            />
          </div>
        </div>
      </div>
    </TouchInputSecurityValidator>
  )
}