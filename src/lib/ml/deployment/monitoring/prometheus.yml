# WS-232 ML System - Prometheus Configuration
# Comprehensive monitoring for ML prediction services

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    environment: 'production'
    service: 'wedsync-ml'

rule_files:
  - "alert_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # ML API Service Metrics
  - job_name: 'ml-api'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 5s
    metrics_path: /metrics
    scheme: http

  # ML Trainer Service
  - job_name: 'ml-trainer'
    static_configs:
      - targets: ['ml-trainer:9091']
    scrape_interval: 30s
    metrics_path: /metrics

  # ML Registry Service
  - job_name: 'ml-registry'
    static_configs:
      - targets: ['ml-registry:9092']
    scrape_interval: 15s
    metrics_path: /metrics

  # PostgreSQL Database
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres:9187']
    scrape_interval: 30s

  # Redis Cache
  - job_name: 'redis'
    static_configs:
      - targets: ['redis:9121']
    scrape_interval: 15s

  # Nginx Load Balancer
  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx:9113']
    scrape_interval: 15s

  # Node Exporter for System Metrics
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']
    scrape_interval: 15s

  # Container Metrics (cAdvisor)
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
    scrape_interval: 15s
    metrics_path: /metrics

  # Wedding Industry Specific Metrics
  - job_name: 'wedding-trends-model'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 10s
    metrics_path: /metrics/wedding-trends
    params:
      model: ['wedding-trends']

  - job_name: 'budget-optimizer-model'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 10s
    metrics_path: /metrics/budget-optimizer
    params:
      model: ['budget-optimizer']

  - job_name: 'vendor-performance-model'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 10s
    metrics_path: /metrics/vendor-performance
    params:
      model: ['vendor-performance']

  - job_name: 'churn-risk-model'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 10s
    metrics_path: /metrics/churn-risk
    params:
      model: ['churn-risk']

  - job_name: 'revenue-forecaster-model'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 10s
    metrics_path: /metrics/revenue-forecaster
    params:
      model: ['revenue-forecaster']

  # Business Metrics Specific to Wedding Industry
  - job_name: 'wedding-season-metrics'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 60s
    metrics_path: /metrics/wedding-season
    
  - job_name: 'vendor-marketplace-metrics'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 30s
    metrics_path: /metrics/vendor-marketplace

  # Regional Performance Metrics
  - job_name: 'regional-performance'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 60s
    metrics_path: /metrics/regional
    params:
      regions: ['london,southeast,southwest,north,scotland,wales']

  # Customer Journey Analytics
  - job_name: 'customer-journey-ml'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 30s
    metrics_path: /metrics/customer-journey

# Custom ML Model Health Checks
  - job_name: 'model-health-checks'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 60s
    metrics_path: /health/models
    scrape_timeout: 30s

# Batch Job Monitoring (Training, Data Pipeline)
  - job_name: 'ml-batch-jobs'
    static_configs:
      - targets: ['ml-trainer:9091']
    scrape_interval: 120s
    metrics_path: /metrics/batch-jobs

# External Dependencies Health
  - job_name: 'external-apis'
    static_configs:
      - targets: ['ml-api:9090']
    scrape_interval: 60s
    metrics_path: /health/external
    params:
      services: ['supabase,stripe,twilio,aws-s3']